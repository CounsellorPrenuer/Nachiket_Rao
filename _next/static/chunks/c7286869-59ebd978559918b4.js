"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{67037:function(e,t,n){let o;n.d(t,{KU:function(){return oO},L9:function(){return oM},YH:function(){return ek},_F:function(){return eI},iV:function(){return oS},q$:function(){return ol}});var r=n(92378),i=n(64090),a=n(83653),l=n(62955),s=n(3827),c=n(61063),d=n(67222),u=n(79248),p=n(26274),h=n(11087),f=n(56787),y=n(65876),g=n(94098),v=n(93574),m=n(91955),k=n(8627),b=n(28103),x=n(76786),_=n(59679),E=n(91179),w=n(5457),S=n(57608),O=n(99167),M=n(80031),R=n(66020),A=n(11161),N=n(98997),I=n(16664),T=n(98007),B=n(22071),C=n(61800),j=n(81205),L=n(5049),D=n(44750),Y=n(14308),U=n(6668),z=n(2115),P=n(36577),G=n(33115),F=n(2874),K=n(23393);let V="sanity-pte:";function W(e){let t="".concat(V).concat(e);return h&&h.enabled(t)?h(t):h(V)}h(V);let $="void-child";function J(e,t){let n=t[e._key];return n&&v(e,n)?n:(t[e._key]=e,e)}function q(e,t){let{schemaTypes:n}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:r,...i}=e;if(e&&e._type===n.block.name){let a=!1,l=typeof e.style>"u",s=typeof e.markDefs>"u",c=typeof e.children>"u",d=(e.children||[]).map(e=>{let{_type:t,_key:n,...r}=e;return"span"!==t?(a=!0,J({_type:t,_key:n,children:[{_key:$,_type:"span",text:"",marks:[]}],value:r,__inline:!0},o)):e});return!(!l&&!s&&!c&&!a&&u.W_.isElement(e))?(l&&(i.style=n.styles[0].name),J({_type:t,_key:r,...i,children:d},o)):e}return J({_type:t,_key:r,children:[{_key:$,_type:"span",text:"",marks:[]}],value:i},o)}):[]}function H(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:o,_type:r}=e;if(!o||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&o){let t=!1,i=e.children.map(e=>{let{_type:o}=e;if("value"in e&&"span"!==o){t=!0;let{value:o,_key:r,_type:i,__inline:a,children:l,...s}=e;return J({...s,...o,_key:r,_type:i},n)}return e});return t?J({...e,children:i,_key:o,_type:r},n):e}let i="value"in e&&e.value;return J({_key:o,_type:r,..."object"==typeof i?i:{}},n)})}function X(e,t){var n;return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&u.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].name&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&u.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!(null===(n=e[0].children[0].marks)||void 0===n?void 0:n.join(""))&&""===e[0].children[0].text}function Z(e){var t;let{editor:n,_key:o}=e,[,r]=null!==(t=Array.from(u.ML.nodes(n,{at:[],match:e=>e._key===o})).at(0))&&void 0!==t?t:[void 0,void 0],i=null==r?void 0:r.at(0);if(void 0!==i)return[i]}function Q(e){let{editor:t}=e;if(!t.selection)return[void 0,void 0];try{var n;return null!==(n=u.ML.node(t,t.selection.focus.path.slice(0,1)))&&void 0!==n?n:[void 0,void 0]}catch(e){return[void 0,void 0]}}function ee(e){let{editor:t,point:n}=e;try{var o;let[e]=null!==(o=u.ML.node(t,n.path.slice(0,1)))&&void 0!==o?o:[void 0,void 0];return e?[e,n.path.slice(0,1)]:[void 0,void 0]}catch(e){return[void 0,void 0]}}function et(e){let{editor:t,point:n}=e,[o,r]=ee({editor:t,point:n}),i=n.path.at(1);if(!o||!r||void 0===i)return[void 0,void 0];try{let e=u.NB.child(o,i);return e?[e,[...r,i]]:[void 0,void 0]}catch(e){return[void 0,void 0]}}function en(e){let{editor:t}=e;if(0===t.children.length)return[void 0,void 0];let n=u.ML.end(t,[]).path.at(0);try{var o;return void 0!==n&&null!==(o=u.ML.node(t,[n]))&&void 0!==o?o:[void 0,void 0]}catch(e){return[void 0,void 0]}}function eo(e){var t;let{schema:n,element:o}=e;return null===(t=H([o],n.block.name))||void 0===t?void 0:t.at(0)}function er(e,t){let{editor:n,schema:o}=e;return u.W_.isElement(t)&&!n.isInline(t)&&(o.block.name===t._type||o.blockObjects.some(e=>e.name===t._type))}function ei(e){let{schema:t,editor:n,range:o}=e,[r]=ee({editor:n,point:o.anchor}),[i]=ee({editor:n,point:o.focus});if(!r||!i)return null;let[a]=r._type===t.block.name?et({editor:n,point:o.anchor}):[void 0,void 0],[l]=i._type===t.block.name?et({editor:n,point:o.focus}):[void 0,void 0],s={anchor:{path:[{_key:r._key}],offset:o.anchor.offset},focus:{path:[{_key:i._key}],offset:o.focus.offset},backward:u.e6.isBackward(o)};return a&&(s.anchor.path.push("children"),s.anchor.path.push({_key:a._key})),l&&(s.focus.path.push("children"),s.focus.path.push({_key:l._key})),s}function ea(e){let{editorActor:t,slateEditor:n,event:o}=e;if(t.getSnapshot().matches({setup:"setting up"}))return;let r=function(e){let{slateEditor:t,event:n}=e;return f.y2.hasTarget(t,n.target)?f.y2.toSlateNode(t,n.target):void 0}({slateEditor:n,event:o});if(!r)return;let i=function(e){var t;let{editor:n,schema:o,node:r}=e;if(u.ML.isEditor(r))return;if(er({editor:n,schema:o},r))return eo({schema:o,element:r});let i=null===(t=Array.from(u.ML.nodes(n,{mode:"highest",at:[],match:e=>er({editor:n,schema:o},e)&&e.children.some(e=>e._key===r._key)})).at(0))||void 0===t?void 0:t.at(0);return u.W_.isElement(i)?eo({schema:o,element:i}):void 0}({editor:n,schema:t.getSnapshot().context.schema,node:r}),a=function(e){let{node:t,slateEditor:n,event:o}=e,[r]=function(e){let{editor:t}=e;if(0===t.children.length)return[void 0,void 0];let n=u.ML.start(t,[]).path.at(0);try{var o;return void 0!==n&&null!==(o=u.ML.node(t,[n]))&&void 0!==o?o:[void 0,void 0]}catch(e){return[void 0,void 0]}}({editor:n});if(!r)return;let i=f.y2.toDOMNode(n,r).getBoundingClientRect();if(o.pageY<i.top)return"start";let[a]=en({editor:n});if(!a)return;let l=f.y2.toDOMNode(n,a).getBoundingClientRect();if(o.pageY>l.bottom)return"end";let s=f.y2.toDOMNode(n,t).getBoundingClientRect(),c=s.top,d=s.height;return Math.abs(c-o.pageY)<d/2?"start":"end"}({node:r,slateEditor:n,event:o}),l=function(e){let{schema:t,slateEditor:n,event:o}=e,r=function(e,t){var n;let o,r;if(!t.target||!(0,f.uF)(t.target))return;let i=f.y2.getWindow(e);if(void 0!==i.document.caretPositionFromPoint){let e=i.document.caretPositionFromPoint(t.clientX,t.clientY);if(e)try{(o=i.document.createRange()).setStart(e.offsetNode,e.offset),o.setEnd(e.offsetNode,e.offset)}catch(e){}}else if(void 0!==i.document.caretRangeFromPoint)o=null!==(n=i.document.caretRangeFromPoint(t.clientX,t.clientY))&&void 0!==n?n:void 0;else{console.warn("Neither caretPositionFromPoint nor caretRangeFromPoint is supported");return}if(o){try{r=f.y2.toSlateRange(e,o,{exactMatch:!1,suppressThrow:!1})}catch(e){}return r}}(n,o);return r?ei({schema:t,editor:n,range:r}):null}({schema:t.getSnapshot().context.schema,slateEditor:n,event:o});if(i&&a&&!l&&!u.ML.isEditor(r))return{block:a,isEditor:!1,selection:{anchor:(0,y.qv)({context:t.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}}),focus:(0,g.sQ)({context:t.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}})}};if(!a||!l)return;let s=(0,y.Ak)(l.focus);if(void 0!==s)return(0,g.dI)(l)&&i&&s!==i._key?{block:a,isEditor:!1,selection:{anchor:(0,y.qv)({context:t.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}}),focus:(0,g.sQ)({context:t.getSnapshot().context,block:{node:i,path:[{_key:i._key}]}})}}:{block:a,isEditor:u.ML.isEditor(r),selection:l}}function el(e,t){if(!e||!t)return null;let n=[],o=e.offset||0,r="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,i="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,a=t.find(e=>e._key===r);if(!a)return null;if(n.push({_key:a._key}),a&&"children"===e.path[1]){if(!a.children||Array.isArray(a.children)&&0===a.children.length)return null;let t=Array.isArray(a.children)&&a.children.find(e=>e._key===i);if(!t)return null;n.push("children"),n.push({_key:t._key}),o=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:o}}function es(e){if(!e.context.selection)return null;if((0,g.Gh)(e.context.selection.anchor,e.context.selection.focus)){let t=ec(e,e.context.selection.anchor,e.context.selection.backward?"forward":"backward");return t?{anchor:t,focus:t}:null}let t=ec(e,e.context.selection.anchor,e.context.selection.backward?"forward":"backward"),n=ec(e,e.context.selection.focus,e.context.selection.backward?"backward":"forward");return t&&n?{anchor:t,focus:n}:null}function ec(e,t,n){var o;let r=(0,y.Ak)(t);if(!r)return;let i=e.blockIndexMap.get(r);if(void 0===i)return;let a=e.context.value.at(i);if(!a)return;if(!(0,y.dz)(e.context,a))return{path:[i,0],offset:0};let l=(0,y.NX)({path:t.path}),s=l?void 0:(0,y.MR)({context:{schema:e.context.schema,value:[a]},blockOffset:{path:[{_key:r}],offset:t.offset},direction:n});if(!(l=s?(0,y.NX)(s):l))return{path:[i,0],offset:0};let c=null!==(o=null==s?void 0:s.offset)&&void 0!==o?o:t.offset,d=[],u=-1,p;for(let t of a.children)if(u++,t._key===l){p=t,(0,y.dn)(e.context,t)?d=[u]:(d=[u,0],c=0);break}return 0===d.length?{path:[i,0],offset:0}:{path:[i].concat(d),offset:(0,y.dn)(e.context,p)?Math.min(p.text.length,c):c}}let ed=new WeakMap,eu=new WeakMap,ep=new WeakMap,eh=new WeakMap,ef=(0,i.createContext)({});function ey(){let e;let t=(0,r.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsx)("div",{contentEditable:!1,className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5},children:(0,s.jsx)("span",{})}),t[0]=e):e=t[0],e}function eg(e){let t,n;let o=(0,r.c)(4);return o[0]===Symbol.for("react.memo_cache_sentinel")?(t={userSelect:"none"},o[0]=t):t=o[0],o[1]!==e.blockObject._key||o[2]!==e.blockObject._type?(n=(0,s.jsxs)("div",{style:t,children:["[",e.blockObject._type,": ",e.blockObject._key,"]"]}),o[1]=e.blockObject._key,o[2]=e.blockObject._type,o[3]=n):n=o[3],n}function ev(e){let t,n;let o=(0,r.c)(4);return o[0]===Symbol.for("react.memo_cache_sentinel")?(t={userSelect:"none"},o[0]=t):t=o[0],o[1]!==e.inlineObject._key||o[2]!==e.inlineObject._type?(n=(0,s.jsxs)("span",{style:t,children:["[",e.inlineObject._type,": ",e.inlineObject._key,"]"]}),o[1]=e.inlineObject._key,o[2]=e.inlineObject._type,o[3]=n):n=o[3],n}function em(e){let{eventSelection:t,snapshot:n}=e,o=t;if((0,k.fX)({...n,context:{...n.context,selection:t}}))return o;let r=(0,m.dI)({context:{...n.context,selection:t}}),i=(0,m.I3)({...n,context:{...n.context,selection:t}}),a=(0,m.Cj)({...n,context:{...n.context,selection:t}});r&&i&&a&&(o={anchor:(0,y.qv)({context:n.context,block:i}),focus:(0,g.sQ)({context:n.context,block:i})});let l=(0,k.wD)(n);if(n.context.selection&&(0,m.sC)(n)&&l.length>1){let e=(0,k.Dm)(n),r=(0,k.Zq)(n);if(!e||!r)return o;let i=(0,y.qv)({context:n.context,block:e}),a=(0,g.sQ)({context:n.context,block:r});(0,k.Mf)(t)({...n,context:{...n.context,selection:{anchor:i,focus:a}}})&&(o={anchor:i,focus:a})}return o}let ek=()=>(function(e){let t=eb();return(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=new Uint8Array(e);return(0,b.Z)(t),t})(e).reduce((e,n)=>e+t[n],"").slice(0,e)})(12),eb=()=>{if(o)return o;o=[];for(let e=0;e<256;++e)o[e]=(e+256).toString(16).slice(1);return o};function ex(e){return{id:ek(),name:null==e?void 0:e.name,reference:null==e?void 0:e.reference}}let e_=ex({name:"core"});function eE(e){let t,n;let o=(0,r.c)(5),{key:a,onSetDragPositionBlock:l}=e,s=(0,i.useContext)(ef);o[0]!==s||o[1]!==a||o[2]!==l?(t=()=>{let e=function(e){let{key:t,onSetDragPositionBlock:n}=e;return[{behavior:(0,x.gg)({on:"drag.dragover",guard:e=>{let{snapshot:n,event:o}=e,r=(0,m.tT)({...n,context:{...n.context,selection:o.position.selection}});if(!r||r.node._key!==t)return!1;let i=o.dragOrigin;if(!i)return!1;let a=em({eventSelection:i.selection,snapshot:n});return!(0,k.wD)({...n,context:{...n.context,selection:a}}).some(e=>e.node._key===t)&&(0,k.u7)({...n,context:{...n.context,selection:a}})},actions:[e=>{let{event:t}=e;return[{type:"effect",effect:()=>{n(t.position.block)}}]}]}),priority:ex({reference:{priority:e_,importance:"lower"}})},{behavior:(0,x.gg)({on:"drag.*",guard:e=>{let{event:t}=e;return"drag.dragover"!==t.type},actions:[e=>{let{event:t}=e;return[{type:"effect",effect:()=>{n(void 0)}},(0,x.eH)(t)]}]}),priority:ex({reference:{priority:e_,importance:"lower"}})}]}({key:a,onSetDragPositionBlock:l});for(let t of e)s.send({type:"add behavior",behaviorConfig:t});return()=>{for(let t of e)s.send({type:"remove behavior",behaviorConfig:t})}},n=[s,a,l],o[0]=s,o[1]=a,o[2]=l,o[3]=t,o[4]=n):(t=o[3],n=o[4]),(0,i.useEffect)(t,n)}function ew(e){var t;let[n,o]=(0,i.useState)(),r=(0,i.useRef)(null),a=(0,p.vt)(),l=(0,p.b_)(e=>a&&null!==e.selection&&u.e6.isCollapsed(e.selection));eE({key:e.element._key,onSetDragPositionBlock:o});let c=e.legacySchema.blockObjects.find(t=>t.name===e.element._type);c||console.error('Unable to find Block Object "'.concat(e.element._type,'" in Schema'));let d=null!==(t=e.blockObject)&&void 0!==t?t:{_key:e.element._key,_type:e.element._type};return(0,s.jsxs)("div",{...e.attributes,className:"pt-block pt-object-block","data-block-key":e.element._key,"data-block-name":e.element._type,"data-block-type":"object",children:["start"===n?(0,s.jsx)(ey,{}):null,e.children,(0,s.jsx)("div",{ref:r,contentEditable:!1,draggable:!e.readOnly,children:e.renderBlock&&c?e.renderBlock({children:(0,s.jsx)(eg,{blockObject:d}),editorElementRef:r,focused:l,path:[{_key:e.element._key}],schemaType:c,selected:a,type:c,value:d}):(0,s.jsx)(eg,{blockObject:d})}),"end"===n?(0,s.jsx)(ey,{}):null]})}function eS(e){let t=(0,i.useRef)(null),n=(0,p._7)(),o=(0,p.vt)(),r=(0,p.b_)(e=>o&&null!==e.selection&&u.e6.isCollapsed(e.selection)),a=e.legacySchema.inlineObjects.find(t=>t.name===e.element._type);a||console.error('Unable to find Inline Object "'.concat(e.element._type,'" in Schema'));let l=f.y2.findPath(n,e.element),[c]=ee({editor:n,point:{path:l,offset:0}});c||console.error("Unable to find parent block of inline object ".concat(e.element._key));let d={_key:e.element._key,_type:e.element._type,..."value"in e.element&&"object"==typeof e.element.value?e.element.value:{}};return(0,s.jsxs)("span",{...e.attributes,draggable:!e.readOnly,className:"pt-inline-object","data-child-key":d._key,"data-child-name":d._type,"data-child-type":"object",children:[e.children,(0,s.jsx)("span",{ref:t,style:{display:"inline-block"},children:e.renderChild&&c&&a?e.renderChild({annotations:[],children:(0,s.jsx)(ev,{inlineObject:d}),editorElementRef:t,selected:o,focused:r,path:[{_key:c._key},"children",{_key:e.element._key}],schemaType:a,value:d,type:a}):(0,s.jsx)(ev,{inlineObject:d})})]})}function eO(e){var t,n;let[o,r]=(0,i.useState)(),a=(0,i.useRef)(null),l=(0,p.vt)(),c=(0,p.b_)(e=>l&&null!==e.selection&&u.e6.isCollapsed(e.selection));eE({key:e.element._key,onSetDragPositionBlock:r});let d=(0,p.b_)(t=>t.listIndexMap.get(e.textBlock._key)),h=e.children;if(e.renderStyle&&e.textBlock.style){let t=void 0!==e.textBlock.style?e.legacySchema.styles.find(t=>t.value===e.textBlock.style):void 0;t?h=e.renderStyle({block:e.textBlock,children:h,editorElementRef:a,focused:c,path:[{_key:e.textBlock._key}],schemaType:t,selected:l,value:e.textBlock.style}):console.error("Unable to find Schema type for text block style ".concat(e.textBlock.style))}if(e.renderListItem&&e.textBlock.listItem){let n=e.legacySchema.lists.find(t=>t.value===e.textBlock.listItem);n?h=e.renderListItem({block:e.textBlock,children:h,editorElementRef:a,focused:c,level:null!==(t=e.textBlock.level)&&void 0!==t?t:1,path:[{_key:e.textBlock._key}],selected:l,value:e.textBlock.listItem,schemaType:n}):console.error("Unable to find Schema type for text block list item ".concat(e.textBlock.listItem))}return(0,s.jsxs)("div",{...e.attributes,className:["pt-block","pt-text-block",...e.textBlock.style?["pt-text-block-style-".concat(e.textBlock.style)]:[],...e.textBlock.listItem?["pt-list-item","pt-list-item-".concat(e.textBlock.listItem),"pt-list-item-level-".concat(null!==(n=e.textBlock.level)&&void 0!==n?n:1)]:[]].join(" "),spellCheck:e.spellCheck,"data-block-key":e.textBlock._key,"data-block-name":e.textBlock._type,"data-block-type":"text",...void 0!==e.textBlock.listItem?{"data-list-item":e.textBlock.listItem}:{},...void 0!==e.textBlock.level?{"data-level":e.textBlock.level}:{},...void 0!==e.textBlock.style?{"data-style":e.textBlock.style}:{},...void 0!==d?{"data-list-index":d}:{},children:["start"===o?(0,s.jsx)(ey,{}):null,(0,s.jsx)("div",{ref:a,children:e.renderBlock?e.renderBlock({children:h,editorElementRef:a,focused:c,level:e.textBlock.level,listItem:e.textBlock.listItem,path:[{_key:e.textBlock._key}],selected:l,schemaType:e.legacySchema.block,style:e.textBlock.style,type:e.legacySchema.block,value:e.textBlock}):h}),"end"===o?(0,s.jsx)(ey,{}):null]})}function eM(e){let t,n,o;let a=(0,r.c)(34),l=(0,i.useContext)(ef),d=(0,c.v9)(l,eA),u=(0,c.v9)(l,eR),h=(0,p._7)();if("__inline"in e.element&&!0===e.element.__inline){let t;return a[0]!==u||a[1]!==e.attributes||a[2]!==e.children||a[3]!==e.element||a[4]!==e.readOnly||a[5]!==e.renderChild||a[6]!==d?(t=(0,s.jsx)(eS,{attributes:e.attributes,element:e.element,legacySchema:u,readOnly:e.readOnly,renderChild:e.renderChild,schema:d,children:e.children}),a[0]=u,a[1]=e.attributes,a[2]=e.children,a[3]=e.element,a[4]=e.readOnly,a[5]=e.renderChild,a[6]=d,a[7]=t):t=a[7],t}if(a[8]!==e.element._key||a[9]!==d||a[10]!==h.blockIndexMap||a[11]!==h.value){let o=h.blockIndexMap.get(e.element._key);t=void 0!==o?h.value.at(o):void 0,n=(0,y.dz)({schema:d},t),a[8]=e.element._key,a[9]=d,a[10]=h.blockIndexMap,a[11]=h.value,a[12]=t,a[13]=n}else t=a[12],n=a[13];if(n){let n;return a[14]!==t||a[15]!==u||a[16]!==e.attributes||a[17]!==e.children||a[18]!==e.element||a[19]!==e.readOnly||a[20]!==e.renderBlock||a[21]!==e.renderListItem||a[22]!==e.renderStyle||a[23]!==e.spellCheck?(n=(0,s.jsx)(eO,{attributes:e.attributes,element:e.element,legacySchema:u,readOnly:e.readOnly,renderBlock:e.renderBlock,renderListItem:e.renderListItem,renderStyle:e.renderStyle,spellCheck:e.spellCheck,textBlock:t,children:e.children}),a[14]=t,a[15]=u,a[16]=e.attributes,a[17]=e.children,a[18]=e.element,a[19]=e.readOnly,a[20]=e.renderBlock,a[21]=e.renderListItem,a[22]=e.renderStyle,a[23]=e.spellCheck,a[24]=n):n=a[24],n}return a[25]!==t||a[26]!==u||a[27]!==e.attributes||a[28]!==e.children||a[29]!==e.element||a[30]!==e.readOnly||a[31]!==e.renderBlock||a[32]!==d?(o=(0,s.jsx)(ew,{attributes:e.attributes,blockObject:t,element:e.element,legacySchema:u,readOnly:e.readOnly,renderBlock:e.renderBlock,schema:d,children:e.children}),a[25]=t,a[26]=u,a[27]=e.attributes,a[28]=e.children,a[29]=e.element,a[30]=e.readOnly,a[31]=e.renderBlock,a[32]=d,a[33]=o):o=a[33],o}function eR(e){return e.context.getLegacySchema()}function eA(e){return e.context.schema}let eN=(0,i.createContext)(null),eI=()=>{let e=(0,i.useContext)(eN);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},eT=(e,t)=>{t(e);let n=e.getSnapshot().children;n&&Object.values(n).forEach(e=>{eT(e,t)})};function eB(e){var t,n;let o=[];eT(e,e=>{o.push([e,e.getSnapshot()]),e.observers=new Set});let r=null===(t=(n=e.system).getSnapshot)||void 0===t?void 0:t.call(n);e.stop(),e.system._snapshot=r,o.forEach(e=>{let[t,n]=e;t._processingStatus=0,t._snapshot=n})}let eC={mimeType:"application/json",serialize:e=>{let{snapshot:t,event:n}=e,o=t.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return o?{...o.serialize({snapshot:t,event:n}),mimeType:"application/json",originEvent:n.originEvent}:{type:"serialization.failure",mimeType:"application/json",originEvent:n.originEvent,reason:"No application/x-portable-text Converter found"}},deserialize:e=>{let{snapshot:t,event:n}=e,o=t.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return o?{...o.deserialize({snapshot:t,event:n}),mimeType:"application/json"}:{type:"deserialization.failure",mimeType:"application/json",reason:"No application/x-portable-text Converter found"}}},ej={mimeType:"application/x-portable-text",serialize:e=>{let{snapshot:t,event:n}=e;if(!t.context.selection)return{type:"serialization.failure",mimeType:"application/x-portable-text",originEvent:n.originEvent,reason:"No selection"};let o=(0,m.Ly)(t);return 0===o.length?{type:"serialization.failure",mimeType:"application/x-portable-text",reason:"No blocks serialized",originEvent:n.originEvent}:{type:"serialization.success",data:JSON.stringify(o),mimeType:"application/x-portable-text",originEvent:n.originEvent}},deserialize:e=>{let{snapshot:t,event:n}=e,o=JSON.parse(n.data);if(!Array.isArray(o))return{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"Data is not an array"};let r=o.flatMap(e=>{let n=(0,y.IX)({context:t.context,block:e,options:{refreshKeys:!0,validateFields:!1}});return n?[n]:[]});return 0===r.length&&o.length>0?{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"No blocks were parsed"}:{type:"deserialization.success",data:r,mimeType:"application/x-portable-text"}}},eL={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},eD=new Map;function eY(e,t){let n,{blockIndexMap:o,listIndexMap:r}=t;o.clear(),r.clear(),eD.clear();for(let t=0;t<e.value.length;t++){let l=e.value.at(t);if(void 0!==l){var i,a;if(o.set(l._key,t),!(0,y.dz)(e,l)||void 0===l.listItem||void 0===l.level){eD.clear(),n=void 0;continue}if(!n){n={listItem:l.listItem,level:l.level},eD.set(l.level,1),r.set(l._key,1);continue}if(n.listItem!==l.listItem){eD.clear(),n={listItem:l.listItem,level:l.level},eD.set(l.level,1),r.set(l._key,1);continue}if(n.level===l.level){let e=null!==(i=eD.get(l.level))&&void 0!==i?i:0;eD.set(l.level,e+1),n={listItem:l.listItem,level:l.level},r.set(l._key,e+1);continue}if(n.level<l.level){eD.set(l.level,1),n={listItem:l.listItem,level:l.level},r.set(l._key,1);continue}if(n.level>l.level){let e=null!==(a=eD.get(l.level))&&void 0!==a?a:0;eD.set(l.level,e+1),n={listItem:l.listItem,level:l.level},r.set(l._key,e+1)}}}}function eU(e){var t;return{_type:e.schema.block.name,_key:e.keyGenerator(),style:null!==(t=e.schema.styles[0].name)&&void 0!==t?t:"normal",markDefs:[],children:[{_type:e.schema.span.name,_key:e.keyGenerator(),text:"",marks:[]}]}}let ez=e=>{let{context:t,operation:n}=e,o={blockIndexMap:n.editor.blockIndexMap,context:{value:n.editor.value,selection:n.editor.selection?ei({schema:t.schema,editor:n.editor,range:n.editor.selection}):null,schema:t.schema,keyGenerator:t.keyGenerator,converters:[],readOnly:!1},decoratorState:n.editor.decoratorState},r=(0,k.zd)(o),i=(0,k.WH)(o),a=(0,k.YG)(o),[l]=function(e){let{editor:t}=e;if(!t.selection)return[void 0,void 0];try{let[e,n]=u.ML.node(t,t.selection.focus.path);if(t.isTextSpan(e))return[e,n]}catch(e){}return[void 0,void 0]}({editor:n.editor});if(!l){u.YR.insertText(n.editor,n.text);return}if(r&&"unchanged"===r.state){var s;let e=(null!==(s=r.marks)&&void 0!==s?s:[]).filter(e=>t.schema.decorators.map(e=>e.name).includes(e));if(e.length===i.length&&e.every(e=>i.includes(e))){u.YR.insertText(n.editor,n.text);return}}u.YR.insertNodes(n.editor,{_type:l._type,_key:t.keyGenerator(),text:n.text,marks:[...i,...a]}),n.editor.decoratorState={}};function eP(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(e=>"string"==typeof e))}function eG(e){let t,{editor:n,blockPath:o,spanPath:r}=e;for(let[e,i]of u.NB.children(n,o,{reverse:!0}))if(n.isTextSpan(e)&&u.y$.isBefore(i,r)){t=e;break}return t}function eF(e){let t,{editor:n,blockPath:o,spanPath:r}=e;for(let[e,i]of u.NB.children(n,o))if(n.isTextSpan(e)&&u.y$.isAfter(i,r)){t=e;break}return t}function eK(e,t){let n=eV(e)||!1;ed.set(e,!0),t(),ed.set(e,n)}function eV(e){return ed.get(e)}let eW=new WeakMap,e$=new WeakMap;function eJ(e){var t;return null!==(t=eW.get(e))&&void 0!==t&&t}function eq(e){var t;return null!==(t=e$.get(e))&&void 0!==t&&t}function eH(e){let{editorActorSnapshot:t,slateEditorInstance:n}=e;return{blockIndexMap:n.blockIndexMap,context:{converters:[...t.context.converters],keyGenerator:t.context.keyGenerator,readOnly:t.matches({"edit mode":"read only"}),schema:t.context.schema,selection:t.context.selection,value:n.value},decoratorState:n.decoratorState}}let eX=W("plugin:withPortableTextMarkModel");function eZ(e){let[t,n]=e;return[t,n]}function eQ(e,t){let n=e,o=t,r=n.length,i=o.length;if(0===r||0===i)return 0;r>i?n=n.substring(r-i):r<i&&(o=o.substring(0,r));let a=Math.min(r,i);if(n===o)return a;let l=0,s=1;for(let e=0;-1!==e;){let t=n.substring(a-s);if(-1===(e=o.indexOf(t)))break;s+=e,(0===e||n.substring(a-s)===o.substring(0,s))&&(l=s,s++)}return l}function e0(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,o=Math.min(e.length,t.length),r=o,i=0;for(;n<r;)e.substring(i,r)===t.substring(i,r)?i=n=r:o=r,r=Math.floor((o-n)/2+n);return r}function e1(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,o=Math.min(e.length,t.length),r=o,i=0;for(;n<r;)e.substring(e.length-r,e.length-i)===t.substring(t.length-r,t.length-i)?i=n=r:o=r,r=Math.floor((o-n)/2+n);return r}function e2(e,t,n,o,r){let i=e.substring(0,n),a=t.substring(0,o),l=e.substring(n),s=t.substring(o),c=tt(i,a,{checkLines:!1,deadline:r}),d=tt(l,s,{checkLines:!1,deadline:r});return c.concat(d)}function e3(e,t,n){let o=e.slice(n,n+Math.floor(e.length/4)),r=-1,i="",a,l,s,c;for(;-1!==(r=t.indexOf(o,r+1));){let o=e0(e.slice(n),t.slice(r)),d=e1(e.slice(0,n),t.slice(0,r));i.length<d+o&&(i=t.slice(r-d,r)+t.slice(r,r+o),a=e.slice(0,n-d),l=e.slice(n+o),s=t.slice(0,r-d),c=t.slice(r+o))}return 2*i.length>=e.length?[a||"",l||"",s||"",c||"",i||""]:null}var e8=Object.defineProperty,e6=Object.getOwnPropertySymbols,e9=Object.prototype.hasOwnProperty,e4=Object.prototype.propertyIsEnumerable,e7=(e,t,n)=>t in e?e8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,e5=(e,t)=>{for(var n in t||(t={}))e9.call(t,n)&&e7(e,n,t[n]);if(e6)for(var n of e6(t))e4.call(t,n)&&e7(e,n,t[n]);return e};function te(e,t,n){var o,r;let i;if(null===e||null===t)throw Error("Null input. (diff)");let a=tt(e,t,e5({checkLines:!0,deadline:(r=(o=n||{}).timeout||1,i=1,"u">typeof r&&(i=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*i)},o));return function(e){for(let t=0;t<e.length;t++){let[n,o]=e[t];if(0===o.length)continue;let r=o[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(o[o.length-1])&&0===n&&tr(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&0===n&&tr(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(a),a}function tt(e,t,n){let o=e,r=t;if(o===r)return o?[[0,o]]:[];let i=e0(o,r),a=o.substring(0,i);i=e1(o=o.substring(i),r=r.substring(i));let l=o.substring(o.length-i),s=function(e,t,n){let o;if(!e)return[[1,t]];if(!t)return[[-1,e]];let r=e.length>t.length?e:t,i=e.length>t.length?t:e,a=r.indexOf(i);if(-1!==a)return o=[[1,r.substring(0,a)],[0,i],[1,r.substring(a+i.length)]],e.length>t.length&&(o[0][0]=-1,o[2][0]=-1),o;if(1===i.length)return[[-1,e],[1,t]];let l=function(e,t){let n,o,r,i,a,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(l<=0)return null;let s=e.length>t.length?e:t,c=e.length>t.length?t:e;if(s.length<4||2*c.length<s.length)return null;let d=e3(s,c,Math.ceil(s.length/4)),u=e3(s,c,Math.ceil(s.length/2));if(d&&u)n=d[4].length>u[4].length?d:u;else{if(!d&&!u)return null;u?d||(n=u):n=d}if(!n)throw Error("Unable to find a half match.");return e.length>t.length?(o=n[0],r=n[1],i=n[2],a=n[3]):(i=n[0],a=n[1],o=n[2],r=n[3]),[o,r,i,a,n[4]]}(e,t);if(l){let e=l[0],t=l[1],o=l[2],r=l[3],i=l[4],a=tt(e,o,n),s=tt(t,r,n);return a.concat([[0,i]],s)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let o=e,r=t,i=function(e,t){let n=[],o={};function r(e){let t="",r=0,a=-1,l=n.length;for(;a<e.length-1;){-1===(a=e.indexOf("\n",r))&&(a=e.length-1);let s=e.slice(r,a+1);(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(l===i&&(s=e.slice(r),a=e.length),t+=String.fromCharCode(l),o[s]=l,n[l++]=s),r=a+1}return t}n[0]="";let i=4e4,a=r(e);return i=65535,{chars1:a,chars2:r(t),lineArray:n}}(o,r);o=i.chars1,r=i.chars2;let a=i.lineArray,l=tt(o,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let o=e[n][1],r=[];for(let e=0;e<o.length;e++)r[e]=t[o.charCodeAt(e)];e[n][1]=r.join("")}})(l,a),(l=function(e){let t=e.map(e=>eZ(e)),n=!1,o=[],r=0,i=null,a=0,l=0,s=0,c=0,d=0;for(;a<t.length;)0===t[a][0]?(o[r++]=a,l=c,s=d,c=0,d=0,i=t[a][1]):(1===t[a][0]?c+=t[a][1].length:d+=t[a][1].length,i&&i.length<=Math.max(l,s)&&i.length<=Math.max(c,d)&&(t.splice(o[r-1],0,[-1,i]),t[o[r-1]+1][0]=1,r--,a=--r>0?o[r-1]:-1,l=0,s=0,c=0,d=0,i=null,n=!0)),a++;for(n&&(t=tu(t)),t=td(t),a=1;a<t.length;){if(-1===t[a-1][0]&&1===t[a][0]){let e=t[a-1][1],n=t[a][1],o=eQ(e,n),r=eQ(n,e);o>=r?(o>=e.length/2||o>=n.length/2)&&(t.splice(a,0,[0,n.substring(0,o)]),t[a-1][1]=e.substring(0,e.length-o),t[a+1][1]=n.substring(o),a++):(r>=e.length/2||r>=n.length/2)&&(t.splice(a,0,[0,e.substring(0,r)]),t[a-1][0]=1,t[a-1][1]=n.substring(0,n.length-r),t[a+1][0]=-1,t[a+1][1]=e.substring(r),a++),a++}a++}return t}(l)).push([0,""]);let s=0,c=0,d=0,u="",p="";for(;s<l.length;){switch(l[s][0]){case 1:d++,p+=l[s][1];break;case -1:c++,u+=l[s][1];break;case 0:if(c>=1&&d>=1){l.splice(s-c-d,c+d),s=s-c-d;let e=tt(u,p,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)l.splice(s,0,e[t]);s+=e.length}d=0,c=0,u="",p="";break;default:throw Error("Unknown diff operation.")}s++}return l.pop(),l}(e,t,n):function(e,t,n){let o=e.length,r=t.length,i=Math.ceil((o+r)/2),a=2*i,l=Array(a),s=Array(a);for(let e=0;e<a;e++)l[e]=-1,s[e]=-1;l[i+1]=0,s[i+1]=0;let c=o-r,d=c%2!=0,u=0,p=0,h=0,f=0;for(let y=0;y<i&&!(Date.now()>n);y++){for(let h=-y+u;h<=y-p;h+=2){let f;let g=i+h,v=(f=h===-y||h!==y&&l[g-1]<l[g+1]?l[g+1]:l[g-1]+1)-h;for(;f<o&&v<r&&e.charAt(f)===t.charAt(v);)f++,v++;if(l[g]=f,f>o)p+=2;else if(v>r)u+=2;else if(d){let r=i+c-h;if(r>=0&&r<a&&-1!==s[r]&&f>=o-s[r])return e2(e,t,f,v,n)}}for(let u=-y+h;u<=y-f;u+=2){let p;let g=i+u,v=(p=u===-y||u!==y&&s[g-1]<s[g+1]?s[g+1]:s[g-1]+1)-u;for(;p<o&&v<r&&e.charAt(o-p-1)===t.charAt(r-v-1);)p++,v++;if(s[g]=p,p>o)f+=2;else if(v>r)h+=2;else if(!d){let r=i+c-u;if(r>=0&&r<a&&-1!==l[r]){let a=l[r],s=i+a-r;if(a>=(p=o-p))return e2(e,t,a,s,n)}}}}return[[-1,e],[1,t]]}(e,t,n.deadline)}(o=o.substring(0,o.length-i),r=r.substring(0,r.length-i),n);return a&&s.unshift([0,a]),l&&s.push([0,l]),s=tu(s)}function tn(e,t,n){return 1===n?e+t:t+e}function to(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function tr(e,t,n){var o,r;let i=1===n?-1:1,a=null,l=null,s=t+n;for(;s>=0&&s<e.length&&(null===a||null===l);s+=n){let[o,r]=e[s];if(0!==r.length){if(1===o){null===a&&(a=s);continue}if(-1===o){null===l&&(l=s);continue}if(0===o){if(null===a&&null===l){let[o,r]=to(e[t][1],n);e[t][1]=o,e[s][1]=tn(e[s][1],r,i);return}break}}}if(null!==a&&null!==l&&(o=a,r=l,1===n?e[o][1][e[o][1].length-1]===e[r][1][e[r][1].length-1]:e[o][1][0]===e[r][1][0])){let[o,r]=to(e[a][1],i),[s]=to(e[l][1],i);e[a][1]=o,e[l][1]=s,e[t][1]=tn(e[t][1],r,n);return}let[c,d]=to(e[t][1],n);e[t][1]=c,null===a?(e.splice(s,0,[1,d]),null!==l&&l>=s&&l++):e[a][1]=tn(e[a][1],d,i),null===l?e.splice(s,0,[-1,d]):e[l][1]=tn(e[l][1],d,i)}let ti=/[^a-zA-Z0-9]/,ta=/\s/,tl=/[\r\n]/,ts=/\n\r?\n$/,tc=/^\r?\n\r?\n/;function td(e){let t=e.map(e=>eZ(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),o=t.charAt(0),r=n.match(ti),i=o.match(ti),a=r&&n.match(ta),l=i&&o.match(ta),s=a&&n.match(tl),c=l&&o.match(tl),d=s&&e.match(ts),u=c&&t.match(tc);return d||u?5:s||c?4:r&&!a&&l?3:a||l?2:r||i?1:0}let o=1;for(;o<t.length-1;){if(0===t[o-1][0]&&0===t[o+1][0]){let e=t[o-1][1],r=t[o][1],i=t[o+1][1],a=e1(e,r);if(a){let t=r.substring(r.length-a);e=e.substring(0,e.length-a),r=t+r.substring(0,r.length-a),i=t+i}let l=e,s=r,c=i,d=n(e,r)+n(r,i);for(;r.charAt(0)===i.charAt(0);){e+=r.charAt(0),r=r.substring(1)+i.charAt(0),i=i.substring(1);let t=n(e,r)+n(r,i);t>=d&&(d=t,l=e,s=r,c=i)}t[o-1][1]!==l&&(l?t[o-1][1]=l:(t.splice(o-1,1),o--),t[o][1]=s,c?t[o+1][1]=c:(t.splice(o+1,1),o--))}o++}return t}function tu(e){let t=e.map(e=>eZ(e));t.push([0,""]);let n=0,o=0,r=0,i="",a="",l;for(;n<t.length;)switch(t[n][0]){case 1:r++,a+=t[n][1],n++;break;case -1:o++,i+=t[n][1],n++;break;case 0:o+r>1?(0!==o&&0!==r&&(0!==(l=e0(a,i))&&(n-o-r>0&&0===t[n-o-r-1][0]?t[n-o-r-1][1]+=a.substring(0,l):(t.splice(0,0,[0,a.substring(0,l)]),n++),a=a.substring(l),i=i.substring(l)),0!==(l=e1(a,i))&&(t[n][1]=a.substring(a.length-l)+t[n][1],a=a.substring(0,a.length-l),i=i.substring(0,i.length-l))),n-=o+r,t.splice(n,o+r),i.length&&(t.splice(n,0,[-1,i]),n++),a.length&&(t.splice(n,0,[1,a]),n++),n++):0!==n&&0===t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,o=0,i="",a="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let s=!1;for(n=1;n<t.length-1;)0===t[n-1][0]&&0===t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),s=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),s=!0)),n++;return s&&(t=tu(t)),t}var tp=Object.defineProperty,th=Object.getOwnPropertySymbols,tf=Object.prototype.hasOwnProperty,ty=Object.prototype.propertyIsEnumerable,tg=(e,t,n)=>t in e?tp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tv=(e,t)=>{for(var n in t||(t={}))tf.call(t,n)&&tg(e,n,t[n]);if(th)for(var n of th(t))ty.call(t,n)&&tg(e,n,t[n]);return e};let tm={threshold:.5,distance:1e3};function tk(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===e||null===t||null===n)throw Error("Null input. (match())");let r=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(r,r+t.length)===t?r:function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>32)throw Error("Pattern too long for this browser.");let r=tv(tv({},tm),o),i=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function a(e,o){let i=e/t.length,a=Math.abs(n-o);return r.distance?i+a/r.distance:a?1:i}let l=r.threshold,s=e.indexOf(t,n);-1!==s&&(l=Math.min(a(0,s),l),-1!==(s=e.lastIndexOf(t,n+t.length))&&(l=Math.min(a(0,s),l)));let c=1<<t.length-1;s=-1;let d,u,p=t.length+e.length,h=[];for(let o=0;o<t.length;o++){for(d=0,u=p;d<u;)a(o,n+u)<=l?d=u:p=u,u=Math.floor((p-d)/2+d);p=u;let r=Math.max(1,n-u+1),f=Math.min(n+u,e.length)+t.length,y=Array(f+2);y[f+1]=(1<<o)-1;for(let t=f;t>=r;t--){let d=i[e.charAt(t-1)];if(0===o?y[t]=(y[t+1]<<1|1)&d:y[t]=(y[t+1]<<1|1)&d|((h[t+1]|h[t])<<1|1)|h[t+1],y[t]&c){let e=a(o,t-1);if(e<=l){if(l=e,(s=t-1)>n)r=Math.max(1,2*n-s);else break}}}if(a(o+1,n)>l)break;h=y}return s}(e,t,r,o):-1}function tb(e){let t=[];for(let n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function tx(e){let t=[];for(let n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function t_(e,t){let n=0,o=0,r=0,i=0,a;for(a=0;a<e.length&&(1!==e[a][0]&&(n+=e[a][1].length),-1!==e[a][0]&&(o+=e[a][1].length),!(n>t));a++)r=n,i=o;return e.length!==a&&-1===e[a][0]?i:i+(t-r)}function tE(e){let t=0;for(let n=0;n<e.length;n++){let o=e.codePointAt(n);if(typeof o>"u")throw Error("Failed to get codepoint");t+=tw(o)}return t}function tw(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function tS(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}let tO=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function tM(e){if(!e)return[];let t=[],n=e.split("\n"),o=0;for(;o<n.length;){let e=n[o].match(tO);if(!e)throw Error("Invalid patch string: ".concat(n[o]));let r=tS(tR(e[1]),tR(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=tR(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=tR(e[4]),r.length2=r.utf8Length2),o++;o<n.length;){let e;let t=n[o],i=t.charAt(0);if("@"===i)break;if(""===i){o++;continue}try{e=decodeURI(t.slice(1))}catch(e){throw Error("Illegal escape in parse: ".concat(t))}let a=tE(e)-e.length;if("-"===i)r.diffs.push([-1,e]),r.length1-=a;else if("+"===i)r.diffs.push([1,e]),r.length2-=a;else if(" "===i)r.diffs.push([0,e]),r.length1-=a,r.length2-=a;else throw Error('Invalid patch mode "'.concat(i,'" in: ').concat(e));o++}}return t}function tR(e){return parseInt(e,10)}let tA=new WeakMap;function tN(e){var t;return null===(t=tA.get(e))||void 0===t?void 0:t.undoStepId}let tI=W("plugin:withUndoRedo"),tT=new WeakMap,tB=new WeakMap,tC=e=>{let t=tT.get(e);return void 0===t||t},tj=e=>(tB.get(e)||tB.set(e,[]),tB.get(e)||[]);function tL(e,t,n,o,r){let i={...n};if("insert"===t.type&&1===t.path.length){let e=(o||[]).findIndex(e=>v({_key:e._key},t.path[0]));return tI("Adjusting block path (+".concat(t.items.length,") for '").concat(i.type,"' operation and patch '").concat(t.type,"'")),[tD(i,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let e=(r||[]).findIndex(e=>v({_key:e._key},t.path[0]));return"path"in i&&Array.isArray(i.path)&&i.path[0]===e?(tI("Skipping transformation that targeted removed block"),[]):[tD(i,-1,e)]}if("unset"===t.type&&0===t.path.length)return tI("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[];if("diffMatchPatch"===t.type){let n;let o=("set_selection"===i.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in i&&(n=e.children[i.path[0]]),n);return o&&v({_key:o._key},t.path[0])&&tM(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:o}=e;if(o.forEach((e,r)=>{let[i,a]=e;1===i?(t+=a.length,n+=a.length):-1===i?(t-=a.length,n-=a.length):0===i&&(o.slice(r).every(e=>{let[t]=e;return 0===t})||(n+=a.length))}),"insert_text"===i.type&&n<i.offset&&(i.offset+=t),"remove_text"===i.type&&n<=i.offset-i.text.length&&(i.offset+=t),"set_selection"===i.type){var r,a,l,s;let e=(null===(r=i.properties)||void 0===r?void 0:r.focus)?{...i.properties.focus}:void 0,o=(null==i?void 0:null===(a=i.properties)||void 0===a?void 0:a.anchor)?{...i.properties.anchor}:void 0,c=(null==i?void 0:null===(l=i.newProperties)||void 0===l?void 0:l.focus)?{...i.newProperties.focus}:void 0,d=(null==i?void 0:null===(s=i.newProperties)||void 0===s?void 0:s.anchor)?{...i.newProperties.anchor}:void 0;(e&&o||c&&d)&&([e,o,c,d].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&o&&(i.properties={focus:e,anchor:o}),c&&d&&(i.newProperties={focus:c,anchor:d}))}}),[i]}return[i]}function tD(e,t,n){let o={...e};if(n>=0&&"set_selection"!==o.type&&Array.isArray(o.path)&&o.path[0]>=n+t&&o.path[0]+t>-1){let e=[o.path[0]+t,...o.path.slice(1)];o.path=e}if("set_selection"===o.type){var r,i,a,l;let e=(null===(r=o.properties)||void 0===r?void 0:r.focus)?{...o.properties.focus}:void 0,s=(null==o?void 0:null===(i=o.properties)||void 0===i?void 0:i.anchor)?{...o.properties.anchor}:void 0,c=(null==o?void 0:null===(a=o.newProperties)||void 0===a?void 0:a.focus)?{...o.newProperties.focus}:void 0,d=(null==o?void 0:null===(l=o.newProperties)||void 0===l?void 0:l.anchor)?{...o.newProperties.anchor}:void 0;(e&&s||c&&d)&&([e,s,c,d].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&s&&(o.properties={focus:e,anchor:s}),c&&d&&(o.newProperties={focus:c,anchor:d}))}return o}let tY=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&u.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&u.y$.equals(e.path,t.path)),tU=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tz=e=>"set_selection"!==e.type;function tP(e,t){let n=tC(e);tT.set(e,!1),t(),tT.set(e,n)}let tG=e=>{let t,n,o,{context:r,operation:i}=e,a=(0,y.Qe)({annotation:{_type:i.annotation.name,...i.annotation.value},context:r,options:{refreshKeys:!1,validateFields:!0}});if(!a)throw Error("Failed to parse annotation ".concat(JSON.stringify(i.annotation)));let l=i.editor;if(!l.selection||u.e6.isCollapsed(l.selection))return;let s=[],c=u.ML.nodes(l,{at:l.selection,match:e=>l.isTextBlock(e),reverse:u.e6.isBackward(l.selection)}),d=0;for(let[e,t]of c){var p,h;if(0===e.children.length||1===e.children.length&&""===e.children[0].text)continue;let i=0===d?a._key:r.keyGenerator(),c=null!==(p=e.markDefs)&&void 0!==p?p:[];for(let[r,d]of(void 0===c.find(e=>e._type===a._type&&e._key===i)&&(u.YR.setNodes(l,{markDefs:[...c,{...a,_key:i}]},{at:t}),o=[{_key:e._key},"markDefs",{_key:i}],u.e6.isBackward(l.selection)?s.unshift(o):s.push(o)),u.YR.setNodes(l,{},{match:u.xv.isText,split:!0}),u.NB.children(l,t))){if(!l.isTextSpan(r)||!u.e6.includes(l.selection,d))continue;let t=null!==(h=r.marks)&&void 0!==h?h:[],o=t.filter(e=>c.some(t=>t._key===e&&t._type===a._type));u.YR.setNodes(l,{marks:[...t.filter(e=>!o.includes(e)),i]},{at:d}),n=[{_key:e._key},"children",{_key:r._key}]}d++}return o&&n&&(t={markDefPath:o,markDefPaths:s,spanPath:n}),t},tF={"annotation.add":tG,"annotation.remove":e=>{var t,n,o,r,i,a,l;let{operation:s}=e,c=s.editor;if(c.selection){if(u.e6.isCollapsed(c.selection)){let[e,a]=u.ML.node(c,c.selection,{depth:1});if(!c.isTextBlock(e))return;let l=(null!==(i=e.markDefs)&&void 0!==i?i:[]).filter(e=>e._type===s.annotation.name),[d,p]=u.ML.node(c,c.selection,{depth:2});if(!c.isTextSpan(d))return;let h=null===(t=d.marks)||void 0===t?void 0:t.find(e=>l.some(t=>t._key===e));if(!h)return;let f=[];for(let[e,t]of u.NB.children(c,a,{reverse:!0}))if(c.isTextSpan(e)&&u.y$.isBefore(t,p)){if(null===(n=e.marks)||void 0===n?void 0:n.includes(h))f.push([e,t]);else break}let y=[];for(let[e,t]of u.NB.children(c,a))if(c.isTextSpan(e)&&u.y$.isAfter(t,p)){if(null===(o=e.marks)||void 0===o?void 0:o.includes(h))y.push([e,t]);else break}for(let[e,t]of[...f,[d,p],...y])u.YR.setNodes(c,{marks:null===(r=e.marks)||void 0===r?void 0:r.filter(e=>e!==h)},{at:t})}else for(let[e,t]of(u.YR.setNodes(c,{},{match:e=>c.isTextSpan(e),split:!0,hanging:!0}),u.ML.nodes(c,{at:c.selection,match:e=>c.isTextBlock(e)})))for(let[n,o]of u.NB.children(c,t)){if(!c.isTextSpan(n)||!u.e6.includes(c.selection,o))continue;let t=null!==(a=e.markDefs)&&void 0!==a?a:[],r=null!==(l=n.marks)&&void 0!==l?l:[],i=r.filter(e=>{var n;return(null===(n=t.find(t=>t._key===e))||void 0===n?void 0:n._type)!==s.annotation.name});i.length!==r.length&&u.YR.setNodes(c,{marks:i},{at:o})}}},"block.set":e=>{var t,n;let{context:o,operation:r}=e,i=es({context:{schema:o.schema,value:r.editor.value,selection:{anchor:{path:r.at,offset:0},focus:{path:r.at,offset:0}}},blockIndexMap:r.editor.blockIndexMap});if(!i)throw Error("Unable to convert ".concat(JSON.stringify(r.at)," into a Slate Range"));let a=null===(t=u.ML.node(r.editor,i,{depth:1}))||void 0===t?void 0:t[0];if(!a)throw Error("Unable to find block at ".concat(JSON.stringify(r.at)));let l=H([a],o.schema.block.name,ep.get(r.editor)).at(0);if(!l)throw Error("Unable to parse block at ".concat(JSON.stringify(r.at)));let{_type:s,...c}=r.props,d=(0,y.IX)({context:o,block:{...l,...c},options:{refreshKeys:!1,validateFields:!0}});if(!d)throw Error("Unable to update block at ".concat(JSON.stringify(r.at)));let p=null===(n=q([d],{schemaTypes:o.schema}))||void 0===n?void 0:n.at(0);if(!p)throw Error("Unable to convert block to Slate value");u.YR.setNodes(r.editor,p,{at:i})},"block.unset":e=>{var t;let{context:n,operation:o}=e,r=es({context:{schema:n.schema,value:o.editor.value,selection:{anchor:{path:o.at,offset:0},focus:{path:o.at,offset:0}}},blockIndexMap:o.editor.blockIndexMap});if(!r)throw Error("Unable to convert ".concat(JSON.stringify(o.at)," into a Slate Range"));let i=null===(t=u.ML.node(o.editor,r,{depth:1}))||void 0===t?void 0:t[0];if(!i)throw Error("Unable to find block at ".concat(JSON.stringify(o.at)));let a=H([i],n.schema.block.name,ep.get(o.editor)).at(0);if(!a)throw Error("Unable to parse block at ".concat(JSON.stringify(o.at)));if((0,y.dz)(n,a)){let e=o.props.filter(e=>"_type"!==e),t=(0,y.IX)({context:n,block:B(a,e),options:{refreshKeys:!1,validateFields:!0}});if(!t)throw Error("Unable to update block at ".concat(JSON.stringify(o.at)));let i={};for(let n of e)n in t?i[n]=t[n]:i[n]=void 0;u.YR.setNodes(o.editor,i,{at:r});return}let l=(0,y.IX)({context:n,block:B(a,o.props.filter(e=>"_type"!==e)),options:{refreshKeys:!1,validateFields:!0}});if(!l)throw Error("Unable to update block at ".concat(JSON.stringify(o.at)));let{_type:s,_key:c,...d}=l;u.YR.setNodes(o.editor,{_type:s,_key:c,value:d},{at:r})},"child.set":e=>{let{context:t,operation:n}=e,o=es({context:{schema:t.schema,value:n.editor.value,selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}},blockIndexMap:n.editor.blockIndexMap});if(!o)throw Error("Unable to convert ".concat(JSON.stringify(n.at)," into a Slate Range"));let r=u.ML.node(n.editor,o,{depth:2}),i=null==r?void 0:r[0],a=null==r?void 0:r[1];if(!i||!a)throw Error("Unable to find child at ".concat(JSON.stringify(n.at)));if(n.editor.isTextSpan(i)){let{_type:e,text:t,...o}=n.props;u.YR.setNodes(n.editor,{...i,...o},{at:a}),"string"==typeof t&&i.text!==t&&(n.editor.apply({type:"remove_text",path:a,offset:0,text:i.text}),n.editor.apply({type:"insert_text",path:a,offset:0,text:t}));return}if(u.W_.isElement(i)){let e=t.schema.inlineObjects.find(e=>e.name===i._type);if(!e)throw Error("Unable to find schema definition for Inline Object type ".concat(i._type));let o="value"in i&&"object"==typeof i.value?i.value:{},{_type:r,_key:l,...s}=n.props;for(let t in s)e.fields.some(e=>e.name===t)||delete s[t];u.YR.setNodes(n.editor,{...i,_key:"string"==typeof l?l:i._key,value:{...o,...s}},{at:a});return}throw Error("Unable to determine the type of child at ".concat(JSON.stringify(n.at)))},"child.unset":e=>{let{context:t,operation:n}=e,o=es({context:{schema:t.schema,value:n.editor.value,selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}},blockIndexMap:n.editor.blockIndexMap});if(!o)throw Error("Unable to convert ".concat(JSON.stringify(n.at)," into a Slate Range"));let r=u.ML.node(n.editor,o,{depth:2}),i=null==r?void 0:r[0],a=null==r?void 0:r[1];if(!i||!a)throw Error("Unable to find child at ".concat(JSON.stringify(n.at)));if(n.editor.isTextSpan(i)){n.props.includes("text")&&n.editor.apply({type:"remove_text",path:a,offset:0,text:i.text});let e={};for(let o of n.props)if("_type"!==o){if("_key"===o){e._key=t.keyGenerator();continue}e[o]=null}u.YR.setNodes(n.editor,e,{at:a});return}if(u.W_.isElement(i)){let e="value"in i&&"object"==typeof i.value?i.value:{},o=n.props.map(e=>({type:"unset",path:[e]})),r=(0,C.g7)(e,o);u.YR.setNodes(n.editor,{...i,_key:n.props.includes("_key")?t.keyGenerator():i._key,value:r},{at:a});return}throw Error("Unable to determine the type of child at ".concat(JSON.stringify(n.at)))},"decorator.add":e=>{var t,n,o,r,i;let{context:a,operation:l}=e,s=l.editor,c=l.decorator,d=H(s.children,a.schema.block.name,ep.get(s)),p=(null===(t=l.at)||void 0===t?void 0:t.anchor)?(0,y.MR)({context:{...a,value:d},blockOffset:l.at.anchor,direction:"backward"}):void 0,h=(null===(n=l.at)||void 0===n?void 0:n.focus)?(0,y.MR)({context:{...a,value:d},blockOffset:l.at.focus,direction:"forward"}):void 0,f=p&&h?{anchor:p,focus:h}:void 0,g=f&&null!==(o=es({context:{schema:a.schema,value:l.editor.value,selection:f},blockIndexMap:l.editor.blockIndexMap}))&&void 0!==o?o:s.selection;if(!g)return;let v=ei({schema:a.schema,editor:s,range:g}),m=v?(0,L.W)({context:{...a,value:d},selectionPoint:v.anchor}):void 0,b=v?(0,L.W)({context:{...a,value:d},selectionPoint:v.focus}):void 0;if(!m||!b)throw Error("Unable to find anchor or focus offset");if(u.e6.isExpanded(g)){u.YR.setNodes(s,{},{at:g,match:u.xv.isText,split:!0,hanging:!0});let e=H(s.children,a.schema.block.name,ep.get(s)),t=(0,j.iO)({context:{...a,value:e},offsets:{anchor:m,focus:b},backward:null==v?void 0:v.backward}),n=(0,k.Vj)({blockIndexMap:s.blockIndexMap,context:{converters:[],keyGenerator:a.keyGenerator,readOnly:!1,schema:a.schema,selection:t,value:e},decoratorState:s.decoratorState});if(!n)throw Error("Unable to find trimmed selection");let o=es({context:{schema:a.schema,value:l.editor.value,selection:n},blockIndexMap:l.editor.blockIndexMap});if(!o)throw Error("Unable to find new selection");for(let[e,t]of u.e6.isRange(o)?[...u.ML.nodes(s,{at:o,match:e=>u.xv.isText(e)})]:[]){let n=[...(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==c),c];u.YR.setNodes(s,{marks:n},{at:t,match:u.xv.isText,split:!0,hanging:!0})}}else{if(!(null===(r=Array.from(u.ML.nodes(s,{at:g,match:e=>s.isTextSpan(e)})))||void 0===r?void 0:r.at(0)))return;let[e,t]=u.ML.node(s,g,{depth:1}),n=s.isTextBlock(e)&&1===e.children.length&&s.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(n){let e=null!==(i=n.marks)&&void 0!==i?i:[],o=e.filter(e=>e!==c);u.YR.setNodes(s,{marks:e.length===o.length?[...e,c]:o},{at:t,match:e=>s.isTextSpan(e)})}else s.decoratorState[c]=!0}if(s.selection){let e=s.selection;s.selection={...e}}},"decorator.remove":e=>{let{operation:t}=e,n=t.editor,o=t.decorator,{selection:r}=n;if(r){if(u.e6.isExpanded(r))u.YR.setNodes(n,{},{match:u.xv.isText,split:!0,hanging:!0}),n.selection&&[...u.ML.nodes(n,{at:n.selection,match:u.xv.isText})].forEach(e=>{let[t,r]=e,i=n.children[r[0]];u.W_.isElement(i)&&i.children.includes(t)&&u.YR.setNodes(n,{marks:(Array.isArray(t.marks)?t.marks:[]).filter(e=>e!==o),_type:"span"},{at:r})});else{let[e,t]=u.ML.node(n,r,{depth:1}),a=n.isTextBlock(e)&&1===e.children.length&&n.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(a){var i;let e=(null!==(i=a.marks)&&void 0!==i?i:[]).filter(e=>e!==o);u.YR.setNodes(n,{marks:e},{at:t,match:e=>n.isTextSpan(e)})}else n.decoratorState[o]=!1}if(n.selection){let e=n.selection;n.selection={...e}}}},delete:e=>{let{context:t,operation:n}=e,o=(0,y.Ak)(n.at.anchor),r=(0,y.Ak)(n.at.focus),i=n.at.backward?o:r,a=n.at.backward?n.at.focus.offset:n.at.anchor.offset;if(!i)throw Error("Failed to get end block key");let l=n.editor.blockIndexMap.get(i);if(void 0===l)throw Error("Failed to get end block index");let s=n.editor.value.at(l);if(!s)throw Error("Failed to get end block");let c=void 0!==o?Z({editor:n.editor,_key:o}):void 0,d=void 0!==r?Z({editor:n.editor,_key:r}):void 0;if(1===n.at.anchor.path.length&&1===n.at.focus.path.length&&c&&d&&c[0]===d[0]){u.YR.removeNodes(n.editor,{at:[c[0]]}),0===n.editor.children.length&&u.YR.insertNodes(n.editor,eU(t));return}let p=es({context:{schema:t.schema,value:n.editor.value,selection:n.at},blockIndexMap:n.editor.blockIndexMap});if(!p)throw Error("Failed to get Slate Range for selection ".concat(JSON.stringify(n.at)));let h=(0,y.dz)(t,s)&&0===a;n.editor.delete({at:p,reverse:"backward"===n.direction,unit:n.unit,hanging:h})},"history.redo":e=>{let{operation:t}=e,n=t.editor,{redos:o}=n.history,r=tj(n);if(o.length>0){let e=o[o.length-1];if(tI("Redoing",e),e.operations.length>0){let t=r.filter(t=>t.time>=e.timestamp),o=e.operations;t.forEach(e=>{o=T(o.map(t=>tL(n,e.patch,t,e.snapshot,e.previousSnapshot)))});try{u.ML.withoutNormalizing(n,()=>{!function(e,t){let n=eq(e);e$.set(e,!0),t(),e$.set(e,n)}(n,()=>{tP(n,()=>{o.forEach(e=>{n.apply(e)})})})})}catch(e){tI("Could not perform redo step",e),r.splice(0,r.length),u.YR.deselect(n),n.history={undos:[],redos:[]},tT.set(n,!0),e$.set(n,!1),n.onChange();return}n.history.undos.push(e),n.history.redos.pop()}}},"history.undo":e=>{let{operation:t}=e,n=t.editor,{undos:o}=n.history,r=tj(n);if(o.length>0){let e=o[o.length-1];if(tI("Undoing",e),e.operations.length>0){let t=r.filter(t=>t.time>=e.timestamp),o=e.operations;t.forEach(e=>{o=T(o.map(t=>tL(n,e.patch,t,e.snapshot,e.previousSnapshot)))});let i=o.map(u.OX.inverse).reverse();try{u.ML.withoutNormalizing(n,()=>{!function(e,t){let n=eJ(e);eW.set(e,!0),t(),eW.set(e,n)}(n,()=>{tP(n,()=>{i.forEach(e=>{n.apply(e)})})})})}catch(e){tI("Could not perform undo step",e),r.splice(0,r.length),u.YR.deselect(n),n.history={undos:[],redos:[]},tT.set(n,!0),eW.set(n,!1),n.onChange();return}n.history.redos.push(e),n.history.undos.pop()}}},"insert.block":e=>{var t;let{context:n,operation:o}=e,r=(0,y.IX)({block:o.block,context:n,options:{refreshKeys:!1,validateFields:!0}});if(!r)throw Error("Failed to parse block ".concat(JSON.stringify(o.block)));let i=q([r],{schemaTypes:n.schema})[0];if(!i)throw Error("Failed to convert block to Slate fragment ".concat(JSON.stringify(r)));!function(e){let{block:t,placement:n,select:o,editor:r,schema:i}=e,[a,l]=function(e){let{editor:t}=e;if(!t.selection)return[void 0,void 0];let n=u.e6.start(t.selection);return ee({editor:t,point:n})}({editor:r}),[s,c]=function(e){let{editor:t}=e;if(!t.selection)return[void 0,void 0];let n=u.e6.end(t.selection);return ee({editor:t,point:n})}({editor:r});if(r.selection&&a&&l&&s&&c){if("before"===n){let e=r.selection,n=u.e6.start(e);u.YR.insertNodes(r,[t],{at:[n.path[0]],select:!1}),"start"===o?u.YR.select(r,u.ML.start(r,[n.path[0]])):"end"===o&&u.YR.select(r,u.ML.end(r,[n.path[0]]))}else if("after"===n){let e=r.selection,n=[u.e6.end(e).path[0]+1];u.YR.insertNodes(r,[t],{at:n,select:!1}),"start"===o?u.YR.select(r,u.ML.start(r,n)):"end"===o&&u.YR.select(r,u.ML.end(r,n))}else{let e=r.selection,n=u.ML.start(r,c);if(u.e6.isExpanded(e)&&!r.isTextBlock(t)){u.YR.delete(r,{at:e});let n=r.selection,[a,l]=Q({editor:r});u.YR.insertNodes(r,[t],{voids:!0});let s=0===n.anchor.offset?u.e6.transform(n,{type:"insert_node",node:t,path:[n.anchor.path[0]]}):n;"none"===o&&s&&u.YR.select(r,s),a&&X([a],i)&&u.YR.removeNodes(r,{at:l});return}if(r.isTextBlock(s)&&r.isTextBlock(t)){var d,p;let a=u.e6.start(e);if(X([s],i)){let e=r.selection;u.YR.insertNodes(r,[t],{at:c,select:!1}),u.YR.removeNodes(r,{at:u.y$.next(c)}),"start"===o?u.YR.select(r,a):"end"===o?u.YR.select(r,u.ML.end(r,c)):u.YR.select(r,e);return}if(u.YR.setNodes(r,{markDefs:[...null!==(d=s.markDefs)&&void 0!==d?d:[],...null!==(p=t.markDefs)&&void 0!==p?p:[]]},{at:c}),"end"===o){u.YR.insertFragment(r,[t],{voids:!0});return}u.YR.insertFragment(r,[t],{at:e,voids:!0}),"start"===o?u.YR.select(r,a):u.E9.equals(a,n)||u.YR.select(r,a)}else if(r.isTextBlock(s)){let n=u.ML.start(r,c),a=u.ML.end(r,c),l=u.e6.start(e),d=u.e6.end(e);if(u.e6.isCollapsed(e)&&u.E9.equals(l,n))u.YR.insertNodes(r,[t],{at:c,select:!1}),("start"===o||"end"===o)&&u.YR.select(r,u.ML.start(r,c)),(0,g.PF)({schema:i},s)&&u.YR.removeNodes(r,{at:u.y$.next(c)});else if(u.e6.isCollapsed(e)&&u.E9.equals(d,a)){let e=[c[0]+1];u.YR.insertNodes(r,[t],{at:e,select:!1}),("start"===o||"end"===o)&&u.YR.select(r,u.ML.start(r,e))}else if(u.e6.isExpanded(e)&&u.E9.equals(l,n)&&u.E9.equals(d,a))u.YR.insertFragment(r,[t],{at:e}),"start"===o?u.YR.select(r,u.ML.start(r,c)):"end"===o&&u.YR.select(r,u.ML.end(r,c));else if(u.e6.isExpanded(e)&&u.E9.equals(l,n))u.YR.insertFragment(r,[t],{at:e}),"start"===o?u.YR.select(r,u.ML.start(r,c)):"end"===o&&u.YR.select(r,u.ML.end(r,c));else if(u.e6.isExpanded(e)&&u.E9.equals(d,a))u.YR.insertFragment(r,[t],{at:e}),"start"===o?u.YR.select(r,u.ML.start(r,u.y$.next(c))):"end"===o&&u.YR.select(r,u.ML.end(r,u.y$.next(c)));else{let e=r.selection,[n]=function(e){var t;let{editor:n}=e,[o,r]=Q({editor:n}),i=null===(t=n.selection)||void 0===t?void 0:t.focus.path.at(1);if(!o||!r||void 0===i)return[void 0,void 0];try{let e=u.NB.child(o,i);return e?[e,[...r,i]]:[void 0,void 0]}catch(e){return[void 0,void 0]}}({editor:r});if(n&&r.isTextSpan(n))u.YR.splitNodes(r,{at:e}),u.YR.insertFragment(r,[t],{at:e}),"start"===o||"end"===o?u.YR.select(r,[c[0]+1]):u.YR.select(r,e);else{let n=[c[0]+1];u.YR.insertNodes(r,[t],{at:n,select:!1}),u.YR.select(r,e),"start"===o?u.YR.select(r,u.ML.start(r,n)):"end"===o&&u.YR.select(r,u.ML.end(r,n))}}}else{u.YR.insertNodes(r,[t],{select:!1});let e=[c[0]+1];"start"===o?u.YR.select(r,u.ML.start(r,e)):"end"===o&&u.YR.select(r,u.ML.end(r,e))}}}else{"none"!==o&&f.y2.focus(r);let[e,a]=en({editor:r});if("before"===n)u.YR.insertNodes(r,[t],{at:[0]}),"start"===o?u.YR.select(r,u.ML.start(r,[0])):"end"===o&&u.YR.select(r,u.ML.end(r,[0]));else if("after"===n){let e=a?[a[0]+1]:[0];u.YR.insertNodes(r,[t],{at:e}),"start"===o?u.YR.select(r,u.ML.start(r,e)):"end"===o&&u.YR.select(r,u.ML.end(r,e))}else{if(e&&X([e],i)){u.YR.removeNodes(r,{at:a}),u.YR.insertNodes(r,[t],{at:a,select:!1}),u.YR.deselect(r),"start"===o?u.YR.select(r,u.ML.start(r,a)):"end"===o&&u.YR.select(r,u.ML.end(r,a));return}if(r.isTextBlock(t)&&e&&r.isTextBlock(e)){let e=u.ML.end(r,a);u.YR.insertFragment(r,[t],{at:u.ML.end(r,a)}),"start"===o?u.YR.select(r,e):"none"===o&&u.YR.deselect(r);return}let n=a?[a[0]+1]:[0];u.YR.insertNodes(r,[t],{at:n,select:!1}),"start"===o?u.YR.select(r,u.ML.start(r,n)):"end"===o&&u.YR.select(r,u.ML.end(r,n))}}}({block:i,placement:o.placement,select:null!==(t=o.select)&&void 0!==t?t:"start",editor:o.editor,schema:n.schema})},"insert.inline object":e=>{var t,n,o;let{context:r,operation:i}=e,a=(0,y.Kw)({context:r,inlineObject:{_type:i.inlineObject.name,...null!==(n=i.inlineObject.value)&&void 0!==n?n:{}},options:{refreshKeys:!1,validateFields:!0}});if(!a)throw Error("Failed to parse inline object ".concat(JSON.stringify(i.inlineObject)));if(!i.editor.selection){console.error("Unable to insert inline object without selection");return}let[l]=null!==(o=Array.from(u.ML.nodes(i.editor,{at:i.editor.selection.focus.path,match:e=>i.editor.isTextBlock(e)})).at(0))&&void 0!==o?o:[void 0,void 0];if(!l){console.error("Unable to perform action without focus text block");return}let s=null===(t=q([{_type:r.schema.block.name,_key:r.keyGenerator(),children:[a]}],{schemaTypes:r.schema}).at(0))||void 0===t?void 0:t.children.at(0);if(!s){console.error("Unable to insert inline object");return}u.YR.insertNodes(i.editor,s)},"insert.span":e=>{var t,n,o,r;let{context:i,operation:a}=e;if(!a.editor.selection){console.error("Unable to perform action without selection",a);return}let[l,s]=null!==(t=Array.from(u.ML.nodes(a.editor,{at:a.editor.selection.focus.path,match:e=>a.editor.isTextBlock(e)}))[0])&&void 0!==t?t:[void 0,void 0];if(!l||!s){console.error("Unable to perform action without focus block",a);return}let c=null!==(n=l.markDefs)&&void 0!==n?n:[],d=a.annotations?a.annotations.map(e=>({_type:e.name,_key:i.keyGenerator(),...e.value})):void 0;d&&d.length>0&&u.YR.setNodes(a.editor,{markDefs:[...c,...d]}),u.YR.insertNodes(a.editor,{_type:"span",_key:i.keyGenerator(),text:a.text,marks:[...null!==(o=null==d?void 0:d.map(e=>e._key))&&void 0!==o?o:[],...null!==(r=a.decorators)&&void 0!==r?r:[]]})},"insert.text":ez,"move.backward":e=>{let{operation:t}=e;u.YR.move(t.editor,{unit:"character",distance:t.distance,reverse:!0})},"move.block":e=>{let{operation:t}=e,n=(0,y.Ak)({path:t.at});if(!n)throw Error("Failed to get block key from selection point");let o=t.editor.blockIndexMap.get(n);if(void 0===o)throw Error("Failed to get block index from block key");let r=(0,y.Ak)({path:t.to});if(!r)throw Error("Failed to get block key from selection point");let i=t.editor.blockIndexMap.get(r);if(void 0===i)throw Error("Failed to get block index from block key");u.YR.moveNodes(t.editor,{at:[o],to:[i],mode:"highest"})},"move.forward":e=>{let{operation:t}=e;u.YR.move(t.editor,{unit:"character",distance:t.distance})},select:e=>{let{context:t,operation:n}=e,o=es({context:{schema:t.schema,value:n.editor.value,selection:n.at},blockIndexMap:n.editor.blockIndexMap});o?u.YR.select(n.editor,o):u.YR.deselect(n.editor)}};function tK(e){let{context:t,operation:n}=e;try{switch(n.type){case"annotation.add":tF["annotation.add"]({context:t,operation:n});break;case"annotation.remove":tF["annotation.remove"]({context:t,operation:n});break;case"block.set":tF["block.set"]({context:t,operation:n});break;case"block.unset":tF["block.unset"]({context:t,operation:n});break;case"child.set":tF["child.set"]({context:t,operation:n});break;case"child.unset":tF["child.unset"]({context:t,operation:n});break;case"decorator.add":tF["decorator.add"]({context:t,operation:n});break;case"decorator.remove":tF["decorator.remove"]({context:t,operation:n});break;case"delete":tF.delete({context:t,operation:n});break;case"history.redo":tF["history.redo"]({context:t,operation:n});break;case"history.undo":tF["history.undo"]({context:t,operation:n});break;case"insert.block":tF["insert.block"]({context:t,operation:n});break;case"insert.inline object":tF["insert.inline object"]({context:t,operation:n});break;case"insert.span":tF["insert.span"]({context:t,operation:n});break;case"insert.text":tF["insert.text"]({context:t,operation:n});break;case"move.backward":tF["move.backward"]({context:t,operation:n});break;case"move.block":tF["move.block"]({context:t,operation:n});break;case"move.forward":tF["move.forward"]({context:t,operation:n});break;default:tF.select({context:t,operation:n})}}catch(e){console.error(Error('Executing "'.concat(n.type,'" failed due to: ').concat(e.message)))}}let tV=new WeakMap;function tW(e,t){tV.set(e,ek()),u.ML.withoutNormalizing(e,t),tV.set(e,void 0)}function t$(e){return void 0!==tV.get(e)}function tJ(e,t){let n=-1,o=e.find((e,o)=>{let r=(0,y.eD)(t[0])?e._key===t[0]._key:o===t[0];return r&&(n=o),r});if(o)return{node:o,index:n}}function tq(e,t){let n=e.node;if(!u.W_.isElement(n)||"children"!==t[1])return;let o=-1,r=n.children.find((e,n)=>{let r=(0,y.eD)(t[2])?e._key===t[2]._key:n===t[2];return r&&(o=n),r});if(r)return{node:r,index:o}}let tH=new WeakMap;function tX(e,t){let n=tH.get(e);tH.set(e,!1),t(),tH.set(e,n)}let tZ=W("plugin:withPatches"),tQ=W("plugin:withPlaceholderBlock"),t0=W("plugin:withSchemaTypes");function t1(e){return"object"==typeof e&&null!==e&&!("_type"in e)&&"children"in e&&Array.isArray(e.children)}function t2(e,t){return(0,y.ay)(t)&&t._type===e.schema.block.name}function t3(e,t){return"object"==typeof t&&null!==t&&!("children"in t)&&("_type"in t?t._type===e.schema.span.name:"text"in t)}function t8(e){return"object"==typeof e&&null!==e&&"text"in e&&"string"==typeof e.text}function t6(e,t){let n=t.at(0);if(!(void 0===n||1!==t.length))return e.children.at(n)}function t9(e,t,n){if(0===n.length)return t;if(1===n.length)return t6(t,n);if(2===n.length){let o=t6(t,n.slice(0,1));return o&&t2(e,o)&&o.children.at(n[1])||void 0}}function t4(e,t,n){let o=t9(e,t,n);if(o&&t3(e,o))return o}function t7(e,t,n){if(0===n.length)return;let o=n.slice(0,-1);if(0===o.length)return t;let r=o.at(0);if(void 0===r||1!==o.length)return;let i=t.children.at(r);if(i&&t2(e,i))return i}let t5=(e,t)=>{let{editorActor:n,relayActor:o}=t,r=function(e){let{editorActor:t}=e;return function(e){e.isTextBlock=e=>!u.ML.isEditor(e)&&(0,y.dz)(t.getSnapshot().context,e),e.isTextSpan=e=>!u.ML.isEditor(e)&&(0,y.dn)(t.getSnapshot().context,e),e.isListBlock=e=>!u.ML.isEditor(e)&&(0,y.cd)(t.getSnapshot().context,e),e.isVoid=e=>!u.ML.isEditor(e)&&t.getSnapshot().context.schema.block.name!==e._type&&(t.getSnapshot().context.schema.blockObjects.map(e=>e.name).includes(e._type)||t.getSnapshot().context.schema.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>!u.ML.isEditor(e)&&t.getSnapshot().context.schema.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:n}=e;return e.normalizeNode=o=>{let[r,i]=o;if(void 0===r._type&&2===i.length){t0("Setting span type on text node without a type");let n=r._key||t.getSnapshot().context.keyGenerator();t.send({type:"normalizing"}),u.YR.setNodes(e,{...r,_type:t.getSnapshot().context.schema.span.name,_key:n},{at:i}),t.send({type:"done normalizing"});return}if(void 0===r._key&&(1===i.length||2===i.length)){t0("Setting missing key on child node without a key");let n=t.getSnapshot().context.keyGenerator();t.send({type:"normalizing"}),u.YR.setNodes(e,{_key:n},{at:i}),t.send({type:"done normalizing"});return}n(o)},e}}({editorActor:n}),i=function(e){var t;let n,{editorActor:o,relayActor:r,subscriptions:i}=e,a=(t=o.getSnapshot().context.schema,(e,n)=>{let o=!1;try{switch(n.type){case"insert":o=function(e,t,n){let o=tJ(e.children,t.path);if(!o||t.path.length>1&&"children"!==t.path[1])return!1;if(1===t.path.length){let{items:r,position:i}=t,a=q(r,{schemaTypes:n},eu.get(e)),l=o.index,s="after"===i?l+1:l,c=X(e.children,n);return u.YR.insertNodes(e,a,{at:[s]}),c&&"number"==typeof t.path[0]&&0===t.path[0]&&u.YR.removeNodes(e,{at:["before"===i?l+1:l]}),!0}let{items:r,position:i}=t,a=tq(o,t.path);if(!a)return!1;let l=q([{...o.node,children:r}],{schemaTypes:n},eu.get(e)),s="after"===i?a.index+1:a.index,c=[o.index,s];return l&&u.W_.isElement(l[0])&&u.YR.insertNodes(e,l[0].children,{at:c}),!0}(e,n,t);break;case"unset":o=function(e,t){if(0===t.path.length){let t=e.selection;for(let[t,n]of(u.YR.deselect(e),u.NB.children(e,[],{reverse:!0})))u.YR.removeNodes(e,{at:n});return u.YR.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&u.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),!0}let n=tJ(e.children,t.path);if(!n)return!1;if(1===t.path.length){if(1===e.children.length){let t=e.selection;return u.YR.deselect(e),u.YR.removeNodes(e,{at:[n.index]}),u.YR.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&u.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),!0}return u.YR.removeNodes(e,{at:[n.index]}),!0}let o=tq(n,t.path);if(e.isTextBlock(n.node)&&o&&"children"===t.path[1]&&3===t.path.length)return u.YR.removeNodes(e,{at:[n.index,o.index]}),!0;if(o&&!u.xv.isText(o.node)){let r=t.path.slice(3).at(0);if(void 0===r||"string"==typeof r&&["_key","_type","children","__inline"].includes(r))return!1;let i="value"in o.node&&"object"==typeof o.node.value?o.node.value:{},a=(0,C.g7)(i,[{...t,path:t.path.slice(3)}]);return u.YR.setNodes(e,{...o.node,value:a},{at:[n.index,o.index]}),!0}if(o&&u.xv.isText(o.node)){let r=t.path.slice(3),i=r.at(0);if(void 0===i||"string"==typeof i&&["_key","_type"].includes(i))return!1;if("string"==typeof i&&"text"===i)return e.apply({type:"remove_text",path:[n.index,o.index],offset:0,text:o.node.text}),!0;let a=Object.keys((0,C.g7)(o.node,[{...t,path:r}])),l=Object.keys(o.node).filter(e=>!a.includes(e));return u.YR.unsetNodes(e,l,{at:[n.index,o.index]}),!0}if(!o&&"value"in n.node){let o=(0,C.g7)(n.node.value,[{...t,path:t.path.slice(1)}]);return u.YR.setNodes(e,{...n.node,value:o},{at:[n.index]}),!0}return!1}(e,n);break;case"set":o=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let o=tJ(e.children,t.path);if(!o)return!1;let r=e.isTextBlock(o.node);if(r&&t.path.length>1&&"children"!==t.path[1])return!1;let i=tq(o,t.path);if(r&&i){if(u.xv.isText(i.node)){if(u.xv.isText(n)){let t=i.node.text,r=n.text;t!==r&&(e.apply({type:"remove_text",path:[o.index,i.index],offset:0,text:t}),e.apply({type:"insert_text",path:[o.index,i.index],offset:0,text:r}),e.onChange())}else{let n=t.path.slice(3),r=n.at(0);if(void 0===r||"string"==typeof r&&["_key","_type","text"].includes(r))return!1;let a=(0,C.g7)(i.node,[{...t,path:n}]);u.YR.setNodes(e,a,{at:[o.index,i.index]})}}else{let n=t.path.slice(3).at(0);if(void 0===n||"string"==typeof n&&["_key","_type","children","__inline"].includes(n))return!1;let r="value"in i.node&&"object"==typeof i.node.value?i.node.value:{},a=(0,C.g7)(r,[{...t,path:t.path.slice(3)}]);u.YR.setNodes(e,{...i.node,value:a},{at:[o.index,i.index]})}}else if(u.W_.isElement(o.node)&&1===t.path.length){let{children:t,...r}=n,{children:i,...a}=o.node||{children:void 0};e.apply({type:"set_node",path:[o.index],properties:{...a},newProperties:r});let l=o.node;l.children.forEach((t,n)=>{e.apply({type:"remove_node",path:[o.index,l.children.length-1-n],node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:[o.index,n],node:t})})}else if(o&&"value"in o.node){if(!(t.path.length>1)||"children"===t.path[1])return!1;{let n=(0,C.g7)(o.node.value,[{...t,path:t.path.slice(1)}]);u.YR.setNodes(e,{...o.node,value:n},{at:[o.index]})}}return!0}(e,n);break;case"diffMatchPatch":o=function(e,t){let n=tJ(e.children,t.path);if(!n)return!1;let o=tq(n,t.path);if(!o||!(n&&e.isTextBlock(n.node)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!u.xv.isText(o.node))return!1;let[r]=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let o=t;if(0===e.length)return[o,[]];let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=0,r=0;function i(e){for(;o<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;o+=tw(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&o!==e)throw Error("Failed to determine byte offset");return r}let a=[];for(let t of e)a.push({diffs:t.diffs.map(e=>eZ(e)),start1:i(t.start1),start2:i(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return a}(e,o,{allowExceedingIndices:n.allowExceedingIndices}),i=n.margin||4,a=n.deleteThreshold||.4,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let o=e[0],r=o.diffs;if(0===r.length||0!==r[0][0])r.unshift([0,n]),o.start1-=t,o.start2-=t,o.utf8Start1-=t,o.utf8Start2-=t,o.length1+=t,o.length2+=t,o.utf8Length1+=t,o.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,i=t-e;r[0][1]=n.substring(e)+r[0][1],o.start1-=i,o.start2-=i,o.utf8Start1-=i,o.utf8Start2-=i,o.length1+=i,o.length2+=i,o.utf8Length1+=i,o.utf8Length2+=i}if(0===(r=(o=e[e.length-1]).diffs).length||0!==r[r.length-1][0])r.push([0,n]),o.length1+=t,o.length2+=t,o.utf8Length1+=t,o.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),o.length1+=e,o.length2+=e,o.utf8Length1+=e,o.utf8Length2+=e}return n}(r,i);o=l+o+l,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let o=e[n];e.splice(n--,1);let r=o.start1,i=o.start2,a="";for(;0!==o.diffs.length;){let l=tS(r-a.length,i-a.length),s=!0;if(""!==a){let e=tE(a);l.length1=a.length,l.utf8Length1=e,l.length2=a.length,l.utf8Length2=e,l.diffs.push([0,a])}for(;0!==o.diffs.length&&l.length1<32-t;){let e=o.diffs[0][0],n=o.diffs[0][1],a=tE(n);if(1===e){l.length2+=n.length,l.utf8Length2+=a,i+=n.length;let e=o.diffs.shift();e&&l.diffs.push(e),s=!1}else -1===e&&1===l.diffs.length&&0===l.diffs[0][0]&&n.length>64?(l.length1+=n.length,l.utf8Length1+=a,r+=n.length,s=!1,l.diffs.push([e,n]),o.diffs.shift()):(a=tE(n=n.substring(0,32-l.length1-t)),l.length1+=n.length,l.utf8Length1+=a,r+=n.length,0===e?(l.length2+=n.length,l.utf8Length2+=a,i+=n.length):s=!1,l.diffs.push([e,n]),n===o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(n.length))}a=(a=tx(l.diffs)).substring(a.length-t);let c=tb(o.diffs).substring(0,t),d=tE(c);""!==c&&(l.length1+=c.length,l.length2+=c.length,l.utf8Length1+=d,l.utf8Length2+=d,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=c:l.diffs.push([0,c])),s||e.splice(++n,0,l)}}}(r,i);let s=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+s,n=tb(r[e].diffs),i,l=-1;if(n.length>32?-1!==(i=tk(o,n.substring(0,32),t))&&(-1===(l=tk(o,n.substring(n.length-32),t+n.length-32))||i>=l)&&(i=-1):i=tk(o,n,t),-1===i)c[e]=!1,s-=r[e].length2-r[e].length1;else{let d;if(c[e]=!0,s=i-t,d=-1===l?o.substring(i,i+n.length):o.substring(i,l+32),n===d)o=o.substring(0,i)+tx(r[e].diffs)+o.substring(i+n.length);else{let t=te(n,d,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,o=0;for(let r=0;r<e.length;r++){let i=e[r][0],a=e[r][1];switch(i){case 1:n+=a.length;break;case -1:o+=a.length;break;case 0:t+=Math.max(n,o),n=0,o=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,o)}(t)/n.length>a)c[e]=!1;else{t=td(t);let n=0,a=0;for(let l=0;l<r[e].diffs.length;l++){let s=r[e].diffs[l];0!==s[0]&&(a=t_(t,n)),1===s[0]?o=o.substring(0,i+a)+s[1]+o.substring(i+a):-1===s[0]&&(o=o.substring(0,i+a)+o.substring(i+t_(t,n+s[1].length))),-1!==s[0]&&(n+=s[1].length)}}}}}return[o=o.substring(l.length,o.length-l.length),c]}(tM(t.value),o.node.text,{allowExceedingIndices:!0}),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.map(e=>eZ(e)),o=!1,r=[],i=0,a=null,l=0,s=!1,c=!1,d=!1,u=!1;for(;l<n.length;)0===n[l][0]?(n[l][1].length<t&&(d||u)?(r[i++]=l,s=d,c=u,a=n[l][1]):(i=0,a=null),d=!1,u=!1):(-1===n[l][0]?u=!0:d=!0,a&&(s&&c&&d&&u||a.length<t/2&&3===function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e+(t?1:0),0)}(s,c,d,u))&&(n.splice(r[i-1],0,[-1,a]),n[r[i-1]+1][0]=1,i--,a=null,s&&c?(d=!0,u=!0,i=0):(l=--i>0?r[i-1]:-1,d=!1,u=!1),o=!0)),l++;return o&&(n=tu(n)),n}(te(o.node.text,r),5),a=0;for(let[t,r]of i)1===t?(e.apply({type:"insert_text",path:[n.index,o.index],offset:a,text:r}),a+=r.length):-1===t?e.apply({type:"remove_text",path:[n.index,o.index],offset:a,text:r}):0===t&&(a+=r.length);return!0}(e,n)}}catch(e){console.error(e)}return o});return function(e){ed.set(e,!1),tH.set(e,!0),n=[...e.children];let{apply:t}=e,l=[],s=()=>{if(0===l.length)return;let t=l;l=[];let n=!1;eK(e,()=>{u.ML.withoutNormalizing(e,()=>{tX(e,()=>{tP(e,()=>{for(let o of t){tZ.enabled&&tZ("Handling remote patch ".concat(JSON.stringify(o)));try{n=a(e,o)}catch(e){console.error("Applying patch ".concat(JSON.stringify(o)," failed due to: ").concat(e.message))}}})})}),n&&(e.normalize(),e.onChange())})},c=e=>{let{patches:t}=e,n=t.filter(e=>"local"!==e.origin);0!==n.length&&(l=l.concat(n),s())};return i.push(()=>{tZ("Subscribing to remote patches");let e=o.on("patches",c);return()=>{tZ("Unsubscribing to remote patches"),e.unsubscribe()}}),e.apply=i=>{let a=[],l=X(n=e.children,o.getSnapshot().context.schema);t(i);let s=X(e.children,o.getSnapshot().context.schema);if(!tH.get(e))return e;switch(l&&!s&&"set_selection"!==i.type&&a.push((0,C.$T)(n,"before",[0])),i.type){case"insert_text":a=[...a,...function(e,t,n,o){let r=(0,y.dz)({schema:e},t[n.path[0]])&&t[n.path[0]];if(!r)throw Error("Could not find block");let i=(0,y.dz)({schema:e},r)&&(0,y.dn)({schema:e},r.children[n.path[1]])&&r.children[n.path[1]];if(!i)throw Error("Could not find child");let a=[{_key:r._key},"children",{_key:i._key},"text"],l=o[n.path[0]],s=(0,y.dz)({schema:e},l)&&l.children[n.path[1]],c=(0,y.dn)({schema:e},s)?s.text:"",d=(0,C.aH)(c,i.text,a);return d.value.length?[d]:[]}(o.getSnapshot().context.schema,e.children,i,n)];break;case"remove_text":a=[...a,...function(e,t,n,o){let r=t[n.path[0]];if(!r)throw Error("Could not find block");let i=(0,y.dz)({schema:e},r)&&r.children[n.path[1]]||void 0,a=(0,y.dn)({schema:e},i)?i:void 0;if(i&&!a)throw Error("Expected span");if(!a)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:a._key},"text"],s=o[n.path[0]],c=(0,y.dz)({schema:e},s)&&s.children[n.path[1]],d=(0,y.dn)({schema:e},c)&&c.text,u=(0,C.aH)(d||"",a.text,l);return u.value?[u]:[]}(o.getSnapshot().context.schema,e.children,i,n)];break;case"remove_node":a=[...a,...function(e,t,n){let o=t[n.path[0]];if(1===n.path.length){if(o&&o._key)return[(0,C.zN)([{_key:o._key}])];throw Error("Block not found")}if(!(0,y.dz)({schema:e},o)||2!==n.path.length)return[];{let e=o.children[n.path[1]];return e?o.children.filter(e=>e._key===n.node._key).length>1?(console.warn("Multiple spans have `_key` ".concat(n.node._key,". It's ambiguous which one to remove."),JSON.stringify(o,null,2)),[]):[(0,C.zN)([{_key:o._key},"children",{_key:e._key}])]:[]}}(o.getSnapshot().context.schema,n,i)];break;case"split_node":a=[...a,...function(e,t,n,o){let r=[],i=t[n.path[0]];if(!(0,y.dz)({schema:e},i))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let a=o[n.path[0]];if((0,y.dz)({schema:e},a)){let o=H([t[n.path[0]+1]],e.block.name)[0];o&&(r.push((0,C.$T)([o],"after",[{_key:i._key}])),a.children.slice(n.position).forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];r.push((0,C.zN)(t))}))}return r}if(2===n.path.length){let t=i.children[n.path[1]];if((0,y.dn)({schema:e},t)){let o=H([{...i,children:i.children.slice(n.path[1]+1,n.path[1]+2)}],e.block.name)[0].children;r.push((0,C.Cb)([],[{_key:i._key},"children"])),r.push((0,C.$T)(o,"after",[{_key:i._key},"children",{_key:t._key}])),r.push((0,C.t8)(t.text,[{_key:i._key},"children",{_key:t._key},"text"]))}}return r}(o.getSnapshot().context.schema,e.children,i,n)];break;case"insert_node":a=[...a,...function(e,t,n,o){let r=o[n.path[0]];if(1===n.path.length){let t=0===n.path[0]?"before":"after",i=o[n.path[0]-1],a=0===n.path[0]?null==r?void 0:r._key:null==i?void 0:i._key;return a?[(0,C.$T)([H([n.node],e.block.name)[0]],t,[{_key:a}])]:[(0,C.Cb)(o,[]),(0,C.$T)([H([n.node],e.block.name)[0]],"before",[n.path[0]])]}if((0,y.dz)({schema:e},r)&&2===n.path.length&&t[n.path[0]]){let t=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",o={...n.node};!o._type&&u.xv.isText(o)&&(o._type="span",o.marks=[]);let i=H([{_key:"bogus",_type:e.block.name,children:[o]}],e.block.name)[0].children[0];return[(0,C.Cb)([],[{_key:r._key},"children"]),(0,C.$T)([i],t,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return[]}(o.getSnapshot().context.schema,e.children,i,n)];break;case"set_node":a=[...a,...function(e,t,n){if(1===n.path.length){let o=t[n.path[0]];if("string"!=typeof o._key)throw Error("Expected block to have a _key");let r=U({...t[n.path[0]],...n.newProperties},Y);return[(0,C.t8)(H([r],e.block.name)[0],[{_key:o._key}])]}if(2===n.path.length){let o=t[n.path[0]];if((0,y.dz)({schema:e},o)){let e=o.children[n.path[1]];if(e){let t=o._key,r=e._key,i=[],a=Object.keys(n.newProperties);return a.forEach(l=>{if(1===a.length&&"_key"===l){let r=D(n.newProperties,l);i.push((0,C.t8)(r,[{_key:t},"children",o.children.indexOf(e),l]))}else{let e=D(n.newProperties,l);i.push((0,C.t8)(e,[{_key:t},"children",{_key:r},l]))}}),i}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))}(o.getSnapshot().context.schema,e.children,i)];break;case"merge_node":a=[...a,...function(e,t,n,o){let r=[],i=o[n.path[0]],a=t[n.path[0]];if(1===n.path.length){if(null==i?void 0:i._key){let o=H([t[n.path[0]-1]],e.block.name)[0];r.push((0,C.t8)(o,[{_key:o._key}])),r.push((0,C.zN)([{_key:i._key}]))}else throw Error("Target key not found!")}else if((0,y.dz)({schema:e},i)&&(0,y.dz)({schema:e},a)&&2===n.path.length){let t=a.children[n.path[1]-1]&&(0,y.dn)({schema:e},a.children[n.path[1]-1])?a.children[n.path[1]-1]:void 0,o=i.children[n.path[1]]&&(0,y.dn)({schema:e},i.children[n.path[1]])?i.children[n.path[1]]:void 0;t&&(1===i.children.filter(e=>e._key===t._key).length?r.push((0,C.t8)(t.text,[{_key:i._key},"children",{_key:t._key},"text"])):console.warn("Multiple spans have `_key` ".concat(t._key,". It's ambiguous which one to update."),JSON.stringify(i,null,2))),o&&(1===i.children.filter(e=>e._key===o._key).length?r.push((0,C.zN)([{_key:i._key},"children",{_key:o._key}])):console.warn("Multiple spans have `_key` ".concat(o._key,". It's ambiguous which one to remove."),JSON.stringify(i,null,2)))}return r}(o.getSnapshot().context.schema,e.children,i,n)];break;case"move_node":a=[...a,...function(e,t,n){let o=[],r=t[n.path[0]],i=t[n.newPath[0]];if(!i)return o;if(1===n.path.length){let t=n.path[0]>n.newPath[0]?"before":"after";o.push((0,C.zN)([{_key:r._key}])),o.push((0,C.$T)([H([r],e.block.name)[0]],t,[{_key:i._key}]))}else if(2===n.path.length&&(0,y.dz)({schema:e},r)&&(0,y.dz)({schema:e},i)){let t=r.children[n.path[1]],a=i.children[n.newPath[1]],l=n.newPath[1]===i.children.length?"after":"before",s=H([r],e.block.name)[0].children[n.path[1]];o.push((0,C.zN)([{_key:r._key},"children",{_key:t._key}])),o.push((0,C.Cb)([],[{_key:i._key},"children"])),o.push((0,C.$T)([s],l,[{_key:i._key},"children",{_key:a._key}]))}return o}(o.getSnapshot().context.schema,n,i)]}if(!l&&s&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(a=[...a,(0,C.zN)([])],r.send({type:"unset",previousValue:H(n,o.getSnapshot().context.schema.block.name,ep.get(e))})),l&&a.length>0&&(a=[(0,C.Cb)([],[]),...a]),a.length>0)for(let t of a)o.send({type:"internal.patch",patch:{...t,origin:"local"},operationId:tV.get(e),value:e.value});return e},e}}({editorActor:n,relayActor:o,subscriptions:t.subscriptions}),a=function(e){let{editorActor:t}=e;return n=>{let o=H(n.children,t.getSnapshot().context.schema.block.name),r=tj(n),i=tN(n);e.subscriptions.push(()=>{tI("Subscribing to patches");let e=t.on("patches",e=>{let{patches:t,snapshot:i}=e,a=!1;t.forEach(e=>{if(!a&&"local"!==e.origin&&r){if("unset"===e.type&&0===e.path.length){tI("Someone else cleared the content, resetting undo/redo history"),n.history={undos:[],redos:[]},r.splice(0,r.length),tT.set(n,!0),a=!0;return}r.push({patch:e,time:new Date,snapshot:i,previousSnapshot:o})}}),o=i});return()=>{tI("Unsubscribing to patches"),e.unsubscribe()}}),n.history={undos:[],redos:[]};let{apply:a}=n;return n.apply=e=>{if(t.getSnapshot().matches({"edit mode":"read only"})||eV(n)||eJ(n)||eq(n)){a(e);return}let{operations:o,history:r}=n,{undos:l}=r,s=l[l.length-1],c=s&&s.operations&&s.operations[s.operations.length-1],d=tU(e,c),u=tC(n),p=tN(n),h=p===i;if(u){if(s?0===o.length&&(h=void 0===p&&void 0===i?tY(e,c)||d:h):h=!1,s&&h)s.operations.push(e);else{let t={operations:[...null===n.selection?[]:[{type:"set_selection",properties:{...n.selection},newProperties:{...n.selection}}],e],timestamp:new Date};l.push(t),tI("Created new undo step",s)}for(;l.length>1e3;)l.shift();tz(e)&&(r.redos=[])}i=p,a(e)},n}}({editorActor:n,subscriptions:t.subscriptions});return function(e){if(void 0!==n.getSnapshot().context.maxBlocks)return e;let{delete:t,select:o}=e;return e.delete=o=>{var r;if(t$(e)){t(o);return}let i=null!==(r=null==o?void 0:o.at)&&void 0!==r?r:e.selection;if(!i){console.error("Unexpected call to .delete(...) without `at` option");return}let a=u.ML.range(e,i),l=ei({schema:n.getSnapshot().context.schema,editor:e,range:a});if(!l){console.error("Unexpected call to .delete(...) with invalid `at` option");return}n.send({type:"behavior event",behaviorEvent:{type:"delete",at:l,direction:(null==o?void 0:o.reverse)?"backward":"forward",unit:null==o?void 0:o.unit},editor:e})},e.deleteBackward=t=>{if(t$(e)){console.error("Unexpected call to .deleteBackward(...)");return}n.send({type:"behavior event",behaviorEvent:{type:"delete.backward",unit:t},editor:e})},e.deleteForward=t=>{if(t$(e)){console.error("Unexpected call to .deleteForward(...)");return}n.send({type:"behavior event",behaviorEvent:{type:"delete.forward",unit:t},editor:e})},e.insertBreak=()=>{if(t$(e)){console.error("Unexpected call to .insertBreak(...)");return}n.send({type:"behavior event",behaviorEvent:{type:"insert.break"},editor:e})},e.insertData=t=>{if(t$(e)){console.error("Unexpected call to .insertData(...)");return}n.send({type:"behavior event",behaviorEvent:{type:"input.*",originEvent:{dataTransfer:t}},editor:e})},e.insertSoftBreak=()=>{if(t$(e)){ez({context:{keyGenerator:n.getSnapshot().context.keyGenerator,schema:n.getSnapshot().context.schema},operation:{text:"\n",editor:e}});return}n.send({type:"behavior event",behaviorEvent:{type:"insert.soft break"},editor:e})},e.insertText=t=>{if(t$(e)){ez({context:{keyGenerator:n.getSnapshot().context.keyGenerator,schema:n.getSnapshot().context.schema},operation:{text:t,editor:e}});return}n.send({type:"behavior event",behaviorEvent:{type:"insert.text",text:t},editor:e})},e.redo=()=>{if(t$(e)){tK({context:{keyGenerator:n.getSnapshot().context.keyGenerator,schema:n.getSnapshot().context.schema},operation:{type:"history.redo",editor:e}});return}n.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},e.select=t=>{if(t$(e)){o(t);return}let r=u.ML.range(e,t);n.send({type:"behavior event",behaviorEvent:{type:"select",at:ei({schema:n.getSnapshot().context.schema,editor:e,range:r})},editor:e})},e.setFragmentData=()=>{console.error("Unexpected call to .setFragmentData(...)")},e.undo=()=>{if(t$(e)){tK({context:{keyGenerator:n.getSnapshot().context.keyGenerator,schema:n.getSnapshot().context.schema},operation:{type:"history.undo",editor:e}});return}n.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},e}(r(function(e){let{apply:t,normalizeNode:o}=e;return e.apply=o=>{if(eV(e)||eJ(e)||eq(e)){t(o);return}if("split_node"===o.type){let r=[...u.NB.descendants(e)].map(e=>{let[t]=e;return t._key});t({...o,properties:{...o.properties,_key:void 0===o.properties._key||r.includes(o.properties._key)?n.getSnapshot().context.keyGenerator():o.properties._key}});return}if("insert_node"===o.type&&!u.ML.isEditor(o.node)){let r=[...u.NB.descendants(e)].map(e=>{let[t]=e;return t._key});t({...o,node:{...o.node,_key:void 0===o.node._key||r.includes(o.node._key)?n.getSnapshot().context.keyGenerator():o.node._key}});return}t(o)},e.normalizeNode=t=>{let[r,i]=t;if(u.W_.isElement(r)&&r._type===n.getSnapshot().context.schema.block.name){if(!r._key){n.send({type:"normalizing"}),u.YR.setNodes(e,{_key:n.getSnapshot().context.keyGenerator()},{at:i}),n.send({type:"done normalizing"});return}for(let[t,o]of u.NB.children(e,i))if(!t._key){n.send({type:"normalizing"}),u.YR.setNodes(e,{_key:n.getSnapshot().context.keyGenerator()},{at:o}),n.send({type:"done normalizing"});return}}o(t)},e}(function(e){let{apply:t,normalizeNode:o}=e,r=n.getSnapshot().context.schema.decorators.map(e=>e.name);return e.normalizeNode=t=>{var r,i,a,l,s,c,d;let[p,h]=t;if(e.isTextBlock(p))for(let[t,o]of u.NB.children(e,h)){let a=p.children[o[1]+1];if(e.isTextSpan(t)&&e.isTextSpan(a)&&(null===(r=t.marks)||void 0===r?void 0:r.every(e=>{var t;return null===(t=a.marks)||void 0===t?void 0:t.includes(e)}))&&(null===(i=a.marks)||void 0===i?void 0:i.every(e=>{var n;return null===(n=t.marks)||void 0===n?void 0:n.includes(e)}))){eX("Merging spans",JSON.stringify(t,null,2),JSON.stringify(a,null,2)),n.send({type:"normalizing"}),u.YR.mergeNodes(e,{at:[o[0],o[1]+1],voids:!0}),n.send({type:"done normalizing"});return}}if(e.isTextBlock(p)&&!Array.isArray(p.markDefs)){eX("Adding .markDefs to block node"),n.send({type:"normalizing"}),u.YR.setNodes(e,{markDefs:[]},{at:h}),n.send({type:"done normalizing"});return}if(e.isTextSpan(p)&&!Array.isArray(p.marks)){eX("Adding .marks to span node"),n.send({type:"normalizing"}),u.YR.setNodes(e,{marks:[]},{at:h}),n.send({type:"done normalizing"});return}if(e.isTextSpan(p)){let t=u.y$.parent(h),[o]=u.ML.node(e,t),r=n.getSnapshot().context.schema.decorators.map(e=>e.name),i=null===(a=p.marks)||void 0===a?void 0:a.filter(e=>!r.includes(e));if(e.isTextBlock(o)&&""===p.text&&i&&i.length>0){eX("Removing annotations from empty span node"),n.send({type:"normalizing"}),u.YR.setNodes(e,{marks:null===(l=p.marks)||void 0===l?void 0:l.filter(e=>r.includes(e))},{at:h}),n.send({type:"done normalizing"});return}}if(e.isTextBlock(p)){let t=n.getSnapshot().context.schema.decorators.map(e=>e.name);for(let[o,r]of u.NB.children(e,h))if(e.isTextSpan(o)){let i=null!==(s=o.marks)&&void 0!==s?s:[],a=i.filter(e=>{var n;return!t.includes(e)&&!(null===(n=p.markDefs)||void 0===n?void 0:n.find(t=>t._key===e))});if(a.length>0){eX("Removing orphaned annotations from span node"),n.send({type:"normalizing"}),u.YR.setNodes(e,{marks:i.filter(e=>!a.includes(e))},{at:r}),n.send({type:"done normalizing"});return}}}if(e.isTextSpan(p)){let t=u.y$.parent(h),[o]=u.ML.node(e,t);if(e.isTextBlock(o)){let t=n.getSnapshot().context.schema.decorators.map(e=>e.name),r=null!==(c=p.marks)&&void 0!==c?c:[],i=r.filter(e=>{var n;return!t.includes(e)&&!(null===(n=o.markDefs)||void 0===n?void 0:n.find(t=>t._key===e))});if(i.length>0){eX("Removing orphaned annotations from span node"),n.send({type:"normalizing"}),u.YR.setNodes(e,{marks:r.filter(e=>!i.includes(e))},{at:h}),n.send({type:"done normalizing"});return}}}if(e.isTextBlock(p)){let t=null!==(d=p.markDefs)&&void 0!==d?d:[],o=new Set,r=[];for(let e of t)o.has(e._key)||(o.add(e._key),r.push(e));if(t.length!==r.length){eX("Removing duplicate markDefs"),n.send({type:"normalizing"}),u.YR.setNodes(e,{markDefs:r},{at:h}),n.send({type:"done normalizing"});return}}if(e.isTextBlock(p)&&!e.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(p.markDefs||[]).filter(e=>p.children.find(t=>u.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(p.markDefs&&!v(t,p.markDefs)){eX("Removing markDef not in use"),n.send({type:"normalizing"}),u.YR.setNodes(e,{markDefs:t},{at:h}),n.send({type:"done normalizing"});return}}o(t)},e.apply=o=>{var i,a,l,s,c,d,p,h,f,y,g,v,m,b,x,E,w,S,O,M,R;if(eV(e)||eJ(e)||eq(e)){t(o);return}if("set_selection"===o.type&&o.properties&&o.newProperties&&o.properties.anchor&&o.properties.focus&&o.newProperties.anchor&&o.newProperties.focus){let t=u.e6.isCollapsed({anchor:o.properties.anchor,focus:o.properties.focus}),n=u.e6.isCollapsed({anchor:o.newProperties.anchor,focus:o.newProperties.focus});if(t&&n){let t=null===(i=Array.from(u.ML.nodes(e,{mode:"lowest",at:o.properties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0])||void 0===i?void 0:i[0],n=null===(a=Array.from(u.ML.nodes(e,{mode:"lowest",at:o.newProperties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0])||void 0===a?void 0:a[0],r=t&&n&&o.newProperties.focus.path[0]===o.properties.focus.path[0]&&o.newProperties.focus.path[1]===o.properties.focus.path[1]+1&&t.text.length===o.properties.focus.offset&&0===o.newProperties.focus.offset,l=t&&n&&o.newProperties.focus.path[0]===o.properties.focus.path[0]&&o.newProperties.focus.path[1]===o.properties.focus.path[1]-1&&0===o.properties.focus.offset&&n.text.length===o.newProperties.focus.offset;r||l||(e.decoratorState={})}}if("insert_node"===o.type){let{selection:t}=e;if(t){let[i,a]=u.ML.node(e,t,{depth:1}),k=eG({editor:e,blockPath:a,spanPath:o.path}),_=k?null===(l=k.marks)||void 0===l?void 0:l.filter(e=>!r.includes(e)):[],E=eF({editor:e,blockPath:a,spanPath:[o.path[0],o.path[1]-1]}),w=E?null===(s=E.marks)||void 0===s?void 0:s.filter(e=>!r.includes(e)):[],S=null!==(f=null==_?void 0:_.filter(e=>!(null==w?void 0:w.includes(e))))&&void 0!==f?f:[],O=S.length>0;if(O&&eP(o.node)&&(null===(c=o.node.marks)||void 0===c?void 0:c.some(e=>S.includes(e)))){u.YR.insertNodes(e,{...o.node,_key:n.getSnapshot().context.keyGenerator(),marks:null!==(g=null===(y=o.node.marks)||void 0===y?void 0:y.filter(e=>!S.includes(e)))&&void 0!==g?g:[]});return}let M=null!==(v=null==w?void 0:w.filter(e=>!(null==_?void 0:_.includes(e))))&&void 0!==v?v:[],R=M.length>0;if(R&&eP(o.node)&&(null===(d=o.node.marks)||void 0===d?void 0:d.some(e=>M.includes(e)))){u.YR.insertNodes(e,{...o.node,_key:n.getSnapshot().context.keyGenerator(),marks:null!==(b=null===(m=o.node.marks)||void 0===m?void 0:m.filter(e=>!M.includes(e)))&&void 0!==b?b:[]});return}let A=null!==(x=null==E?void 0:null===(p=E.marks)||void 0===p?void 0:p.filter(e=>r.includes(e)))&&void 0!==x?x:[];if(A.length>0&&O&&!R&&eP(o.node)&&(null===(h=o.node.marks)||void 0===h?void 0:h.length)===0){u.YR.insertNodes(e,{...o.node,_key:n.getSnapshot().context.keyGenerator(),marks:A});return}}}if("insert_text"===o.type){let r=eH({editorActorSnapshot:n.getSnapshot(),slateEditorInstance:e}),i=(0,k.zd)(r);if(!i||"unchanged"===i.state){t(o);return}u.YR.insertNodes(e,{_type:"span",_key:n.getSnapshot().context.keyGenerator(),text:o.text,marks:i.marks});return}if("remove_text"===o.type){let{selection:i}=e;if(i&&u.e6.isExpanded(i)){let[a,l]=u.ML.node(e,i,{depth:1}),[s,c]=null!==(E=Array.from(u.ML.nodes(e,{mode:"lowest",at:{path:o.path,offset:o.offset},match:t=>e.isTextSpan(t),voids:!1}))[0])&&void 0!==E?E:[void 0,void 0];if(s&&a&&"string"==typeof(R=a)._type&&"@"!==R._type[0]&&(!("markDefs"in R)||!R.markDefs||Array.isArray(R.markDefs)&&R.markDefs.every(e=>"string"==typeof e._key))&&"children"in R&&Array.isArray(R.children)&&R.children.every(e=>"object"==typeof e&&"_type"in e)){let i=null!==(O=a.markDefs)&&void 0!==O?O:[],d=null!==(M=s.marks)&&void 0!==M?M:[],p=d.some(e=>i.find(t=>t._key===e)),h=o.offset+o.text.length===s.text.length,f=0===o.offset&&h,y=eG({editor:e,blockPath:l,spanPath:c}),g=eF({editor:e,blockPath:l,spanPath:c}),v=!!y&&(null===(w=y.marks)||void 0===w?void 0:w.some(e=>!r.includes(e)&&d.includes(e))),m=!!g&&(null===(S=g.marks)||void 0===S?void 0:S.some(e=>!r.includes(e)&&d.includes(e)));if(p&&f&&!v&&!m){let r=eH({editorActorSnapshot:n.getSnapshot(),slateEditorInstance:e});u.ML.withoutNormalizing(e,()=>{t(o),u.YR.setNodes(e,{marks:(0,k.WH)(r)},{at:o.path})}),e.onChange();return}}}}if("merge_node"===o.type&&1===o.path.length&&"markDefs"in o.properties&&o.properties._type===n.getSnapshot().context.schema.block.name&&Array.isArray(o.properties.markDefs)&&o.properties.markDefs.length>0&&o.path[0]-1>=0){let[n,r]=u.ML.node(e,[o.path[0]-1]);if(e.isTextBlock(n)){let i=_([...Array.isArray(n.markDefs)&&n.markDefs||[],...o.properties.markDefs]);eX("Copying markDefs over to merged block",o),u.YR.setNodes(e,{markDefs:i},{at:r,voids:!1}),t(o);return}}t(o)},e}(function(e){let{apply:t}=e;return e.apply=o=>{if(n.getSnapshot().matches({"edit mode":"read only"})||eV(e)||eJ(e)||eq(e)){t(o);return}if("remove_node"===o.type){let t=o.path.at(0),r=1===o.path.length&&0===t&&1===e.children.length,i=o.node._type!==n.getSnapshot().context.schema.block.name;r&&i&&(tQ("Adding placeholder block"),u.ML.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}t(o)},e}((function(e){let{editorActor:t}=e;return function(e){return e.pteCreateTextBlock=e=>q([{_type:t.getSnapshot().context.schema.block.name,_key:t.getSnapshot().context.keyGenerator(),style:t.getSnapshot().context.schema.styles[0].name||"normal",...e.listItem?{listItem:e.listItem}:{},...e.level?{level:e.level}:{},markDefs:[],children:[{_type:"span",_key:t.getSnapshot().context.keyGenerator(),text:"",marks:e.decorators.filter(e=>t.getSnapshot().context.schema.decorators.find(t=>{let{name:n}=t;return n===e}))}]}],{schemaTypes:t.getSnapshot().context.schema})[0],e}})({editorActor:n})(function(e){let{apply:t}=e;return e.apply=o=>{var r;if(n.getSnapshot().matches({"edit mode":"read only"})||eV(e)||eJ(e)||eq(e)){t(o);return}let i=null!==(r=n.getSnapshot().context.maxBlocks)&&void 0!==r?r:-1;i>0&&e.children.length>=i&&("insert_node"===o.type||"split_node"===o.type)&&1===o.path.length||t(o)},e}(a(i(function(e,t){let{apply:n}=t;return t.apply=o=>{if("set_selection"===o.type||(t.value=function(e,t,n){let o=(0,z.P2)({children:t});try{(function(e,t,n){var o;switch(n.type){case"insert_node":{let{path:o,node:r}=n,i=t7(e,t,o),a=o[o.length-1];if(!i||a>i.children.length)break;if(1===o.length){if(t2(e,r)){i.children.splice(a,0,{...r,children:r.children.map(e=>"__inline"in e?{_key:e._key,_type:e._type,..."value"in e&&"object"==typeof e.value?e.value:{}}:e)});break}if(u.W_.isElement(r)&&!("__inline"in r)){i.children.splice(a,0,{_key:r._key,_type:r._type,..."value"in r&&"object"==typeof r.value?r.value:{}});break}}if(2===o.length){if(!t2(e,i))break;if(t8(r)){i.children.splice(a,0,r);break}"__inline"in r&&i.children.splice(a,0,{_key:r._key,_type:r._type,..."value"in r&&"object"==typeof r.value?r.value:{}})}break}case"insert_text":{let{path:o,offset:r,text:i}=n;if(0===i.length)break;let a=t4(e,t,o);if(!a)break;let l=a.text.slice(0,r),s=a.text.slice(r);a.text=l+i+s;break}case"merge_node":{let{path:o}=n,r=t9(e,t,o),i=t9(e,t,u.y$.previous(o)),a=t7(e,t,o);if(!r||!i||!a)break;let l=o[o.length-1];if(t8(r)&&t8(i))i.text+=r.text;else if(t2(e,r)&&t2(e,i))i.children.push(...r.children);else break;a.children.splice(l,1);break}case"move_node":{let{path:o,newPath:r}=n;if(u.y$.isAncestor(o,r))break;let i=t9(e,t,o),a=t7(e,t,o),l=o[o.length-1];if(!i||!a)break;a.children.splice(l,1);let s=u.y$.transform(o,n),c=t9(e,t,u.y$.parent(s)),d=s[s.length-1];if(!c||!("children"in c)||!Array.isArray(c.children))break;c.children.splice(d,0,i);break}case"remove_node":{let{path:r}=n,i=r[r.length-1];null===(o=t7(e,t,r))||void 0===o||o.children.splice(i,1);break}case"remove_text":{let{path:o,offset:r,text:i}=n;if(0===i.length)break;let a=t4(e,t,o);if(!a)break;let l=a.text.slice(0,r),s=a.text.slice(r+i.length);a.text=l+s;break}case"set_node":{let{path:o,properties:r,newProperties:i}=n,a=t9(e,t,o);if(!a||t1(a))break;if(!t1(a)&&!t2(e,a)&&!t3(e,a)&&!t8(a)){let e="value"in r&&"object"==typeof r.value?r.value:{},t="value"in i&&"object"==typeof i.value?i.value:{};for(let e in i){if("value"===e)continue;let t=i[e];null==t?delete a[e]:a[e]=t}for(let e in r)"value"!==e&&(i.hasOwnProperty(e)||delete a[e]);for(let e in t){let n=t[e];null==n?delete a[e]:a[e]=n}for(let n in e)t.hasOwnProperty(n)||delete a[n];break}if(t2(e,a)){for(let e in i){if("children"===e||"text"===e)break;let t=i[e];null==t?delete a[e]:a[e]=t}for(let e in r)i.hasOwnProperty(e)||delete a[e];break}if(t8(a)){for(let e in i){if("text"===e)break;let t=i[e];null==t?delete a[e]:a[e]=t}for(let e in r)i.hasOwnProperty(e)||delete a[e]}break}case"split_node":{let{path:o,position:r,properties:i}=n;if(0===o.length)break;let a=t7(e,t,o),l=o[o.length-1];if(!a)break;if(t1(a)){let n=t6(t,o);if(!n||!t2(e,n))break;let s=n.children.slice(0,r),c=n.children.slice(r);n.children=s;let d={...i,children:c,_type:e.schema.block.name};a.children.splice(l+1,0,d);break}if(t2(e,a)){let n=t9(e,t,o);if(!n||!t3(e,n))break;let s=n.text.slice(0,r),c=n.text.slice(r);n.text=s;let d={...i,text:c};a.children.splice(l+1,0,d)}}}})(e,o,n)}catch(e){console.error(e)}return(0,z._x)(o).children}(e,t.value,o),"insert_text"===o.type||"remove_text"===o.type)){n(o);return}eY({schema:e.schema,value:t.value},{blockIndexMap:t.blockIndexMap,listIndexMap:t.listIndexMap}),n(o)},t}(n.getSnapshot().context,function(e){let{editor:t,editorActor:n}=e,o=()=>{if(t.selection){let e=eh.get(t.selection);if(e)n.send({type:"update selection",selection:e});else{let e=ei({schema:n.getSnapshot().context.schema,editor:t,range:t.selection});eh.set(t.selection,e),n.send({type:"update selection",selection:e})}}else n.send({type:"update selection",selection:null})},{onChange:r}=t;return t.onChange=()=>{r(),n.getSnapshot().matches({setup:"setting up"})||o()},t}({editorActor:n,editor:e})))))))))))},ne=W("setup");function nt(e,t){return{getBlockNodes:e=>(function(e,t){if(!t.context.selection)return[];let n=es(t);if(!n)return[];try{return Array.from(u.ML.nodes(e,{at:n,mode:"highest",match:e=>!u.ML.isEditor(e)})).map(t=>{let[n]=t;return f.y2.toDOMNode(e,n)})}catch(e){return[]}})(t,e),getChildNodes:e=>(function(e,t){if(!t.context.selection)return[];let n=es(t);if(!n)return[];try{return Array.from(u.ML.nodes(e,{at:n,mode:"lowest",match:e=>!u.ML.isEditor(e)})).map(t=>{let[n]=t;return f.y2.toDOMNode(e,n)})}catch(e){return[]}})(t,e),setDragGhost:t=>{let{event:n,ghost:o}=t;return function(e){let{sendBack:t,event:n,ghost:o}=e;n.originEvent.dataTransfer.setDragImage(o.element,o.x,o.y),t({type:"set drag ghost",ghost:o.element})}({sendBack:e,event:n,ghost:o})}}}let nn=(0,x.gg)({on:"annotation.add",guard:e=>{let{snapshot:t}=e;if(!(0,m.dI)(t))return!1;let n=(0,k.Ih)(t);return!!(n&&(0,m.sC)({context:{...t.context,selection:n}}))&&{caretWordSelection:n}},actions:[(e,t)=>{let{event:n}=e,{caretWordSelection:o}=t;return[(0,x.OU)({type:"select",at:o}),(0,x.OU)({type:"annotation.add",annotation:n.annotation})]}]}),no={arrowDown:(0,P.vc)({default:[{key:"ArrowDown",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),arrowUp:(0,P.vc)({default:[{key:"ArrowUp",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),break:(0,P.vc)({default:[{key:"Enter",shift:!1}]}),lineBreak:(0,P.vc)({default:[{key:"Enter",shift:!0}]}),decorators:{strong:P.Se,em:P.pU,underline:P.eC,code:P.TU},history:{undo:P.Yw,redo:P.KX},tab:(0,P.vc)({default:[{key:"Tab",alt:!1,ctrl:!1,meta:!1,shift:!1}]}),shiftTab:(0,P.vc)({default:[{key:"Tab",alt:!1,ctrl:!1,meta:!1,shift:!0}]})},nr=(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;if(!no.arrowDown.guard(n.originEvent)||!(0,m.dI)(t))return!1;let o=(0,k.ii)(t),r=(0,k.st)(t);return o&&!r},actions:[e=>{let{snapshot:t}=e;return[(0,x.OU)({type:"insert.block",block:{_type:t.context.schema.block.name},placement:"after"})]}]}),ni=(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;if(!no.arrowUp.guard(n.originEvent)||!(0,m.dI)(t))return!1;let o=(0,k.ii)(t),r=(0,k.nt)(t);return o&&!r},actions:[e=>{let{snapshot:t}=e;return[(0,x.OU)({type:"insert.block",block:{_type:t.context.schema.block.name},placement:"before"})]}]}),na=(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e,n=(0,k.ii)(t);return(0,m.dI)(t)&&void 0!==n},actions:[e=>{let{snapshot:t}=e;return[(0,x.OU)({type:"insert.block",block:{_type:t.context.schema.block.name},placement:"after"})]}]}),nl=(0,x.gg)({on:"mouse.click",guard:e=>{let{snapshot:t,event:n}=e;if(t.context.readOnly||t.context.selection&&!(0,m.dI)(t))return!1;let o=(0,k.ii)({...t,context:{...t.context,selection:n.position.selection}}),r=(0,k.nt)({...t,context:{...t.context,selection:n.position.selection}});return n.position.isEditor&&"start"===n.position.block&&o&&!r},actions:[e=>{let{snapshot:t,event:n}=e;return[(0,x.OU)({type:"select",at:n.position.selection}),(0,x.OU)({type:"insert.block",block:{_type:t.context.schema.block.name},placement:"before",select:"start"})]}]}),ns={arrowDownOnLonelyBlockObject:nr,arrowUpOnLonelyBlockObject:ni,breakingBlockObject:na,clickingAboveLonelyBlockObject:nl,clickingBelowLonelyBlockObject:(0,x.gg)({on:"mouse.click",guard:e=>{let{snapshot:t,event:n}=e;if(t.context.readOnly||t.context.selection&&!(0,m.dI)(t))return!1;let o=(0,k.ii)({...t,context:{...t.context,selection:n.position.selection}}),r=(0,k.st)({...t,context:{...t.context,selection:n.position.selection}});return n.position.isEditor&&"end"===n.position.block&&o&&!r},actions:[e=>{let{snapshot:t,event:n}=e;return[(0,x.OU)({type:"select",at:n.position.selection}),(0,x.OU)({type:"insert.block",block:{_type:t.context.schema.block.name},placement:"after",select:"start"})]}]}),deletingEmptyTextBlockAfterBlockObject:(0,x.gg)({on:"delete.backward",guard:e=>{let{snapshot:t}=e,n=(0,m.I3)(t),o=(0,m.dI)(t),r=(0,k.nt)(t);return!!n&&!!o&&!!r&&!!(0,g.PF)(t.context,n.node)&&!(0,y.dz)(t.context,r.node)&&{focusTextBlock:n,previousBlock:r}},actions:[(e,t)=>{let{focusTextBlock:n,previousBlock:o}=t;return[(0,x.OU)({type:"delete.block",at:n.path}),(0,x.OU)({type:"select",at:{anchor:{path:o.path,offset:0},focus:{path:o.path,offset:0}}})]}]}),deletingEmptyTextBlockBeforeBlockObject:(0,x.gg)({on:"delete.forward",guard:e=>{let{snapshot:t}=e,n=(0,m.I3)(t),o=(0,m.dI)(t),r=(0,k.st)(t);return!!n&&!!o&&!!r&&!!(0,g.PF)(t.context,n.node)&&!(0,y.dz)(t.context,r.node)&&{focusTextBlock:n,nextBlock:r}},actions:[(e,t)=>{let{focusTextBlock:n,nextBlock:o}=t;return[(0,x.OU)({type:"delete.block",at:n.path}),(0,x.OU)({type:"select",at:{anchor:{path:o.path,offset:0},focus:{path:o.path,offset:0}}})]}]})},nc={strongShortcut:(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;return no.decorators.strong.guard(n.originEvent)&&t.context.schema.decorators.some(e=>"strong"===e.name)},actions:[()=>[(0,x.OU)({type:"decorator.toggle",decorator:"strong"})]]}),emShortcut:(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;return no.decorators.em.guard(n.originEvent)&&t.context.schema.decorators.some(e=>"em"===e.name)},actions:[()=>[(0,x.OU)({type:"decorator.toggle",decorator:"em"})]]}),underlineShortcut:(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;return no.decorators.underline.guard(n.originEvent)&&t.context.schema.decorators.some(e=>"underline"===e.name)},actions:[()=>[(0,x.OU)({type:"decorator.toggle",decorator:"underline"})]]}),codeShortcut:(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;return no.decorators.code.guard(n.originEvent)&&t.context.schema.decorators.some(e=>"code"===e.name)},actions:[()=>[(0,x.OU)({type:"decorator.toggle",decorator:"code"})]]})};function nd(e){var t;if(0===e.length)return new DOMRect(0,0,0,0);let n=e.filter(e=>e instanceof Element),o=null===(t=n.at(0))||void 0===t?void 0:t.getBoundingClientRect();if(!o)return new DOMRect(0,0,0,0);let r=o.left,i=o.top,a=o.right,l=o.bottom;for(let e=1;e<n.length;e++){let t=n[e].getBoundingClientRect();r=Math.min(r,t.left),i=Math.min(i,t.top),a=Math.max(a,t.right),l=Math.max(l,t.bottom)}return new DOMRect(r,i,a-r,l-i)}let nu=[(0,x.gg)({on:"drag.dragstart",guard:e=>{let{snapshot:t,dom:n,event:o}=e,r=em({snapshot:t,eventSelection:o.position.selection}),i=(0,k.u7)({...t,context:{...t.context,selection:r}}),a={blockNodes:n.getBlockNodes({...t,context:{...t.context,selection:r}}),childNodes:n.getChildNodes({...t,context:{...t.context,selection:r}})};return{dragSelection:r,draggedDomNodes:a,selectingEntireBlocks:i}},actions:[(e,t)=>{let{dom:n,event:o}=e,{dragSelection:r,draggedDomNodes:i,selectingEntireBlocks:a}=t,l=document.createElement("div");if(a){for(let e of i.blockNodes.map(e=>e.cloneNode(!0)))e instanceof HTMLElement&&(e.style.position="relative"),l.appendChild(e);let e=l.querySelector("[data-pt-drag-ghost-element]");if(e&&l.replaceChildren(e),l.setAttribute("data-dragged",""),l.style.position="absolute",l.style.left="-99999px",l.style.boxSizing="border-box",document.body.appendChild(l),e){let t=e.getBoundingClientRect(),i=o.originEvent.clientX-t.left,a=o.originEvent.clientY-t.top;return l.style.width="".concat(t.width,"px"),l.style.height="".concat(t.height,"px"),[(0,x.OU)({type:"select",at:r}),(0,x.cE)(()=>{n.setDragGhost({event:o,ghost:{element:l,x:i,y:a}})}),(0,x.eH)(o)]}{let e=nd(i.blockNodes),t=o.originEvent.clientX-e.left,a=o.originEvent.clientY-e.top;return l.style.width="".concat(e.width,"px"),l.style.height="".concat(e.height,"px"),[(0,x.OU)({type:"select",at:r}),(0,x.cE)(()=>{n.setDragGhost({event:o,ghost:{element:l,x:t,y:a}})}),(0,x.eH)(o)]}}{for(let e of i.childNodes.map(e=>e.cloneNode(!0)))l.appendChild(e);l.style.position="absolute",l.style.left="-99999px",l.style.boxSizing="border-box",document.body.appendChild(l);let e=nd(i.childNodes),t=o.originEvent.clientX-e.left,a=o.originEvent.clientY-e.top;return l.style.width="".concat(e.width,"px"),l.style.height="".concat(e.height,"px"),[(0,x.OU)({type:"select",at:r}),(0,x.cE)(()=>{n.setDragGhost({event:o,ghost:{element:l,x:t,y:a}})}),(0,x.eH)(o)]}}]}),(0,x.gg)({on:"drag.dragover",guard:e=>{let{snapshot:t,event:n}=e,o=n.dragOrigin;return!!o&&(0,k.Mf)(n.position.selection)({...t,context:{...t.context,selection:o.selection}})},actions:[]}),(0,x.gg)({on:"drag.drop",guard:e=>{let{snapshot:t,event:n}=e,o=n.dragOrigin,r=n.position.selection;return!!o&&(0,k.Mf)(r)({...t,context:{...t.context,selection:o.selection}})},actions:[]}),(0,x.gg)({on:"drag.drop",guard:e=>{let{event:t}=e;return void 0!==t.dragOrigin},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"deserialize",originEvent:t})]}]}),(0,x.gg)({on:"drag.drop",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"select",at:t.position.selection}),(0,x.OU)({type:"deserialize",originEvent:t})]}]}),(0,x.gg)({on:"deserialization.success",guard:e=>{let{snapshot:t,event:n}=e;if("drag.drop"!==n.originEvent.type||void 0===n.originEvent.dragOrigin)return!1;let o=n.originEvent.dragOrigin,r=em({eventSelection:o.selection,snapshot:t}),i=n.originEvent.position.selection,a=!!o&&(0,k.Mf)(i)({...t,context:{...t.context,selection:r}}),l=(0,k.u7)({...t,context:{...t.context,selection:r}}),s=(0,k.wD)({...t,context:{...t.context,selection:r}});return!a&&{dropPosition:i,draggingEntireBlocks:l,draggedBlocks:s,dragOrigin:o,originEvent:n.originEvent}},actions:[(e,t)=>{let{event:n}=e,{draggingEntireBlocks:o,draggedBlocks:r,dragOrigin:i,dropPosition:a,originEvent:l}=t;return[(0,x.OU)({type:"select",at:a}),...o?r.map(e=>(0,x.OU)({type:"delete.block",at:e.path})):[(0,x.OU)({type:"delete",at:i.selection})],(0,x.OU)({type:"insert.blocks",blocks:n.data,placement:o?"start"===l.position.block?"before":"end"===l.position.block?"after":"auto":"auto"})]}]})],np=(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e,n=(0,m.I3)(t),o=(0,m.dI)(t);if(!t.context.selection||!n||!o)return!1;let r=(0,k.kr)(n)(t),i=n.node.listItem,a=n.node.level;return!!r&&{focusListItem:i,focusLevel:a}},actions:[(e,t)=>{var n;let{snapshot:o}=e,{focusListItem:r,focusLevel:i}=t;return[(0,x.OU)({type:"insert.block",block:{_type:o.context.schema.block.name,children:[{_type:o.context.schema.span.name,text:"",marks:[]}],markDefs:[],listItem:r,level:i,style:null===(n=o.context.schema.styles[0])||void 0===n?void 0:n.name},placement:"after"})]}]}),nh=(0,x.gg)({on:"insert.break",guard:e=>{var t,n,o;let{snapshot:r}=e,i=(0,m.I3)(r),a=(0,m.dI)(r);if(!r.context.selection||!i||!a)return!1;let l=(0,m.Cj)(r),s=null==l?void 0:null===(t=l.node.marks)||void 0===t?void 0:t.filter(e=>{var t;return null!==(t=r.context.schema.decorators.some(t=>t.name===e))&&void 0!==t?t:[]}),c=null!==(o=null==l?void 0:null===(n=l.node.marks)||void 0===n?void 0:n.filter(e=>!r.context.schema.decorators.some(t=>t.name===e)))&&void 0!==o?o:[],d=i.node.listItem,u=i.node.level;return!!(0,k.FQ)(i)(r)&&{focusAnnotations:c,focusDecorators:s,focusListItem:d,focusLevel:u}},actions:[(e,t)=>{var n;let{snapshot:o}=e,{focusAnnotations:r,focusDecorators:i,focusListItem:a,focusLevel:l}=t;return[(0,x.OU)({type:"insert.block",block:{_type:o.context.schema.block.name,children:[{_type:o.context.schema.span.name,marks:0===r.length?i:[],text:""}],listItem:a,level:l,style:null===(n=o.context.schema.styles[0])||void 0===n?void 0:n.name},placement:"before",select:"none"})]}]}),nf={breakingAtTheEndOfTextBlock:np,breakingAtTheStartOfTextBlock:nh,breakingEntireDocument:(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e;if(!t.context.selection||!(0,m.sC)(t))return!1;let n=(0,k.Ui)(t),o=(0,k.Gm)(t);if(!n||!o)return!1;let r=(0,y.qv)({context:t.context,block:n}),i=(0,y.VG)(t.context.selection),a=(0,g.sQ)({context:t.context,block:o}),l=(0,y.OE)(t.context.selection);return!!((0,g.Gh)(r,i)&&(0,g.Gh)(a,l))&&{selection:t.context.selection}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"delete",at:n})]}]}),breakingEntireBlocks:(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e;if(!t.context.selection||!(0,m.sC)(t))return!1;let n=(0,k.wD)(t),o=(0,k.Dm)(t),r=(0,k.Zq)(t);if(!o||!r)return!1;let i=(0,y.qv)({context:t.context,block:o}),a=(0,y.VG)(t.context.selection),l=(0,g.sQ)({context:t.context,block:r}),s=(0,y.OE)(t.context.selection);return!!((0,g.Gh)(a,i)&&(0,g.Gh)(s,l))&&{selectedBlocks:n}},actions:[(e,t)=>{let{snapshot:n}=e,{selectedBlocks:o}=t;return[(0,x.OU)({type:"insert.block",block:{_type:n.context.schema.block.name,children:[{_type:n.context.schema.span.name,text:"",marks:[]}]},placement:"before",select:"start"}),...o.map(e=>(0,x.OU)({type:"delete.block",at:e.path}))]}]}),breakingInlineObject:(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e,n=(0,m.dI)(t),o=(0,k.fX)(t);return n&&o},actions:[()=>[(0,x.OU)({type:"move.forward",distance:1}),(0,x.OU)({type:"split"})]]})},ny=(0,x.gg)({on:"delete.backward",guard:e=>{var t;let{snapshot:n}=e,o=(0,m.dI)(n),r=(0,m.I3)(n),i=(0,m.Cj)(n);return!!o&&!!r&&!!i&&r.node.children[0]._key===i.node._key&&(null===(t=n.context.selection)||void 0===t?void 0:t.focus.offset)===0&&1===r.node.level&&{focusTextBlock:r}},actions:[(e,t)=>{let{focusTextBlock:n}=t;return[(0,x.OU)({type:"block.unset",props:["listItem","level"],at:n.path})]}]}),ng=(0,x.gg)({on:"delete.backward",guard:e=>{var t;let{snapshot:n}=e,o=(0,m.dI)(n),r=(0,m.I3)(n),i=(0,m.Cj)(n);return!!o&&!!r&&!!i&&r.node.children[0]._key===i.node._key&&(null===(t=n.context.selection)||void 0===t?void 0:t.focus.offset)===0&&void 0!==r.node.level&&r.node.level>1&&{focusTextBlock:r,level:r.node.level-1}},actions:[(e,t)=>{let{focusTextBlock:n,level:o}=t;return[(0,x.OU)({type:"block.set",props:{level:o},at:n.path})]}]}),nv=(0,x.gg)({on:"delete.forward",guard:e=>{let{snapshot:t}=e,n=(0,k.Ec)(t),o=(0,k.st)(t);return!!(n&&o&&(0,y.dz)(t.context,o.node)&&(0,g.PF)(t.context,n.node))&&{focusListBlock:n,nextBlock:o}},actions:[(e,t)=>{let{nextBlock:n}=t;return[(0,x.OU)({type:"insert.block",block:n.node,placement:"auto",select:"start"}),(0,x.OU)({type:"delete.block",at:n.path})]}]}),nm=(0,x.gg)({on:"delete.backward",guard:e=>{let{snapshot:t}=e,n=(0,m.I3)(t),o=(0,k.nt)(t);return!!(n&&o&&(0,y.cd)(t.context,o.node)&&(0,g.PF)(t.context,o.node))&&{focusTextBlock:n,previousBlockEndPoint:(0,g.sQ)({context:t.context,block:o})}},actions:[(e,t)=>{let{focusTextBlock:n,previousBlockEndPoint:o}=t;return[(0,x.OU)({type:"select",at:{anchor:o,focus:o}}),(0,x.OU)({type:"insert.block",block:n.node,placement:"auto",select:"start"}),(0,x.OU)({type:"delete.block",at:n.path})]}]}),nk=(0,x.gg)({on:"insert.break",guard:e=>{let{snapshot:t}=e,n=(0,m.dI)(t),o=(0,k.Ec)(t);return!!(n&&o&&(0,g.PF)(t.context,o.node))&&{focusListBlock:o}},actions:[(e,t)=>{let{focusListBlock:n}=t;return[(0,x.OU)({type:"block.unset",props:["listItem","level"],at:n.path})]}]}),nb=(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;if(!no.tab.guard(n.originEvent))return!1;let o=(0,k.wD)(t),r=o.flatMap(e=>(0,y.cd)(t.context,e.node)?[{node:e.node,path:e.path}]:[]);return r.length===o.length&&{selectedListBlocks:r}},actions:[(e,t)=>{let{selectedListBlocks:n}=t;return n.map(e=>(0,x.OU)({type:"block.set",props:{level:Math.min(10,Math.max(1,e.node.level+1))},at:e.path}))}]}),nx=(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;if(!no.shiftTab.guard(n.originEvent))return!1;let o=(0,k.wD)(t),r=o.flatMap(e=>(0,y.cd)(t.context,e.node)?[{node:e.node,path:e.path}]:[]);return r.length===o.length&&{selectedListBlocks:r}},actions:[(e,t)=>{let{selectedListBlocks:n}=t;return n.map(e=>(0,x.OU)({type:"block.set",props:{level:Math.min(10,Math.max(1,e.node.level-1))},at:e.path}))}]}),n_={clearListOnBackspace:ny,unindentListOnBackspace:ng,mergeTextIntoListOnDelete:nv,mergeTextIntoListOnBackspace:nm,clearListOnEnter:nk,indentListOnTab:nb,unindentListOnShiftTab:nx,inheritListLevel:(0,x.gg)({on:"insert.blocks",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.Ec)(t);if(!o)return!1;let r=n.blocks.at(0),i=n.blocks.at(1),a=(0,y.cd)(t.context,r)?r:(0,y.cd)(t.context,i)?i:void 0;if(!a)return!1;let l=o.node.level-a.level;return 0!==l&&{levelDifference:l,insertedListBlock:a}},actions:[(e,t)=>{let{snapshot:n,event:o}=e,{levelDifference:r,insertedListBlock:i}=t,a=!0,l=!1;return[(0,x.OU)({...o,blocks:o.blocks.map(e=>(e._key===i._key&&(l=!0),a?l&&a&&(0,y.cd)(n.context,e)?{...e,level:Math.min(10,Math.max(1,e.level+r))}:(l&&(a=!1),e):e))})]}]}),inheritListItem:(0,x.gg)({on:"insert.blocks",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.Ec)(t);if(!o||(0,g.PF)(t.context,o.node))return!1;let r=n.blocks.at(0),i=n.blocks.at(1),a=(0,y.cd)(t.context,r)?r:(0,y.cd)(t.context,i)?i:void 0;return!!a&&o.node.level===a.level&&o.node.listItem!==a.listItem&&{listItem:o.node.listItem,insertedListBlock:a}},actions:[(e,t)=>{let{snapshot:n,event:o}=e,{listItem:r,insertedListBlock:i}=t,a=!0,l=!1;return[(0,x.OU)({...o,blocks:o.blocks.map(e=>(e._key===i._key&&(l=!0),a?l&&a&&(0,y.cd)(n.context,e)?{...e,listItem:e.level===i.level?r:e.listItem}:(l&&(a=!1),e):e))})]}]}),inheritListProperties:(0,x.gg)({on:"insert.block",guard:e=>{let{snapshot:t,event:n}=e;if("auto"!==n.placement||n.block._type!==t.context.schema.block.name||void 0!==n.block.listItem)return!1;let o=(0,k.Ec)(t);return!!(o&&(0,g.PF)(t.context,o.node))&&{level:o.node.level,listItem:o.node.listItem}},actions:[(e,t)=>{let{event:n}=e,{level:o,listItem:r}=t;return[(0,x.OU)({...n,block:{...n.block,level:o,listItem:r}})]}]})},nE=[{addAnnotationOnCollapsedSelection:nn}.addAnnotationOnCollapsedSelection,nc.strongShortcut,nc.emShortcut,nc.underlineShortcut,nc.codeShortcut,...nu,ns.clickingAboveLonelyBlockObject,ns.clickingBelowLonelyBlockObject,ns.arrowDownOnLonelyBlockObject,ns.arrowUpOnLonelyBlockObject,ns.breakingBlockObject,ns.deletingEmptyTextBlockAfterBlockObject,ns.deletingEmptyTextBlockBeforeBlockObject,n_.clearListOnBackspace,n_.unindentListOnBackspace,n_.mergeTextIntoListOnDelete,n_.mergeTextIntoListOnBackspace,n_.clearListOnEnter,n_.indentListOnTab,n_.unindentListOnShiftTab,n_.inheritListLevel,n_.inheritListItem,n_.inheritListProperties,nf.breakingAtTheEndOfTextBlock,nf.breakingAtTheStartOfTextBlock,nf.breakingEntireDocument,nf.breakingEntireBlocks,nf.breakingInlineObject].map(e=>({behavior:e,priority:e_})),nw=[(0,x.gg)({on:"annotation.set",guard:e=>{var t;let{snapshot:n,event:o}=e,r=o.at[0]._key,i=o.at[2]._key,a=(0,m.I3)({...n,context:{...n.context,selection:{anchor:{path:[{_key:r}],offset:0},focus:{path:[{_key:r}],offset:0}}}});return!!a&&{blockKey:r,updatedMarkDefs:null===(t=a.node.markDefs)||void 0===t?void 0:t.map(e=>e._key===i?{...e,...o.props}:e)}},actions:[(e,t)=>{let{blockKey:n,updatedMarkDefs:o}=t;return[(0,x.OU)({type:"block.set",at:[{_key:n}],props:{markDefs:o}})]}]}),(0,x.gg)({on:"annotation.toggle",guard:e=>{let{snapshot:t,event:n}=e;return(0,k.kH)(n.annotation.name)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"annotation.remove",annotation:t.annotation})]}]}),(0,x.gg)({on:"annotation.toggle",guard:e=>{let{snapshot:t,event:n}=e;return!(0,k.kH)(n.annotation.name)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"annotation.add",annotation:t.annotation})]}]})],nS=[(0,x.gg)({on:"decorator.toggle",guard:e=>{let{snapshot:t,event:n}=e;return(0,k.md)(n.decorator)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"decorator.remove",decorator:t.decorator})]}]}),(0,x.gg)({on:"decorator.toggle",guard:e=>{let{snapshot:t,event:n}=e,o=n.at?(0,j.iO)({context:t.context,offsets:n.at}):null;return o?!(0,k.md)(n.decorator)({...t,context:{...t.context,selection:o}}):!(0,k.md)(n.decorator)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({...t,type:"decorator.add"})]}]})],nO=[(0,x.gg)({on:"delete.backward",guard:e=>{let{snapshot:t}=e;return!!t.context.selection&&{selection:t.context.selection}},actions:[(e,t)=>{let{event:n}=e,{selection:o}=t;return[(0,x.OU)({type:"delete",direction:"backward",unit:n.unit,at:o})]}]}),(0,x.gg)({on:"delete.forward",guard:e=>{let{snapshot:t}=e;return!!t.context.selection&&{selection:t.context.selection}},actions:[(e,t)=>{let{event:n}=e,{selection:o}=t;return[(0,x.OU)({type:"delete",direction:"forward",unit:n.unit,at:o})]}]}),(0,x.gg)({on:"delete.block",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"delete",at:{anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}}})]}]}),(0,x.gg)({on:"delete.child",guard:e=>{let{snapshot:t,event:n}=e,o=(0,m.Yz)({...t,context:{...t.context,selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}}});return!!o&&((0,y.dn)(t.context,o.node)?{selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:o.node.text.length}}}:{selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}})},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"delete",at:n})]}]}),(0,x.gg)({on:"delete.text",guard:e=>{let{snapshot:t,event:n}=e,o=(0,j.iO)({context:t.context,offsets:n.at});if(!o)return!1;let r=(0,k.Vj)({...t,context:{...t.context,value:t.context.value,selection:o}});return!!r&&{selection:r}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"delete",at:n})]}]})],nM=[(0,x.gg)({on:"insert.blocks",guard:e=>{let{event:t}=e;return"before"===t.placement},actions:[e=>{let{event:t}=e;return t.blocks.map((e,n)=>{var o;return(0,x.OU)({type:"insert.block",block:e,placement:0===n?"before":"after",select:null!==(o=t.select)&&void 0!==o?o:"end"})})}]}),(0,x.gg)({on:"insert.blocks",guard:e=>{let{event:t}=e;return"after"===t.placement},actions:[e=>{let{event:t}=e;return t.blocks.map(e=>{var n;return(0,x.OU)({type:"insert.block",block:e,placement:"after",select:null!==(n=t.select)&&void 0!==n?n:"end"})})}]}),(0,x.gg)({on:"insert.blocks",guard:e=>{let{snapshot:t,event:n}=e;if("auto"!==n.placement)return!1;let o=(0,m.I3)(t);return!!o&&{focusTextBlock:o}},actions:[(e,t)=>{var n;let{snapshot:o,event:r}=e,{focusTextBlock:i}=t;return 1===r.blocks.length?[(0,x.OU)({type:"insert.block",block:r.blocks[0],placement:"auto",select:null!==(n=r.select)&&void 0!==n?n:"end"})]:(0,g.PF)(o.context,i.node)?r.blocks.map((e,t)=>{var n;return(0,x.OU)({type:"insert.block",block:e,placement:0===t?"auto":"after",select:null!==(n=r.select)&&void 0!==n?n:"end"})}):r.blocks.flatMap((e,t)=>{var n,o,i;return 0===t?[(0,x.OU)({type:"split"}),(0,x.OU)({type:"select.previous block",select:"end"}),(0,x.OU)({type:"insert.block",block:e,placement:"auto",select:null!==(n=r.select)&&void 0!==n?n:"end"})]:t===r.blocks.length-1?[(0,x.OU)({type:"select.next block",select:"start"}),(0,x.OU)({type:"insert.block",block:e,placement:"auto",select:null!==(o=r.select)&&void 0!==o?o:"end"})]:[(0,x.OU)({type:"insert.block",block:e,placement:"after",select:null!==(i=r.select)&&void 0!==i?i:"end"})]})}]}),(0,x.gg)({on:"insert.blocks",guard:e=>{let{event:t}=e;return"auto"===t.placement},actions:[e=>{let{event:t}=e;return t.blocks.map((e,n)=>{var o;return(0,x.OU)({type:"insert.block",block:e,placement:0===n?"auto":"after",select:null!==(o=t.select)&&void 0!==o?o:"end"})})}]}),(0,x.gg)({on:"insert.break",actions:[()=>[(0,x.OU)({type:"split"})]]}),(0,x.gg)({on:"insert.soft break",actions:[()=>[(0,x.OU)({type:"insert.text",text:"\n"})]]})],nR=[(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{snapshot:t,event:n}=e;return no.break.guard(n.originEvent)&&(0,m.dI)(t)&&(0,k.fX)(t)},actions:[()=>[(0,x.OU)({type:"insert.break"})]]}),(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{event:t}=e;return no.lineBreak.guard(t.originEvent)},actions:[()=>[(0,x.OU)({type:"insert.soft break"})]]}),(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{event:t}=e;return no.history.undo.guard(t.originEvent)},actions:[()=>[(0,x.OU)({type:"history.undo"})]]}),(0,x.gg)({on:"keyboard.keydown",guard:e=>{let{event:t}=e;return no.history.redo.guard(t.originEvent)},actions:[()=>[(0,x.OU)({type:"history.redo"})]]})],nA=[(0,x.gg)({on:"list item.add",guard:e=>{let{snapshot:t}=e;return{selectedTextBlocks:(0,k.JK)(t)}},actions:[(e,t)=>{let{event:n}=e,{selectedTextBlocks:o}=t;return o.map(e=>(0,x.OU)({type:"block.set",at:e.path,props:{level:1,listItem:n.listItem}}))}]}),(0,x.gg)({on:"list item.remove",guard:e=>{let{snapshot:t}=e;return{selectedTextBlocks:(0,k.JK)(t)}},actions:[(e,t)=>{let{selectedTextBlocks:n}=t;return n.map(e=>(0,x.OU)({type:"block.unset",at:e.path,props:["level","listItem"]}))}]}),(0,x.gg)({on:"list item.toggle",guard:e=>{let{snapshot:t,event:n}=e;return(0,k.IA)(n.listItem)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"list item.remove",listItem:t.listItem})]}]}),(0,x.gg)({on:"list item.toggle",guard:e=>{let{snapshot:t,event:n}=e;return!(0,k.IA)(n.listItem)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"list item.add",listItem:t.listItem})]}]})],nN=[(0,x.gg)({on:"move.block up",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.nt)({...t,context:{...t.context,selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}}});return!!o&&{previousBlock:o}},actions:[(e,t)=>{let{event:n}=e,{previousBlock:o}=t;return[(0,x.OU)({type:"move.block",at:n.at,to:o.path})]}]}),(0,x.gg)({on:"move.block down",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.st)({...t,context:{...t.context,selection:{anchor:{path:n.at,offset:0},focus:{path:n.at,offset:0}}}});return!!o&&{nextBlock:o}},actions:[(e,t)=>{let{event:n}=e,{nextBlock:o}=t;return[(0,x.OU)({type:"move.block",at:n.at,to:o.path})]}]})],nI=[(0,x.gg)({on:"select.previous block",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.nt)(t);if(!o)return!1;let r="end"===n.select?(0,g.sQ)({context:t.context,block:o}):(0,y.qv)({context:t.context,block:o});return{selection:{anchor:r,focus:r}}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"select",at:n})]}]}),(0,x.gg)({on:"select.next block",guard:e=>{let{snapshot:t,event:n}=e,o=(0,k.st)(t);if(!o)return!1;let r="end"===n.select?(0,g.sQ)({context:t.context,block:o}):(0,y.qv)({context:t.context,block:o});return{selection:{anchor:r,focus:r}}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"select",at:n})]}]})],nT=[(0,x.gg)({on:"split",guard:e=>{let{snapshot:t}=e;return(0,m.dI)(t)&&(0,k.fX)(t)},actions:[]}),(0,x.gg)({on:"split",guard:e=>{let{snapshot:t}=e;return(0,m.dI)(t)&&(0,k.ii)(t)},actions:[]}),(0,x.gg)({on:"split",guard:e=>{let{snapshot:t}=e,n=t.context.selection;if(!n||(0,g.dI)(n))return!1;let o=(0,k.Dm)(t),r=(0,k.Zq)(t);return!!o&&!!r&&!!(!(0,y.dz)(t.context,o.node)&&(0,y.dz)(t.context,r.node))&&{selection:n}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"delete",at:n})]}]}),(0,x.gg)({on:"split",guard:e=>{let{snapshot:t}=e,n=t.context.selection;return!(!n||(0,g.dI)(n))&&{selection:n}},actions:[(e,t)=>{let{selection:n}=t;return[(0,x.OU)({type:"delete",at:n}),(0,x.OU)({type:"split"})]}]}),(0,x.gg)({on:"split",guard:e=>{let{snapshot:t}=e,n=t.context.selection;if(!n||!(0,g.dI)(n))return!1;let o=(0,y.VG)(n),r=(0,m.I3)(t);if(!r)return!1;let i={anchor:o,focus:(0,g.sQ)({context:t.context,block:r})},a=(0,y.IX)({block:(0,L.U)({context:{...t.context,selection:i},block:r.node}),context:t.context,options:{refreshKeys:!0,validateFields:!0}});return!!a&&{newTextBlock:a,newTextBlockSelection:i}},actions:[(e,t)=>{let{newTextBlock:n,newTextBlockSelection:o}=t;return(0,g.dI)(o)?[(0,x.OU)({type:"insert.block",block:n,placement:"after",select:"start"})]:[(0,x.OU)({type:"delete",at:o}),(0,x.OU)({type:"insert.block",block:n,placement:"after",select:"start"})]}]})],nB=[(0,x.gg)({on:"style.add",guard:e=>{let{snapshot:t}=e;return{selectedTextBlocks:(0,k.JK)(t)}},actions:[(e,t)=>{let{event:n}=e,{selectedTextBlocks:o}=t;return o.map(e=>(0,x.OU)({type:"block.set",at:e.path,props:{style:n.style}}))}]}),(0,x.gg)({on:"style.remove",guard:e=>{let{snapshot:t}=e;return{selectedTextBlocks:(0,k.JK)(t)}},actions:[(e,t)=>{let{selectedTextBlocks:n}=t;return n.map(e=>(0,x.OU)({type:"block.unset",at:e.path,props:["style"]}))}]}),(0,x.gg)({on:"style.toggle",guard:e=>{let{snapshot:t,event:n}=e;return(0,k.S9)(n.style)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"style.remove",style:t.style})]}]}),(0,x.gg)({on:"style.toggle",guard:e=>{let{snapshot:t,event:n}=e;return!(0,k.S9)(n.style)(t)},actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"style.add",style:t.style})]}]})],nC=(0,x.gg)({on:"deserialize",guard:e=>{let t,{snapshot:n,event:o}=e,r=[];for(let e of n.context.converters){let i=o.originEvent.originEvent.dataTransfer.getData(e.mimeType);if(!i)continue;let a=e.deserialize({snapshot:n,event:{type:"deserialize",data:i}});if("deserialization.success"===a.type){t=a;break}r.push(a)}return t||{type:"deserialization.failure",mimeType:"*/*",reason:r.map(e=>e.reason).join(", ")}},actions:[(e,t)=>{let{event:n}=e;return[(0,x.OU)({...t,originEvent:n.originEvent})]}]}),nj=(0,x.gg)({on:"serialize",guard:e=>{let{snapshot:t,event:n}=e;if(0===t.context.converters.length)return!1;let o=t.context.converters.map(e=>e.serialize({snapshot:t,event:{...n,originEvent:n.originEvent.type}}));return 0!==o.length&&o},actions:[(e,t)=>{let{event:n}=e;return t.map(e=>(0,x.OU)({...e,originEvent:n.originEvent}))}]}),nL=[(0,x.gg)({on:"clipboard.copy",guard:e=>{let{snapshot:t}=e,n=(0,m.Cj)(t),o=(0,m.dI)(t);return n&&o},actions:[]}),(0,x.gg)({on:"clipboard.copy",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"serialize",originEvent:t})]}]}),(0,x.gg)({on:"clipboard.cut",guard:e=>{let{snapshot:t}=e,n=(0,m.Cj)(t),o=(0,m.dI)(t);return n&&o},actions:[]}),(0,x.gg)({on:"clipboard.cut",guard:e=>{let{snapshot:t}=e;return!!t.context.selection&&{selection:t.context.selection}},actions:[(e,t)=>{let{event:n}=e,{selection:o}=t;return[(0,x.OU)({type:"serialize",originEvent:n}),(0,x.OU)({type:"delete",at:o})]}]}),(0,x.gg)({on:"drag.dragstart",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"serialize",originEvent:t})]}]}),(0,x.gg)({on:"serialization.success",actions:[e=>{let{event:t}=e;return[{type:"effect",effect:()=>{t.originEvent.originEvent.dataTransfer.setData(t.mimeType,t.data)}}]}]}),(0,x.gg)({on:"serialization.failure",actions:[e=>{let{event:t}=e;return[{type:"effect",effect:()=>{console.warn("Serialization of ".concat(t.mimeType,' failed with reason "').concat(t.reason,'"'))}}]}]}),(0,x.gg)({on:"deserialization.success",guard:e=>{let{snapshot:t,event:n}=e;if((0,m.I3)(t)&&"text/plain"===n.mimeType&&"clipboard.paste"===n.originEvent.type){let e=(0,k.WH)(t);return{activeAnnotations:(0,k.$s)(t),activeDecorators:e,textRuns:n.data.flatMap(e=>(0,y.dz)(t.context,e)?[(0,y.NL)(e)]:[])}}return!1},actions:[(e,t)=>{let{activeAnnotations:n,activeDecorators:o,textRuns:r}=t;return r.flatMap((e,t)=>t!==r.length-1?[(0,x.OU)({type:"insert.span",text:e,decorators:o,annotations:n.map(e=>{let{_key:t,_type:n,...o}=e;return{name:n,value:o}})}),(0,x.OU)({type:"insert.break"})]:[(0,x.OU)({type:"insert.span",text:e,decorators:o,annotations:n.map(e=>{let{_key:t,_type:n,...o}=e;return{name:n,value:o}})})])}]}),(0,x.gg)({on:"deserialization.success",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"insert.blocks",blocks:t.data,placement:"auto"})]}]}),(0,x.gg)({on:"deserialization.failure",actions:[e=>{let{event:t}=e;return[{type:"effect",effect:()=>{console.warn("Deserialization of ".concat(t.mimeType,' failed with reason "').concat(t.reason,'"'))}}]}]}),(0,x.gg)({on:"clipboard.paste",guard:e=>{let{snapshot:t}=e;return!!(t.context.selection&&(0,m.sC)(t))&&{selection:t.context.selection}},actions:[(e,t)=>{let{event:n}=e,{selection:o}=t;return[(0,x.OU)({type:"delete",at:o}),(0,x.OU)({type:"deserialize",originEvent:n})]}]}),(0,x.gg)({on:"clipboard.paste",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"deserialize",originEvent:t})]}]}),(0,x.gg)({on:"input.*",actions:[e=>{let{event:t}=e;return[(0,x.OU)({type:"deserialize",originEvent:t})]}]}),...nw,...nS,...nO,...nM,...nR,...nA,...nN,...nB,...nI,...nT,nC,nj];function nD(e){return!nG(e)&&!nP(e)&&!nU(e)}let nY=["annotation.set","annotation.toggle","decorator.toggle","delete.backward","delete.block","delete.child","delete.forward","delete.text","deserialize","deserialization.success","deserialization.failure","insert.blocks","insert.break","insert.soft break","list item.add","list item.remove","list item.toggle","move.block down","move.block up","select.previous block","select.next block","serialize","serialization.success","serialization.failure","split","style.add","style.remove","style.toggle"];function nU(e){return nY.includes(e.type)}let nz=["clipboard.copy","clipboard.cut","clipboard.paste","drag.dragstart","drag.drag","drag.dragend","drag.dragenter","drag.dragover","drag.dragleave","drag.drop","input.*","keyboard.keydown","keyboard.keyup","mouse.click"];function nP(e){return nz.includes(e.type)}function nG(e){return e.type.startsWith("custom.")}let nF=W("behaviors:event");function nK(e){return nP(e)?"native":nU(e)?"synthetic":nG(e)?"custom":"synthetic"}let nV=W("editor machine"),nW=(0,w.cY)({types:{context:{},events:{},emitted:{},input:{},tags:{}},actions:{"add behavior to context":(0,S.a)({behaviors:e=>{let{context:t,event:n}=e;return(0,w.ZD)(n,"add behavior"),new Set([...t.behaviors,n.behaviorConfig])},behaviorsSorted:!1}),"remove behavior from context":(0,S.a)({behaviors:e=>{let{context:t,event:n}=e;return(0,w.ZD)(n,"remove behavior"),t.behaviors.delete(n.behaviorConfig),new Set([...t.behaviors])}}),"emit patch event":(0,O.a)(e=>{let{event:t}=e;return(0,w.ZD)(t,"internal.patch"),t}),"emit mutation event":(0,O.a)(e=>{let{event:t}=e;return(0,w.ZD)(t,"mutation"),t}),"emit read only":(0,O.a)({type:"read only"}),"emit editable":(0,O.a)({type:"editable"}),"defer event":(0,S.a)({pendingEvents:e=>{let{context:t,event:n}=e;return(0,w.ZD)(n,["internal.patch","mutation"]),[...t.pendingEvents,n]}}),"emit pending events":(0,O.e)(e=>{let{context:t,enqueue:n}=e;for(let e of t.pendingEvents)n.emit(e)}),"emit ready":(0,O.a)({type:"ready"}),"clear pending events":(0,S.a)({pendingEvents:[]}),"defer incoming patches":(0,S.a)({pendingIncomingPatchesEvents:e=>{let{context:t,event:n}=e;return"patches"===n.type?[...t.pendingIncomingPatchesEvents,n]:t.pendingIncomingPatchesEvents}}),"emit pending incoming patches":(0,O.e)(e=>{let{context:t,enqueue:n}=e;for(let e of t.pendingIncomingPatchesEvents)n.emit(e)}),"clear pending incoming patches":(0,S.a)({pendingIncomingPatchesEvents:[]}),"handle blur":e=>{let{event:t}=e;(0,w.ZD)(t,"blur");try{p.F3.blur(t.editor)}catch(e){console.error(Error("Failed to blur editor: ".concat(e.message)))}},"handle focus":e=>{let{context:t}=e;if(!t.slateEditor){console.error("No Slate editor found to focus");return}try{let e=t.slateEditor.selection;p.F3.focus(t.slateEditor),e&&u.YR.select(t.slateEditor,e)}catch(e){console.error(Error("Failed to focus editor: ".concat(e.message)))}},"handle behavior event":e=>{let{context:t,event:n,self:o}=e;(0,w.ZD)(n,["behavior event"]);try{let e=[...t.behaviors.values()].map(e=>e.behavior);!function e(t){let{mode:n,behaviors:o,remainingEventBehaviors:r,event:i,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:d,sendBack:u}=t;nF("(".concat(n,":").concat(nK(i),")"),JSON.stringify(i,null,2));let p=[...r,...nL].filter(e=>{if("*"===e.on)return!0;let[t]=e.on.includes("*")&&e.on.includes(".")?e.on.split("."):[void 0],[n]=i.type.includes(".")?i.type.split("."):[void 0];return void 0!==t&&void 0!==n&&t===n||void 0!==t&&void 0===n&&t===i.type||e.on===i.type});if(0===p.length&&nD(i)){null==d||d.preventDefault(),tW(a,()=>{nF("(execute:".concat(nK(i),")"),JSON.stringify(i,null,2)),tK({context:{keyGenerator:l,schema:s},operation:{...i,editor:a}})}),a.onChange();return}let h=c(),f=!1,y=!1,g=-1;for(let t of p){g++;let n=!1;try{n=void 0===t.guard||t.guard({snapshot:h,event:i,dom:nt(u,a)})}catch(e){console.error(Error('Evaluating guard for "'.concat(i.type,'" failed due to: ').concat(e.message)))}if(n){for(let r of(y=!0,t.actions)){let t=c(),h=[];try{h=r({snapshot:t,event:i,dom:nt(u,a)},n)}catch(e){console.error(Error('Evaluating actions for "'.concat(i.type,'" failed due to: ').concat(e.message)))}if(0!==h.length){if(f=h.some(e=>"raise"===e.type||"execute"===e.type)||!h.some(e=>"forward"===e.type),h.some(e=>"execute"===e.type)){!function(e,t){let n=tA.get(e);if(n){t();return}tA.set(e,null!=n?n:{undoStepId:ek()}),t(),tA.set(e,void 0)}(a,()=>{for(let t of h){if("effect"===t.type){try{t.effect()}catch(e){console.error(Error('Executing effect as a result of "'.concat(i.type,'" failed due to: ').concat(e.message)))}continue}if("forward"===t.type){e({mode:"forward",behaviors:o,remainingEventBehaviors:p.slice(g+1),event:t.event,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:d,sendBack:u});continue}if("raise"===t.type){e({mode:"raise",behaviors:o,remainingEventBehaviors:o,event:t.event,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:d,sendBack:u});continue}e({mode:"execute",behaviors:o,remainingEventBehaviors:[],event:t.event,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:void 0,sendBack:u})}});continue}for(let t of h){if("effect"===t.type){try{t.effect()}catch(e){console.error(Error('Executing effect as a result of "'.concat(i.type,'" failed due to: ').concat(e.message)))}continue}if("forward"===t.type){e({mode:"forward",behaviors:o,remainingEventBehaviors:p.slice(g+1),event:t.event,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:d,sendBack:u});continue}if("raise"===t.type){e({mode:"raise",behaviors:o,remainingEventBehaviors:o,event:t.event,editor:a,keyGenerator:l,schema:s,getSnapshot:c,nativeEvent:d,sendBack:u});continue}"execute"===t.type&&console.error("Unexpected action type: `execute`")}}}break}}!y&&nD(i)?(null==d||d.preventDefault(),tW(a,()=>{nF("(execute:".concat(nK(i),")"),JSON.stringify(i,null,2)),tK({context:{keyGenerator:l,schema:s},operation:{...i,editor:a}})}),a.onChange()):f&&(null==d||d.preventDefault())}({mode:"raise",behaviors:e,remainingEventBehaviors:e,event:n.behaviorEvent,editor:n.editor,keyGenerator:t.keyGenerator,schema:t.schema,getSnapshot:()=>(function(e){let{converters:t,editor:n,keyGenerator:o,readOnly:r,schema:i}=e,a=n.selection?ei({schema:i,editor:n,range:n.selection}):null,l={converters:t,keyGenerator:o,readOnly:r,schema:i,selection:a,value:n.value};return{blockIndexMap:n.blockIndexMap,context:l,decoratorState:n.decoratorState}})({converters:[...t.converters],editor:n.editor,keyGenerator:t.keyGenerator,readOnly:o.getSnapshot().matches({"edit mode":"read only"}),schema:t.schema}),nativeEvent:n.nativeEvent,sendBack:e=>o.send(e)})}catch(e){console.error(Error('Raising "'.concat(n.behaviorEvent.type,'" failed due to: ').concat(e.message)))}},"sort behaviors":(0,S.a)({behaviors:e=>{let{context:t}=e;return t.behaviorsSorted?t.behaviors:new Set(function(e){if(0===e.length)return[];let t=e.filter(e=>void 0!==e.priority),n=e.filter(e=>void 0===e.priority);if(0===t.length)return e;let o=new Map(t.map(e=>[e.priority.id,e])),r=new Map,i=new Map;function a(e){r.has(e)||(r.set(e,new Set),i.set(e,0))}for(let e of t)a(e.priority.id);function l(e,t){var n,o;r.has(e)&&r.has(t)&&(null===(n=r.get(e))||void 0===n||n.add(t),i.set(t,(null!==(o=i.get(t))&&void 0!==o?o:0)+1))}for(let e of t){let t=e.priority.id,n=new Set,o=e.priority.reference;for(;o;){let e=o.priority.id;if(a(e),n.has(e))throw Error("Circular dependency detected in priorities");n.add(e),"higher"===o.importance?l(t,e):l(e,t),o=o.priority.reference}}let s=[];for(let[e,t]of i)0===t&&s.push(e);let c=[];for(;s.length>0;){var d,u;let e=s.shift(),t=o.get(e);for(let n of(t&&c.push(t),null!==(d=r.get(e))&&void 0!==d?d:[])){let e=(null!==(u=i.get(n))&&void 0!==u?u:0)-1;i.set(n,e),0===e&&s.push(n)}}for(let e of t)c.includes(e)||c.push(e);return[...c,...n]}([...t.behaviors.values()]))},behaviorsSorted:!0})},guards:{"slate is busy":e=>{let{context:t}=e;return!!t.slateEditor&&t.slateEditor.operations.length>0}}}).createMachine({id:"editor",context:e=>{var t,n;let{input:o}=e;return{behaviors:new Set(nE),behaviorsSorted:!1,converters:new Set(null!==(t=o.converters)&&void 0!==t?t:[]),getLegacySchema:o.getLegacySchema,keyGenerator:o.keyGenerator,pendingEvents:[],pendingIncomingPatchesEvents:[],schema:o.schema,selection:null,initialReadOnly:null!==(n=o.readOnly)&&void 0!==n&&n,maxBlocks:o.maxBlocks,initialValue:o.initialValue}},on:{"add behavior":{actions:"add behavior to context"},"remove behavior":{actions:"remove behavior from context"},"update maxBlocks":{actions:(0,S.a)({maxBlocks:e=>{let{event:t}=e;return t.maxBlocks}})},"update selection":{actions:[(0,S.a)({selection:e=>{let{event:t}=e;return t.selection}}),(0,O.a)(e=>{let{event:t}=e;return{...t,type:"selection"}})]},"set drag ghost":{actions:(0,S.a)({dragGhost:e=>{let{event:t}=e;return t.ghost}})}},type:"parallel",states:{"edit mode":{initial:"read only",states:{"read only":{initial:"determine initial edit mode",on:{"behavior event":{actions:["sort behaviors","handle behavior event"],guard:e=>{let{event:t}=e;return"clipboard.copy"===t.behaviorEvent.type||"mouse.click"===t.behaviorEvent.type||"serialize"===t.behaviorEvent.type||"serialization.failure"===t.behaviorEvent.type||"serialization.success"===t.behaviorEvent.type||"select"===t.behaviorEvent.type}}},states:{"determine initial edit mode":{entry:[()=>{nV("entry: edit mode->read only->determine initial edit mode")}],exit:[()=>{nV("exit: edit mode->read only->determine initial edit mode")}],on:{"done syncing value":[{target:"#editor.edit mode.read only.read only",guard:e=>{let{context:t}=e;return t.initialReadOnly}},{target:"#editor.edit mode.editable"}]}},"read only":{entry:[()=>{nV("entry: edit mode->read only->read only")}],exit:[()=>{nV("exit: edit mode->read only->read only")}],on:{"update readOnly":{guard:e=>{let{event:t}=e;return!t.readOnly},target:"#editor.edit mode.editable",actions:["emit editable"]}}}}},editable:{on:{"update readOnly":{guard:e=>{let{event:t}=e;return t.readOnly},target:"#editor.edit mode.read only.read only",actions:["emit read only"]},"behavior event":{actions:["sort behaviors","handle behavior event"]},blur:{actions:"handle blur"},focus:{target:".focusing",actions:[(0,S.a)({slateEditor:e=>{let{event:t}=e;return t.editor}})]}},initial:"idle",states:{idle:{entry:[()=>{nV("entry: edit mode->editable->idle")}],exit:[()=>{nV("exit: edit mode->editable-idle")}],on:{dragstart:{actions:[(0,S.a)({internalDrag:e=>{let{event:t}=e;return{origin:t.origin}}})],target:"dragging internally"}}},focusing:{initial:"checking if busy",states:{"checking if busy":{entry:[()=>{nV("entry: edit mode->editable->focusing->checking if busy")}],exit:[()=>{nV("exit: edit mode->editable->focusing->checking if busy")}],always:[{guard:"slate is busy",target:"busy"},{target:"#editor.edit mode.editable.idle",actions:["handle focus"]}]},busy:{entry:[()=>{nV("entry: edit mode->editable->focusing-busy")}],exit:[()=>{nV("exit: edit mode->editable->focusing->busy")}],after:{10:{target:"checking if busy"}}}}},"dragging internally":{entry:[()=>{nV("entry: edit mode->editable->dragging internally")}],exit:[()=>{nV("exit: edit mode->editable->dragging internally")},e=>{let{context:t}=e;if(t.dragGhost)try{var n;null===(n=t.dragGhost.parentNode)||void 0===n||n.removeChild(t.dragGhost)}catch(e){console.error(Error("Removing the drag ghost failed due to: ".concat(e.message)))}},(0,S.a)({dragGhost:void 0}),(0,S.a)({internalDrag:void 0})],tags:["dragging internally"],on:{dragend:{target:"idle"},drop:{target:"idle"}}}}}}},setup:{initial:"setting up",states:{"setting up":{entry:[()=>{nV("entry: setup->setting up")}],exit:[()=>{nV("exit: setup->setting up")},"emit ready","emit pending incoming patches","clear pending incoming patches"],on:{"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"},"done syncing value":{target:"set up"},patches:{actions:["defer incoming patches"]}}},"set up":{type:"parallel",states:{"value sync":{initial:"idle",states:{idle:{entry:[()=>{nV("entry: setup->set up->value sync->idle")}],exit:[()=>{nV("exit: setup->set up->value sync->idle")}],on:{patches:{actions:[(0,O.a)(e=>{let{event:t}=e;return t})]},"syncing value":{target:"syncing value"}}},"syncing value":{entry:[()=>{nV("entry: setup->set up->value sync->syncing value")}],exit:[()=>{nV("exit: setup->set up->value sync->syncing value")},"emit pending incoming patches","clear pending incoming patches"],on:{patches:{actions:["defer incoming patches"]},"done syncing value":{target:"idle"}}}}},writing:{initial:"pristine",states:{pristine:{initial:"idle",states:{idle:{entry:[()=>{nV("entry: setup->set up->writing->pristine->idle")}],exit:[()=>{nV("exit: setup->set up->writing->pristine->idle")}],on:{normalizing:{target:"normalizing"},"internal.patch":{actions:"defer event",target:"#editor.setup.set up.writing.dirty"},mutation:{actions:"defer event",target:"#editor.setup.set up.writing.dirty"}}},normalizing:{entry:[()=>{nV("entry: setup->set up->writing->pristine->normalizing")}],exit:[()=>{nV("exit: setup->set up->writing->pristine->normalizing")}],on:{"done normalizing":{target:"idle"},"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:[()=>{nV("entry: setup->set up->writing->dirty")},"emit pending events","clear pending events"],exit:[()=>{nV("exit: setup->set up->writing->dirty")}],on:{"internal.patch":{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}}}}}}});function n$(e){var t,n,o;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let r=null===(t=e.of)||void 0===t?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!r)throw Error("Block type is not defined in this schema (required)");let i=null===(n=r.fields)||void 0===n?void 0:n.find(e=>"children"===e.name);if(!i)throw Error("Children field for block type found in schema (required)");let a=i.type.of;if(!a)throw Error("Valid types for block children not found in schema (required)");let l=a.find(e=>"span"===e.name);if(!l)throw Error("Span type not found in schema (required)");let s=a.filter(e=>"span"!==e.name)||[],c=(null===(o=e.of)||void 0===o?void 0:o.filter(e=>e.name!==r.name))||[];return{styles:function(e){var t,n,o;let r=null===(t=e.fields)||void 0===t?void 0:t.find(e=>"style"===e.name);if(!r)throw Error("A field with name 'style' is not defined in the block type (required).");let i=(null===(n=r.type.options)||void 0===n?void 0:n.list)&&(null===(o=r.type.options.list)||void 0===o?void 0:o.filter(e=>e.value));if(!i||0===i.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return i}(r),decorators:l.decorators,lists:function(e){var t,n;let o=null===(t=e.fields)||void 0===t?void 0:t.find(e=>"listItem"===e.name);if(!o)throw Error("A field with name 'listItem' is not defined in the block type (required).");let r=(null===(n=o.type.options)||void 0===n?void 0:n.list)&&o.type.options.list.filter(e=>e.value);if(!r)throw Error("The list field need at least to be an empty array");return r}(r),block:r,span:l,portableText:e,inlineObjects:s,blockObjects:c,annotations:l.annotations}}let nJ="tmp-".concat(ek(),"-image"),nq="tmp-".concat(ek(),"-url"),nH={image:nJ,url:nq},nX={[nJ]:"image",[nq]:"url"},nZ={image:"Image",url:"URL"},nQ=W("mutation-machine"),n0=(0,w.cY)({types:{context:{},events:{},input:{},emitted:{}},actions:{"assign readOnly":(0,S.a)({readOnly:e=>{let{context:t,event:n}=e;return"update readOnly"===n.type?n.readOnly:t.readOnly}}),"emit patch":(0,O.a)(e=>{let{event:t}=e;return(0,w.ZD)(t,"patch"),{type:"patch",patch:t.patch}}),"emit has pending mutations":(0,O.a)({type:"has pending mutations"}),"emit mutations":(0,O.e)(e=>{let{context:t,enqueue:n}=e;for(let e of t.pendingMutations)n.emit({type:"mutation",patches:e.patches,snapshot:e.value})}),"clear pending mutations":(0,S.a)({pendingMutations:[]}),"defer mutation":(0,S.a)({pendingMutations:e=>{let{context:t,event:n}=e;if((0,w.ZD)(n,"patch"),0===t.pendingMutations.length)return[{operationId:n.operationId,value:n.value,patches:[n.patch]}];let o=t.pendingMutations.at(-1);return o&&o.operationId===n.operationId?t.pendingMutations.slice(0,-1).concat({value:n.value,operationId:o.operationId,patches:[...o.patches,n.patch]}):t.pendingMutations.concat({value:n.value,operationId:n.operationId,patches:[n.patch]})}}),"clear pending patch events":(0,S.a)({pendingPatchEvents:[]}),"defer patch":(0,S.a)({pendingPatchEvents:e=>{let{context:t,event:n}=e;return"patch"===n.type?[...t.pendingPatchEvents,n]:t.pendingPatchEvents}}),"emit pending patch events":(0,O.e)(e=>{let{context:t,enqueue:n}=e;for(let e of t.pendingPatchEvents)n.emit(e)})},actors:{"type listener":(0,M.E9)(e=>{let{input:t,sendBack:n}=e,o=t.slateEditor.apply;return t.slateEditor.apply=e=>{"insert_text"===e.type||"remove_text"===e.type?n({type:"typing"}):n({type:"not typing"}),o(e)},()=>{t.slateEditor.apply=o}}),"mutation debouncer":(0,M.E9)(e=>{let{sendBack:t}=e,n=setInterval(()=>{t({type:"mutation delay passed"})},0);return()=>{clearInterval(n)}})},guards:{"is read-only":e=>{let{context:t}=e;return t.readOnly},"is typing":(0,R.f)({typing:"typing"}),"slate is normalizing":e=>{let{context:t}=e;return u.ML.isNormalizing(t.slateEditor)}},delays:{"type debounce":250}}).createMachine({id:"mutation",context:e=>{let{input:t}=e;return{pendingMutations:[],pendingPatchEvents:[],readOnly:t.readOnly,schema:t.schema,slateEditor:t.slateEditor}},on:{"update readOnly":{actions:["assign readOnly"]}},type:"parallel",states:{typing:{initial:"idle",invoke:{src:"type listener",input:e=>{let{context:t}=e;return{slateEditor:t.slateEditor}}},states:{idle:{entry:[()=>{nQ("entry: typing->idle")}],exit:[()=>{nQ("exit: typing->idle"),nQ("entry: typing->typing")}],on:{typing:{target:"typing"}}},typing:{after:{"type debounce":{target:"idle",actions:[()=>{nQ("exit: typing->typing")}]}},on:{"not typing":{target:"idle"},typing:{target:"typing",reenter:!0}}}}},mutations:{initial:"idle",states:{idle:{entry:[()=>{nQ("entry: mutations->idle")}],exit:[()=>{nQ("exit: mutations->idle")}],on:{patch:[{guard:"is read-only",actions:["defer patch","defer mutation"],target:"has pending mutations"},{actions:["emit patch","defer mutation"],target:"has pending mutations"}]}},"has pending mutations":{entry:[()=>{nQ("entry: mutations->has pending mutations")},"emit has pending mutations"],exit:[()=>{nQ("exit: mutations->has pending mutations")}],invoke:{src:"mutation debouncer"},on:{"mutation delay passed":{guard:(0,R.e)([(0,R.n)("is read-only"),(0,R.n)("is typing"),"slate is normalizing"]),target:"idle",actions:["emit pending patch events","clear pending patch events","emit mutations","clear pending mutations"]},patch:[{guard:"is read-only",actions:["defer patch","defer mutation"]},{actions:["emit patch","defer mutation"]}]}}}}}}),n1=W("API:editable"),n2=(0,w.cY)({types:{context:{},events:{},emitted:{}}}).createMachine({id:"relay",context:{prevSelection:null,lastEventWasFocused:!1},on:{focused:{actions:[(0,S.a)({lastEventWasFocused:!0}),(0,O.a)(e=>{let{event:t}=e;return t})]},selection:[{guard:e=>{let{context:t}=e;return t.lastEventWasFocused},actions:[(0,S.a)({prevSelection:e=>{let{event:t}=e;return t.selection}}),(0,O.a)(e=>{let{event:t}=e;return t}),(0,S.a)({lastEventWasFocused:!1})]},{guard:e=>{let{context:t,event:n}=e;return t.prevSelection!==n.selection},actions:[(0,S.a)({prevSelection:e=>{let{event:t}=e;return t.selection}}),(0,O.a)(e=>{let{event:t}=e;return t}),(0,S.a)({lastEventWasFocused:!1})]}],"*":{actions:[(0,O.a)(e=>{let{event:t}=e;return t}),(0,S.a)({lastEventWasFocused:!1})]}}});function n3(e,t,n){let o=null,r=!0,i=[t.span.name,...t.inlineObjects.map(e=>e.name)],a=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,l)=>{if(!K(e))return o={patches:[(0,C.zN)([l])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:l}}},!0;if(!e._key||"string"!=typeof e._key)return o={patches:[(0,C.t8)({...e,_key:n()},[l])],description:"Block at index ".concat(l," is missing required _key."),action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:l}}},!0;if(!e._type||!a.includes(e._type)){if("block"===e._type){let n=t.block.name;return o={patches:[(0,C.t8)({...e,_type:n},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(n,"'"),action:"Use type '".concat(n,"'"),item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return o=!e._type&&(0,y.dz)({schema:t},{...e,_type:t.block.name})?{patches:[(0,C.t8)({...e,_type:t.block.name},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' is missing a type name. According to the schema, the block type name is '").concat(t.block.name,"'"),action:"Use type '".concat(t.block.name,"'"),item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,C.zN)([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,C.zN)([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' is missing an _type property"),action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return o={patches:[(0,C.t8)({children:[]},[{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' has a invalid required property 'children'."),action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let r={_type:t.span.name,_key:n(),text:"",marks:[]};return o={autoResolve:!0,patches:[(0,C.Cb)([],[{_key:e._key},"children"]),(0,C.$T)([r],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let a=_(T(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=_(e.markDefs.map(e=>e._key).filter(e=>!a.includes(e)));if(t.length>0)return o={autoResolve:!0,patches:t.map(t=>(0,C.zN)([{_key:e._key},"markDefs",{_key:t}])),description:"Block contains orphaned data (unused mark definitions): ".concat(t.join(", "),"."),action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let l=a.filter(e=>!t.decorators.map(e=>e.name).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(l.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>l.includes(e)));if(n){let t=l.join(", ");return o={autoResolve:!0,patches:n.map(t=>(0,C.t8)((t.marks||[]).filter(e=>!l.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(t,") not supported by the current content model."),action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:l.map(e=>e.toString())}}},!0}}e.children.some((r,a)=>{if(!K(r))return o={patches:[(0,C.zN)([{_key:e._key},"children",a])],description:"Child at index '".concat(a,"' in block with key '").concat(e._key,"' is not an object."),action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:a}}},!0;if(!r._key||"string"!=typeof r._key){let t={...r,_key:n()};return o={autoResolve:!0,patches:[(0,C.t8)(t,[{_key:e._key},"children",a])],description:"Child at index ".concat(a," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:a}}},!0}return r._type?i.includes(r._type)?r._type===t.span.name&&"string"!=typeof r.text&&(o={patches:[(0,C.t8)({...r,text:""},[{_key:e._key},"children",{_key:r._key}])],description:"Child with _key '".concat(r._key,"' in block with key '").concat(e._key,"' has missing or invalid text property!"),action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:r._key}}},!0):(o={patches:[(0,C.zN)([{_key:e._key},"children",{_key:r._key}])],description:"Child with _key '".concat(r._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(r._type,")."),action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:r._key,childType:r._type}}},!0):(o={patches:[(0,C.zN)([{_key:e._key},"children",{_key:r._key}])],description:"Child with _key '".concat(r._key,"' in block with key '").concat(e._key,"' is missing '_type' property."),action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:r._key}}},!0)})&&(r=!1)}return!1})&&(r=!1),{valid:r,resolution:o,value:e}):{valid:!1,resolution:{patches:[(0,C.zN)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}let n8=W("sync machine"),n6=(0,M.E9)(e=>{let{sendBack:t,input:n}=e;n4({context:n.context,sendBack:t,slateEditor:n.slateEditor,value:n.value,streamBlocks:n.streamBlocks})}),n9=(0,w.cY)({types:{context:{},input:{},events:{},emitted:{}},actions:{"assign initial value synced":(0,S.a)({initialValueSynced:!0}),"assign readOnly":(0,S.a)({readOnly:e=>{let{event:t}=e;return(0,w.ZD)(t,"update readOnly"),t.readOnly}}),"assign pending value":(0,S.a)({pendingValue:e=>{let{event:t}=e;return(0,w.ZD)(t,"update value"),t.value}}),"clear pending value":(0,S.a)({pendingValue:void 0}),"assign previous value":(0,S.a)({previousValue:e=>{let{event:t}=e;return(0,w.ZD)(t,"done syncing"),t.value}}),"emit done syncing value":(0,O.a)({type:"done syncing value"}),"emit syncing value":(0,O.a)({type:"syncing value"})},guards:{"initial value synced":e=>{let{context:t}=e;return t.initialValueSynced},"is busy":e=>{var t;let{context:n}=e,o=!n.readOnly,r=n.isProcessingLocalChanges,i=null!==(t=eV(n.slateEditor))&&void 0!==t&&t,a=o&&(r||i);return n8("isBusy",{isBusy:a,editable:o,isProcessingLocalChanges:r,isChanging:i}),a},"is empty value":e=>{let{event:t}=e;return"update value"===t.type&&void 0===t.value},"is empty array":e=>{let{event:t}=e;return"update value"===t.type&&Array.isArray(t.value)&&0===t.value.length},"is new value":e=>{let{context:t,event:n}=e;return"update value"===n.type&&t.previousValue!==n.value},"value changed while syncing":e=>{let{context:t,event:n}=e;return(0,w.ZD)(n,"done syncing"),t.pendingValue!==n.value},"pending value equals previous value":e=>{let{context:t}=e;return v(t.pendingValue,t.previousValue)}},actors:{"sync value":n6}}).createMachine({id:"sync",context:e=>{let{input:t}=e;return{initialValue:t.initialValue,initialValueSynced:!1,isProcessingLocalChanges:!1,keyGenerator:t.keyGenerator,schema:t.schema,readOnly:t.readOnly,slateEditor:t.slateEditor,pendingValue:void 0,previousValue:void 0}},entry:[(0,R.r)(e=>{let{context:t}=e;return{type:"update value",value:t.initialValue}})],on:{"has pending mutations":{actions:(0,S.a)({isProcessingLocalChanges:!0})},mutation:{actions:(0,S.a)({isProcessingLocalChanges:!1})},"update readOnly":{actions:["assign readOnly"]}},initial:"idle",states:{idle:{entry:[()=>{n8("entry: syncing->idle")}],exit:[()=>{n8("exit: syncing->idle")}],on:{"update value":[{guard:(0,R.e)(["is empty value",(0,R.n)("initial value synced")]),actions:["assign initial value synced","emit done syncing value"]},{guard:(0,R.e)(["is empty array",(0,R.n)("initial value synced")]),actions:["assign initial value synced",(0,O.a)({type:"value changed",value:[]}),"emit done syncing value"]},{guard:(0,R.e)(["is busy","is new value"]),target:"busy",actions:["assign pending value"]},{guard:"is new value",target:"syncing",actions:["assign pending value"]},{guard:(0,R.n)("initial value synced"),actions:[()=>{n8("no new value  setting initial value as synced")},"assign initial value synced","emit done syncing value"]},{actions:[()=>{n8("no new value and initial value already synced")}]}]}},busy:{entry:[()=>{n8("entry: syncing->busy")}],exit:[()=>{n8("exit: syncing->busy")}],after:{1e3:[{guard:"is busy",target:".",reenter:!0,actions:[()=>{n8("reenter: syncing->busy")}]},{target:"syncing"}]},on:{"update value":[{guard:"is new value",actions:["assign pending value"]}]}},syncing:{entry:[()=>{n8("entry: syncing->syncing")},"emit syncing value"],exit:[()=>{n8("exit: syncing->syncing")},"emit done syncing value"],invoke:{src:"sync value",id:"sync value",input:e=>{let{context:t}=e;return{context:{keyGenerator:t.keyGenerator,previousValue:t.previousValue,readOnly:t.readOnly,schema:t.schema},slateEditor:t.slateEditor,streamBlocks:!t.initialValueSynced,value:t.pendingValue}}},on:{"update value":{guard:"is new value",actions:["assign pending value"]},patch:{actions:[(0,O.a)(e=>{let{event:t}=e;return t})]},"invalid value":{actions:[(0,O.a)(e=>{let{event:t}=e;return t})]},"value changed":{actions:[(0,O.a)(e=>{let{event:t}=e;return t})]},"done syncing":[{guard:"value changed while syncing",actions:["assign previous value","assign initial value synced"],target:"syncing",reenter:!0},{target:"idle",actions:["clear pending value","assign previous value","assign initial value synced"]}]}}}});async function n4(e){let{context:t,sendBack:n,slateEditor:o,streamBlocks:r,value:i}=e,a=!1,l=!1,s=!0,c=!!o.selection;if(i&&0!==i.length||(n8("Value is empty"),u.ML.withoutNormalizing(o,()=>{tP(o,()=>{eK(o,()=>{tX(o,()=>{if(a)return;c&&u.YR.deselect(o);let e=o.children.length;o.children.forEach((t,n)=>{u.YR.removeNodes(o,{at:[e-1-n]})}),u.YR.insertNodes(o,o.pteCreateTextBlock({decorators:[]}),{at:[0]}),c&&u.YR.select(o,[0,0])})})})}),l=!0),i&&i.length>0){let e=q(i,{schemaTypes:t.schema});r?await new Promise(r=>{u.ML.withoutNormalizing(o,()=>{eK(o,()=>{tX(o,()=>{if(a){r();return}l=n7({slateEditor:o,slateValueFromProps:e}),(async()=>{for await(let[r,a]of n5({slateValue:e})){let{blockChanged:e,blockValid:c}=oe({context:t,sendBack:n,block:r,index:a,slateEditor:o,value:i});l=e||l,s=s&&c}r()})()})})})}):u.ML.withoutNormalizing(o,()=>{eK(o,()=>{tX(o,()=>{if(a)return;l=n7({slateEditor:o,slateValueFromProps:e});let r=0;for(let a of e){let{blockChanged:e,blockValid:c}=oe({context:t,sendBack:n,block:a,index:r,slateEditor:o,value:i});l=e||l,s=s&&c,r++}})})})}if(!s){n8("Invalid value, returning"),a=!0,n({type:"done syncing",value:i});return}if(l){n8("Server value changed, syncing editor");try{o.onChange()}catch(e){console.error(e),n({type:"invalid value",resolution:null,value:i}),a=!0,n({type:"done syncing",value:i});return}c&&!o.selection&&(u.YR.select(o,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),o.onChange()),n({type:"value changed",value:i})}else n8("Server value and editor value is equal, no need to sync.");a=!0,n({type:"done syncing",value:i})}function n7(e){let{slateEditor:t,slateValueFromProps:n}=e,o=!1,r=t.children.length;if(n.length<r){for(let e=r-1;e>n.length-1;e--)u.YR.removeNodes(t,{at:[e]});o=!0}return o}async function*n5(e){let{slateValue:t}=e,n=0;for await(let e of t)n%10==0&&await new Promise(e=>setTimeout(e,0)),yield[e,n],n++}function oe(e){let{context:t,sendBack:n,block:o,index:r,slateEditor:i,value:a}=e,l=!1,s=!0,c=i.children[r],d=c&&!v(o,c);return u.ML.withoutNormalizing(i,()=>{eK(i,()=>{tX(i,()=>{var e,p,h,f,y;if(d&&s){let d=[a[r]],y=n3(d,t.schema,t.keyGenerator);!y.valid&&(null===(e=y.resolution)||void 0===e?void 0:e.autoResolve)&&(null===(p=y.resolution)||void 0===p?void 0:p.patches.length)>0&&!t.readOnly&&t.previousValue&&t.previousValue!==a&&(console.warn("".concat(y.resolution.action," for block with _key '").concat(d[0]._key,"'. ").concat(null===(h=y.resolution)||void 0===h?void 0:h.description)),y.resolution.patches.forEach(e=>{n({type:"patch",patch:e})})),y.valid||(null===(f=y.resolution)||void 0===f?void 0:f.autoResolve)?(c._key===o._key&&c._type===o._type?(n8.enabled&&n8("Updating block",c,o),function(e,t,n,o){if(u.YR.setNodes(e,t,{at:[o]}),e.isTextBlock(t)&&e.isTextBlock(n)){let r=n.children.length;t.children.length<r&&Array.from(Array(r-t.children.length)).forEach((t,n)=>{let i=r-1-n;i>0&&(n8("Removing child"),u.YR.removeNodes(e,{at:[o,i]}))}),t.children.forEach((t,r)=>{let i=n.children[r],a=!v(t,i),l=!v(t.text,null==i?void 0:i.text),s=[o,r];if(a){if(t._key===(null==i?void 0:i._key)&&t._type===(null==i?void 0:i._type)){n8("Updating changed child",t,i),u.YR.setNodes(e,t,{at:s});let n=u.xv.isText(t)&&"span"===t._type&&u.xv.isText(i)&&"span"===i._type;n&&l?(i.text.length>0&&u.YR.delete(e,{at:{focus:{path:s,offset:0},anchor:{path:s,offset:i.text.length}}}),u.YR.insertText(e,t.text,{at:s}),e.onChange()):n||(n8("Updating changed inline object child",t),u.YR.setNodes(e,{_key:$},{at:[...s,0],voids:!0}))}else i?(n8("Replacing child",t),u.YR.removeNodes(e,{at:[o,r]}),u.YR.insertNodes(e,t,{at:[o,r]}),e.onChange()):i||(n8("Inserting new child",t),u.YR.insertNodes(e,t,{at:[o,r]}),e.onChange())}})}}(i,o,c,r)):(n8.enabled&&n8("Replacing block",c,o),function(e,t,n){let o=e.selection,r=o&&o.focus.path[0]===n;r&&u.YR.deselect(e),u.YR.removeNodes(e,{at:[n]}),u.YR.insertNodes(e,t,{at:[n]}),e.onChange(),r&&u.YR.select(e,o)}(i,o,r)),l=!0):(n({type:"invalid value",resolution:y.resolution,value:a}),s=!1)}if(!c&&s){let e=n3([a[r]],t.schema,t.keyGenerator);n8.enabled&&n8("Validating and inserting new block in the end of the value",o),e.valid||(null===(y=e.resolution)||void 0===y?void 0:y.autoResolve)?u.YR.insertNodes(i,o,{at:[r]}):(n8("Invalid",e),n({type:"invalid value",resolution:e.resolution,value:a}),s=!1)}})})}),{blockChanged:l,blockValid:s}}let ot=W("setup");function on(e){ot("Creating new Editor instance");let t=[],n=(0,R.c)(nW,{input:function(e){var t;let{legacySchema:n,schema:o}=function(e){var t;let n=e.schemaDefinition?function(e){var t,n,o,r,i,a,l,s,c,d,u,p;let h=null!==(l=null==e?void 0:null===(t=e.blockObjects)||void 0===t?void 0:t.map(e=>{var t,n,o;return(0,G.fe)({type:"object",name:null!==(n=nH[e.name])&&void 0!==n?n:e.name,title:void 0===e.title?nZ[e.name]:e.title,fields:null!==(o=null===(t=e.fields)||void 0===t?void 0:t.map(e=>{var t;return{name:e.name,type:e.type,title:null!==(t=e.title)&&void 0!==t?t:F(e.name)}}))&&void 0!==o?o:[]})}))&&void 0!==l?l:[],f=null!==(s=null==e?void 0:null===(n=e.inlineObjects)||void 0===n?void 0:n.map(e=>{var t,n,o;return(0,G.fe)({type:"object",name:null!==(n=nH[e.name])&&void 0!==n?n:e.name,title:void 0===e.title?nZ[e.name]:e.title,fields:null!==(o=null===(t=e.fields)||void 0===t?void 0:t.map(e=>{var t;return{name:e.name,type:e.type,title:null!==(t=e.title)&&void 0!==t?t:F(e.name)}}))&&void 0!==o?o:[]})}))&&void 0!==s?s:[],y=(0,G.Z2)({type:"array",name:"portable-text",of:[...h.map(e=>({type:e.name})),{type:"block",name:"block",of:f.map(e=>({type:e.name})),marks:{decorators:null!==(c=null==e?void 0:null===(o=e.decorators)||void 0===o?void 0:o.map(e=>{var t;return{title:null!==(t=e.title)&&void 0!==t?t:F(e.name),value:e.name}}))&&void 0!==c?c:[],annotations:null!==(d=null==e?void 0:null===(r=e.annotations)||void 0===r?void 0:r.map(e=>{var t,n;return{name:e.name,type:"object",title:e.title,fields:null!==(n=null===(t=e.fields)||void 0===t?void 0:t.map(e=>{var t;return{name:e.name,title:null!==(t=e.title)&&void 0!==t?t:F(e.name),type:e.type}}))&&void 0!==n?n:[]}}))&&void 0!==d?d:[]},lists:null!==(u=null==e?void 0:null===(i=e.lists)||void 0===i?void 0:i.map(e=>{var t;return{value:e.name,title:null!==(t=e.title)&&void 0!==t?t:F(e.name)}}))&&void 0!==u?u:[],styles:null!==(p=null==e?void 0:null===(a=e.styles)||void 0===a?void 0:a.map(e=>{var t;return{value:e.name,title:null!==(t=e.title)&&void 0!==t?t:F(e.name)}}))&&void 0!==p?p:[]}]}),g=n$(I.V.compile({types:[y,...h,...f]}).get("portable-text"));return{...g,blockObjects:g.blockObjects.map(e=>void 0!==nX[e.name]?{...e,name:nX[e.name],type:{...e.type,name:nX[e.name]}}:e),inlineObjects:g.inlineObjects.map(e=>void 0!==nX[e.name]?{...e,name:nX[e.name]}:e)}}(e.schemaDefinition):n$(e.schema.hasOwnProperty("jsonType")?e.schema:(t=e.schema,I.V.compile({name:"blockTypeSchema",types:[t]}).get(t.name))),o={annotations:n.annotations.map(e=>({name:e.name,fields:e.fields.map(e=>({name:e.name,type:e.type.jsonType,title:e.type.title})),title:e.title})),block:{name:n.block.name},blockObjects:n.blockObjects.map(e=>({name:e.name,fields:e.fields.map(e=>({name:e.name,type:e.type.jsonType,title:e.type.title})),title:e.title})),decorators:n.decorators.map(e=>({name:e.value,title:e.title,value:e.value})),inlineObjects:n.inlineObjects.map(e=>({name:e.name,fields:e.fields.map(e=>({name:e.name,type:e.type.jsonType,title:e.type.title})),title:e.title})),span:{name:n.span.name},styles:n.styles.map(e=>({name:e.value,title:e.title,value:e.value})),lists:n.lists.map(e=>({name:e.value,title:e.title,value:e.value}))};return{legacySchema:n,schema:o}}(e);return{converters:[eC,ej,{mimeType:"text/html",serialize:e=>{let{snapshot:t,event:n}=e;if(!t.context.selection)return{type:"serialization.failure",mimeType:"text/html",originEvent:n.originEvent,reason:"No selection"};let o=(0,m.Ly)(t),r=(0,N.io)(o,{onMissingComponent:!1,components:{unknownType:e=>{let{children:t}=e;return void 0!==t?"".concat(t):""}}});return""===r?{type:"serialization.failure",mimeType:"text/html",originEvent:n.originEvent,reason:"Serialized HTML is empty"}:{type:"serialization.success",data:r,mimeType:"text/html",originEvent:n.originEvent}},deserialize:e=>{let{snapshot:t,event:o}=e,r=(0,A.zW)(o.data,n.portableText,{keyGenerator:t.context.keyGenerator,unstable_whitespaceOnPasteMode:n.block.options.unstable_whitespaceOnPasteMode}).flatMap(e=>{let n=(0,y.IX)({context:t.context,block:e,options:{refreshKeys:!1,validateFields:!0}});return n?[n]:[]});return 0===r.length?{type:"deserialization.failure",mimeType:"text/html",reason:"No blocks deserialized"}:{type:"deserialization.success",data:r,mimeType:"text/html"}}},{mimeType:"text/plain",serialize:e=>{let{snapshot:t,event:n}=e;return t.context.selection?{type:"serialization.success",data:(0,m.Ly)(t).map(e=>{var o,r;return(0,y.dz)(t.context,e)?e.children.map(e=>{var o,r;return e._type===t.context.schema.span.name?e.text:"drag.dragstart"===n.originEvent?"[".concat(null!==(r=null===(o=t.context.schema.inlineObjects.find(t=>t.name===e._type))||void 0===o?void 0:o.title)&&void 0!==r?r:"Object","]"):""}).join(""):"drag.dragstart"===n.originEvent?"[".concat(null!==(r=null===(o=t.context.schema.blockObjects.find(t=>t.name===e._type))||void 0===o?void 0:o.title)&&void 0!==r?r:"Object","]"):""}).filter(e=>""!==e).join("\n\n"),mimeType:"text/plain",originEvent:n.originEvent}:{type:"serialization.failure",mimeType:"text/plain",originEvent:n.originEvent,reason:"No selection"}},deserialize:e=>{let{snapshot:t,event:o}=e,r="<html><body>".concat(String(o.data).replace(/[&<>"'`=/]/g,e=>eL[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join(""),"</body></html>"),i=(0,A.zW)(r,n.portableText,{keyGenerator:t.context.keyGenerator}).flatMap(e=>{let n=(0,y.IX)({context:t.context,block:e,options:{refreshKeys:!1,validateFields:!0}});return n?[n]:[]});return 0===i.length?{type:"deserialization.failure",mimeType:"text/plain",reason:"No blocks deserialized"}:{type:"deserialization.success",data:i,mimeType:"text/plain"}}}],getLegacySchema:()=>n,keyGenerator:null!==(t=e.keyGenerator)&&void 0!==t?t:ek,maxBlocks:e.maxBlocks,readOnly:e.readOnly,schema:o,initialValue:e.initialValue}}(e)}),o=(0,R.c)(n2),r=function(e){ne("Creating new Slate editor instance");let t=t5((0,p.BU)((0,u.Jh)()),{editorActor:e.editorActor,relayActor:e.relayActor,subscriptions:e.subscriptions});ep.set(t,{}),eu.set(t,{}),t.decoratedRanges=[],t.decoratorState={};let n=eU(e.editorActor.getSnapshot().context);t.value=[n],t.blockIndexMap=new Map,t.listIndexMap=new Map,eY({schema:e.editorActor.getSnapshot().context.schema,value:t.value},{blockIndexMap:t.blockIndexMap,listIndexMap:t.listIndexMap});let o=q(t.value,{schemaTypes:e.editorActor.getSnapshot().context.schema});return{instance:t,initialValue:o}}({editorActor:n,relayActor:o,subscriptions:t}),i=function(e,t){let n=t.getSnapshot().context.schema;return{focus:()=>{t.send({type:"focus",editor:e})},blur:()=>{t.send({type:"blur",editor:e})},toggleMark:n=>{t.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:n},editor:e})},toggleList:n=>{t.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:n},editor:e})},toggleBlockStyle:n=>{t.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:n},editor:e})},isMarkActive:n=>{let o=eH({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return(0,k.WH)(o).includes(n)},marks:()=>{let n=eH({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return[...(0,k.YG)(n),...(0,k.WH)(n)]},undo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},redo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},select:n=>{let o=es({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:n},blockIndexMap:e.blockIndexMap});o?u.YR.select(e,o):u.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=u.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t)return H([t],n.block.name,ep.get(e))[0]}},focusChild:()=>{if(e.selection){let t=u.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return H([t],n.block.name,ep.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(o,r)=>{var i,a,l,s;if(o.name!==n.span.name)return t.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:{name:o.name,value:r}},editor:e}),e.selection&&null!==(l=null===(i=ei({schema:t.getSnapshot().context.schema,editor:e,range:e.selection}))||void 0===i?void 0:i.focus.path)&&void 0!==l?l:[];if(!e.selection)throw Error("The editor has no selection");let[c]=Array.from(u.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===n.block.name}))[0]||[void 0];if(!c)throw Error("No focused text block");if(o.name!==n.span.name&&!n.inlineObjects.some(e=>e.name===o.name))throw Error("This type cannot be inserted as a child to a text block");let d=q([{_key:t.getSnapshot().context.keyGenerator(),_type:n.block.name,children:[{_key:t.getSnapshot().context.keyGenerator(),_type:o.name,...r||{}}]}],{schemaTypes:t.getSnapshot().context.schema})[0].children[0],p=e.selection.focus.path.slice(0,2),h=d._type===n.span.name,f=u.NB.get(e,p);return h&&f._type!==n.span.name&&(n1("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),u.YR.insertNodes(e,d,{select:!0,at:e.selection}),e.onChange(),e.selection&&null!==(s=null===(a=ei({schema:t.getSnapshot().context.schema,editor:e,range:e.selection}))||void 0===a?void 0:a.focus.path)&&void 0!==s?s:[]},insertBlock:(n,o)=>{var r,i;return t.send({type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:n.name,...o||{}},placement:"auto"},editor:e}),e.selection&&null!==(i=null===(r=ei({schema:t.getSnapshot().context.schema,editor:e,range:e.selection}))||void 0===r?void 0:r.focus.path)&&void 0!==i?i:[]},hasBlockStyle:t=>{try{return function(e){let{editor:t,style:n}=e;if(!t.selection)return!1;let o=[...u.ML.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})];return o.length>0&&o.every(e=>{let[t]=e;return t.style===n})}({editor:e,style:t})}catch(e){return!1}},hasListStyle:t=>{try{return function(e){let{editor:t,listItem:n}=e;if(!t.selection)return!1;let o=[...u.ML.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})];return o.length>0&&o.every(e=>{let[o]=e;return t.isListBlock(o)&&o.listItem===n})}({editor:e,listItem:t})}catch(e){return!1}},isVoid:e=>![n.block.name,n.span.name].includes(e._type),findByPath:o=>{let r=es({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:{focus:{path:o,offset:0},anchor:{path:o,offset:0}}},blockIndexMap:e.blockIndexMap});if(r){let[t,i]=u.ML.node(e,r.focus.path.slice(0,1));if(t&&i&&"string"==typeof t._key){if(1===o.length&&1===r.focus.path.length)return[H([t],n.block.name)[0],[{_key:t._key}]];let i=H([t],n.block.name,ep.get(e))[0];if(e.isTextBlock(i)){let e=i.children[r.focus.path[1]];if(e)return[e,[{_key:t._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[o]=Array.from(u.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=p.F3.toDOMNode(e,o)}catch(e){}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[];for(let[o,r]of u.ML.nodes(e,{at:e.selection,match:e=>u.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){var t;let[i]=u.ML.node(e,r,{depth:1});e.isTextBlock(i)&&(null===(t=i.markDefs)||void 0===t||t.forEach(e=>{u.xv.isText(o)&&o.marks&&Array.isArray(o.marks)&&o.marks.includes(e._key)&&n.push(e)}))}return n}catch(e){return[]}},isAnnotationActive:n=>{let o=eH({editorActorSnapshot:t.getSnapshot(),slateEditorInstance:e});return(0,k.kH)(n)(o)},addAnnotation:(o,r)=>{let i;return u.ML.withoutNormalizing(e,()=>{i=tG({context:{keyGenerator:t.getSnapshot().context.keyGenerator,schema:n},operation:{annotation:{name:o.name,value:null!=r?r:{}},editor:e}})}),e.onChange(),i},delete:(o,r)=>{if(o){let i=es({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:o},blockIndexMap:e.blockIndexMap});if(!(i&&i.anchor.path.length>0&&i.focus.path.length>0))throw Error("Invalid range");if(i){if(!(null==r?void 0:r.mode)||(null==r?void 0:r.mode)==="selected"){n1("Deleting content in selection"),u.YR.delete(e,{at:i,hanging:!0,voids:!0}),e.onChange();return}if((null==r?void 0:r.mode)==="blocks"&&(n1("Deleting blocks touched by selection"),u.YR.removeNodes(e,{at:i,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&u.W_.isElement(t)})),(null==r?void 0:r.mode)==="children"&&(n1("Deleting children touched by selection"),u.YR.removeNodes(e,{at:i,voids:!0,match:t=>t._type===n.span.name||!e.isTextBlock(t)&&u.W_.isElement(t)})),0===e.children.length){let n=eU(t.getSnapshot().context);e.children=[n],e.value=[n],eY({schema:t.getSnapshot().context.schema,value:e.value},{blockIndexMap:e.blockIndexMap,listIndexMap:e.listIndexMap})}e.onChange()}}},removeAnnotation:n=>{t.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:{name:n.name}},editor:e})},getSelection:()=>{let n=null;if(e.selection){let o=eh.get(e.selection);if(o)return o;n=ei({schema:t.getSnapshot().context.schema,editor:e,range:e.selection}),eh.set(e.selection,n)}return n},getValue:()=>H(e.children,n.block.name,ep.get(e)),isCollapsedSelection:()=>!!e.selection&&u.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&u.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>H(e.getFragment(),n.block.name),isSelectionsOverlapping:(n,o)=>{let r=es({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:n},blockIndexMap:e.blockIndexMap}),i=es({context:{schema:t.getSnapshot().context.schema,value:e.value,selection:o},blockIndexMap:e.blockIndexMap});return u.e6.isRange(r)&&u.e6.isRange(i)&&u.e6.includes(r,i)}}}(r.instance,n),{mutationActor:a,syncActor:l}=function(e){ot("Creating new Actors");let t=(0,R.c)(n0,{input:{readOnly:e.editorActor.getSnapshot().matches({"edit mode":"read only"}),schema:e.editorActor.getSnapshot().context.schema,slateEditor:e.slateEditor}}),n=(0,R.c)(n9,{input:{initialValue:e.editorActor.getSnapshot().context.initialValue,keyGenerator:e.editorActor.getSnapshot().context.keyGenerator,readOnly:e.editorActor.getSnapshot().matches({"edit mode":"read only"}),schema:e.editorActor.getSnapshot().context.schema,slateEditor:e.slateEditor}});return e.subscriptions.push(()=>{let o=t.on("*",t=>{"has pending mutations"===t.type&&n.send({type:"has pending mutations"}),"mutation"===t.type&&(n.send({type:"mutation"}),e.editorActor.send({type:"mutation",patches:t.patches,snapshot:t.snapshot,value:t.snapshot})),"patch"===t.type&&e.relayActor.send(t)});return()=>{o.unsubscribe()}}),e.subscriptions.push(()=>{let t=n.on("*",t=>{switch(t.type){case"invalid value":case"value changed":e.relayActor.send(t);break;case"patch":e.editorActor.send({...t,type:"internal.patch",value:H(e.slateEditor.children,e.editorActor.getSnapshot().context.schema.block.name,ep.get(e.slateEditor))});break;default:e.editorActor.send(t)}});return()=>{t.unsubscribe()}}),e.subscriptions.push(()=>{let o=e.editorActor.subscribe(e=>{e.matches({"edit mode":"read only"})?(t.send({type:"update readOnly",readOnly:!0}),n.send({type:"update readOnly",readOnly:!0})):(t.send({type:"update readOnly",readOnly:!1}),n.send({type:"update readOnly",readOnly:!1}))});return()=>{o.unsubscribe()}}),e.subscriptions.push(()=>{let n=e.editorActor.on("*",n=>{switch(n.type){case"editable":case"mutation":case"ready":case"read only":case"selection":e.relayActor.send(n);break;case"internal.patch":t.send({...n,type:"patch"})}});return()=>{n.unsubscribe()}}),{mutationActor:t,syncActor:n}}({editorActor:n,relayActor:o,slateEditor:r.instance,subscriptions:t}),s={dom:nt(e=>n.send(e),r.instance),getSnapshot:()=>eH({editorActorSnapshot:n.getSnapshot(),slateEditorInstance:r.instance}),registerBehavior:e=>{let t=ex({name:"custom",reference:{priority:e_,importance:"higher"}}),o={...e,priority:t};return n.send({type:"add behavior",behaviorConfig:o}),()=>{n.send({type:"remove behavior",behaviorConfig:o})}},send:e=>{switch(e.type){case"update value":l.send(e);break;case"update readOnly":case"patches":case"update maxBlocks":n.send(e);break;case"blur":n.send({type:"blur",editor:r.instance});break;case"focus":n.send({type:"focus",editor:r.instance});break;case"insert.block object":var t;n.send({type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:e.blockObject.name,...null!==(t=e.blockObject.value)&&void 0!==t?t:{}},placement:e.placement},editor:r.instance});break;default:n.send({type:"behavior event",behaviorEvent:e,editor:r.instance})}},on:(e,t)=>o.on(e,e=>{switch(e.type){case"blurred":case"done loading":case"editable":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"read only":case"ready":case"selection":case"value changed":t(e)}}),_internal:{editable:i,editorActor:n,slateEditor:r}};return{actors:{editorActor:n,mutationActor:a,relayActor:o,syncActor:l},editor:s,subscriptions:t}}let oo=(0,i.createContext)({});function or(e){let t,n,o;let l=(0,r.c)(7);l[0]!==e?(t=t=>e.onChange(t),l[0]=e,l[1]=t):t=l[1];let s=(0,a.i)(t);return l[2]!==s||l[3]!==e.relayActor?(n=()=>{let t=e.relayActor.on("*",e=>{let t=oi(e);t&&s(t)});return()=>{t.unsubscribe()}},l[2]=s,l[3]=e.relayActor,l[4]=n):n=l[4],l[5]!==e.relayActor?(o=[e.relayActor],l[5]=e.relayActor,l[6]=o):o=l[6],(0,i.useEffect)(n,o),null}function oi(e){switch(e.type){case"blurred":return{type:"blur",event:e.event};case"patch":case"mutation":case"ready":case"selection":case"unset":return e;case"loading":return{type:"loading",isLoading:!0};case"done loading":return{type:"loading",isLoading:!1};case"focused":return{type:"focus",event:e.event};case"value changed":return{type:"value",value:e.value};case"invalid value":return{type:"invalidValue",resolution:e.resolution,value:e.value}}}let oa=W("component:PortableTextEditor");class ol extends i.Component{componentDidMount(){if(!this.actors)return;for(let e of this.subscriptions)this.unsubscribers.push(e());let e=this.actors.relayActor.on("*",e=>{let t=oi(e);t&&(this.props.editor||this.props.onChange(t),this.change$.next(t))});this.unsubscribers.push(e.unsubscribe),this.actors.editorActor.start(),this.actors.mutationActor.start(),this.actors.relayActor.start(),this.actors.syncActor.start()}componentDidUpdate(e){var t;this.props.editor||e.editor||this.props.schemaType===e.schemaType||console.warn("Updating schema type is no longer supported"),this.props.editor||e.editor||(this.props.readOnly!==e.readOnly&&this.editor._internal.editorActor.send({type:"update readOnly",readOnly:null!==(t=this.props.readOnly)&&void 0!==t&&t}),this.props.maxBlocks!==e.maxBlocks&&this.editor._internal.editorActor.send({type:"update maxBlocks",maxBlocks:void 0===this.props.maxBlocks?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)}),this.props.value!==e.value&&this.editor.send({type:"update value",value:this.props.value}),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this))}componentWillUnmount(){for(let e of this.unsubscribers)e();this.actors&&(eB(this.actors.editorActor),eB(this.actors.mutationActor),eB(this.actors.relayActor),eB(this.actors.syncActor))}render(){var e;let t=this.props.editor?void 0:null!==(e=this.props.incomingPatches$)&&void 0!==e?e:this.props.patches$;return(0,s.jsxs)(s.Fragment,{children:[t?(0,s.jsx)(os,{editorActor:this.editor._internal.editorActor,patches$:t}):null,(0,s.jsx)(ef.Provider,{value:this.editor._internal.editorActor,children:(0,s.jsx)(oo.Provider,{value:this.actors.relayActor,children:(0,s.jsx)(p.mH,{editor:this.editor._internal.slateEditor.instance,initialValue:this.editor._internal.slateEditor.initialValue,children:(0,s.jsx)(eN.Provider,{value:this,children:this.props.children})})})})]})}constructor(e){if(super(e),this.change$=new E.x,this.subscriptions=[],this.unsubscribers=[],this.setEditable=e=>{this.editor._internal.editable={...this.editor._internal.editable,...e}},e.editor)this.editor=e.editor,this.schemaTypes=this.editor._internal.editorActor.getSnapshot().context.getLegacySchema();else{let{actors:t,editor:n,subscriptions:o}=on({initialValue:e.value,keyGenerator:e.keyGenerator,maxBlocks:void 0===e.maxBlocks?void 0:Number.parseInt(e.maxBlocks.toString(),10),readOnly:e.readOnly,schema:e.schemaType});this.subscriptions=o,this.actors=t,this.editor=n,this.schemaTypes=t.editorActor.getSnapshot().context.getLegacySchema()}this.editable=this.editor._internal.editable}}function os(e){let t,n;let o=(0,r.c)(4);return o[0]!==e.editorActor||o[1]!==e.patches$?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],o[0]=e.editorActor,o[1]=e.patches$,o[2]=t,o[3]=n):(t=o[2],n=o[3]),(0,i.useEffect)(t,n),null}function oc(e){var t,n;let o=(0,p._7)(),r=(0,i.useContext)(ef),a=(0,c.v9)(r,e=>e.context.getLegacySchema()),l=(0,i.useRef)(null),d=eI(),u=(0,p.vt)(),[h,f]=(0,i.useState)(!1),[y,g]=(0,i.useState)(!1),m=e.children.props.parent,k=m&&o.isTextBlock(m)?m:void 0,b=(0,i.useMemo)(()=>k?[{_key:k._key},"children",{_key:e.leaf._key}]:void 0,[k,e.leaf._key]),x=r.getSnapshot().context.schema.decorators.map(e=>e.name),E=_((null!==(t=e.leaf.marks)&&void 0!==t?t:[]).filter(e=>x.includes(e))),w=(null!==(n=e.leaf.marks)&&void 0!==n?n:[]).flatMap(e=>{var t;if(x.includes(e))return[];let n=null==k?void 0:null===(t=k.markDefs)||void 0===t?void 0:t.find(t=>t._key===e);return n?[n]:[]}),S=w.length>0&&u;(0,i.useEffect)(()=>{if(!S){f(!1);return}let e=ol.getSelection(d);e&&v(e.focus.path,b)&&ol.isCollapsedSelection(d)&&(0,i.startTransition)(()=>{f(!0)})},[S,b,d]);let O=(0,i.useCallback)(()=>{if(!S)return;let e=window.getSelection();if(!e){g(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);l.current&&t.intersectsNode(l.current)?g(!0):g(!1)}else g(!1)},[S]);(0,i.useEffect)(()=>{if(!S)return;let e=r.on("blurred",()=>{f(!1),g(!1)}),t=r.on("focused",()=>{let e=ol.getSelection(d);e&&v(e.focus.path,b)&&ol.isCollapsedSelection(d)&&f(!0),O()}),n=r.on("selection",e=>{e.selection&&v(e.selection.focus.path,b)&&ol.isCollapsedSelection(d)?f(!0):f(!1),O()});return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[r,b,d,O,S]),(0,i.useEffect)(()=>O(),[O]);let M=e.children;for(let t of E){let n=a.decorators.find(e=>e.value===t);b&&n&&e.renderDecorator&&(M=e.renderDecorator({children:M,editorElementRef:l,focused:h,path:b,selected:y,schemaType:n,value:t,type:n}))}for(let t of w){let n=a.annotations.find(e=>e.name===t._type);n&&(M=k&&b&&e.renderAnnotation?(0,s.jsx)("span",{ref:l,children:e.renderAnnotation({block:k,children:M,editorElementRef:l,focused:h,path:b,selected:y,schemaType:n,value:t,type:n})}):(0,s.jsx)("span",{ref:l,children:M}))}if(k&&b&&e.renderChild){let t=k.children.find(t=>t._key===e.leaf._key);t&&(M=e.renderChild({annotations:w,children:M,editorElementRef:l,focused:h,path:b,schemaType:a.span,selected:y,value:t,type:a.span}))}return(0,s.jsx)("span",{...e.attributes,ref:l,children:M})}ol.displayName="PortableTextEditor",ol.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],ol.isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t),ol.addAnnotation=(e,t,n)=>{var o;return null===(o=e.editable)||void 0===o?void 0:o.addAnnotation(t,n)},ol.blur=e=>{var t;oa("Host blurred"),null===(t=e.editable)||void 0===t||t.blur()},ol.delete=(e,t,n)=>{var o;return null===(o=e.editable)||void 0===o?void 0:o.delete(t,n)},ol.findDOMNode=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.findDOMNode(t)},ol.findByPath=(e,t)=>{var n;return(null===(n=e.editable)||void 0===n?void 0:n.findByPath(t))||[]},ol.focus=e=>{var t;oa("Host requesting focus"),null===(t=e.editable)||void 0===t||t.focus()},ol.focusBlock=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.focusBlock()},ol.focusChild=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.focusChild()},ol.getSelection=e=>e.editable?e.editable.getSelection():null,ol.getValue=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.getValue()},ol.hasBlockStyle=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.hasBlockStyle(t)},ol.hasListStyle=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.hasListStyle(t)},ol.isCollapsedSelection=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.isCollapsedSelection()},ol.isExpandedSelection=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.isExpandedSelection()},ol.isMarkActive=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.isMarkActive(t)},ol.insertChild=(e,t,n)=>{var o;return oa("Host inserting child"),null===(o=e.editable)||void 0===o?void 0:o.insertChild(t,n)},ol.insertBlock=(e,t,n)=>{var o;return null===(o=e.editable)||void 0===o?void 0:o.insertBlock(t,n)},ol.insertBreak=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.insertBreak()},ol.isVoid=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.isVoid(t)},ol.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n},ol.marks=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.marks()},ol.select=(e,t)=>{var n;oa("Host setting selection",t),null===(n=e.editable)||void 0===n||n.select(t)},ol.removeAnnotation=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.removeAnnotation(t)},ol.toggleBlockStyle=(e,t)=>{var n;return oa("Host is toggling block style"),null===(n=e.editable)||void 0===n?void 0:n.toggleBlockStyle(t)},ol.toggleList=(e,t)=>{var n;return null===(n=e.editable)||void 0===n?void 0:n.toggleList(t)},ol.toggleMark=(e,t)=>{var n;oa("Host toggling mark",t),null===(n=e.editable)||void 0===n||n.toggleMark(t)},ol.getFragment=e=>{var t;return null===(t=e.editable)||void 0===t?void 0:t.getFragment()},ol.undo=e=>{var t;oa("Host undoing"),null===(t=e.editable)||void 0===t||t.undo()},ol.redo=e=>{var t;oa("Host redoing"),null===(t=e.editable)||void 0===t||t.redo()},ol.isSelectionsOverlapping=(e,t,n)=>{var o;return null===(o=e.editable)||void 0===o?void 0:o.isSelectionsOverlapping(t,n)};let od={position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0};function ou(e){let t;let n=(0,r.c)(12),o=(0,i.useContext)(ef),a=(0,c.v9)(o,op);if(e.leaf._type!==a.span.name)return e.children;n[0]!==e?(t=(0,s.jsx)(oc,{...e}),n[0]=e,n[1]=t):t=n[1];let l=t;if(e.renderPlaceholder&&e.leaf.placeholder&&""===e.text.text){let t,o,r;return n[2]!==e.renderPlaceholder?(t=e.renderPlaceholder(),n[2]=e.renderPlaceholder,n[3]=t):t=n[3],n[4]!==t?(o=(0,s.jsx)("span",{style:od,contentEditable:!1,children:t}),n[4]=t,n[5]=o):o=n[5],n[6]!==l||n[7]!==o?(r=(0,s.jsxs)(s.Fragment,{children:[o,l]}),n[6]=l,n[7]=o,n[8]=r):r=n[8],r}let d=e.leaf.rangeDecoration;if(d){let e;n[9]!==d||n[10]!==l?(e=d.component({children:l}),n[9]=d,n[10]=l,n[11]=e):e=n[11],l=e}return l}function op(e){return e.context.schema}function oh(e){let t;let n=(0,r.c)(5);return n[0]!==e.attributes||n[1]!==e.children||n[2]!==e.text._key||n[3]!==e.text._type?(t=(0,s.jsx)("span",{...e.attributes,"data-child-key":e.text._key,"data-child-name":e.text._type,"data-child-type":"span",children:e.children}),n[0]=e.attributes,n[1]=e.children,n[2]=e.text._key,n[3]=e.text._type,n[4]=t):t=n[4],t}let of=/Mac|iPod|iPhone|iPad/.test(window.navigator.userAgent),oy={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},og={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:of?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},ov={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131};function om(e){let t={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},n=e.replace("++","+add").split("+");for(let e of n){let o=e.endsWith("?")&&e.length>1,r=o?e.slice(0,-1):e,i=ob(r),a=oy[i],l=og[r],s=ov[i];if(r.length>1&&void 0===a&&void 0===l&&void 0===s)throw TypeError('Unknown modifier: "'.concat(r,'"'));(1===n.length||void 0===a)&&(t.key=i,t.keyCode=function(e){var t;let n=ob(e);return null!==(t=ov[n])&&void 0!==t?t:n.toUpperCase().charCodeAt(0)}(r)),void 0!==a&&(t[a]=!o||null)}return t}function ok(e,t){return(null==e.altKey||e.altKey===t.altKey)&&(null==e.ctrlKey||e.ctrlKey===t.ctrlKey)&&(null==e.metaKey||e.metaKey===t.metaKey)&&(null==e.shiftKey||e.shiftKey===t.shiftKey)&&(void 0!==e.keyCode&&void 0!==t.keyCode?91===e.keyCode&&93===t.keyCode||e.keyCode===t.keyCode:e.keyCode===t.keyCode||e.key===t.key.toLowerCase())}function ob(e){var t;let n=e.toLowerCase();return null!==(t=og[n])&&void 0!==t?t:n}let ox=W("plugin:withHotKeys"),o_=(0,w.cY)({types:{context:{},input:{},events:{}},actions:{"update pending range decorations":(0,S.a)({pendingRangeDecorations:e=>{let{context:t,event:n}=e;return"range decorations updated"!==n.type?t.pendingRangeDecorations:n.rangeDecorations}}),"set up initial range decorations":e=>{let{context:t}=e,n=[];for(let e of t.pendingRangeDecorations){let r=es({context:{schema:t.schema,value:t.slateEditor.value,selection:e.selection},blockIndexMap:t.slateEditor.blockIndexMap});if(!u.e6.isRange(r)){var o;null===(o=e.onMoved)||void 0===o||o.call(e,{newSelection:null,rangeDecoration:e,origin:"local"});continue}n.push({rangeDecoration:e,...r})}t.slateEditor.decoratedRanges=n},"update range decorations":e=>{let{context:t,event:n}=e;if("range decorations updated"!==n.type)return;let o=[];for(let e of n.rangeDecorations){let n=es({context:{schema:t.schema,value:t.slateEditor.value,selection:e.selection},blockIndexMap:t.slateEditor.blockIndexMap});if(!u.e6.isRange(n)){var r;null===(r=e.onMoved)||void 0===r||r.call(e,{newSelection:null,rangeDecoration:e,origin:"local"});continue}o.push({rangeDecoration:e,...n})}t.slateEditor.decoratedRanges=o},"move range decorations":e=>{let{context:t,event:n}=e;if("slate operation"!==n.type)return;let o=[];for(let e of t.slateEditor.decoratedRanges){var r,i,a,l;let s;let c=es({context:{schema:t.schema,value:t.slateEditor.value,selection:e.rangeDecoration.selection},blockIndexMap:t.slateEditor.blockIndexMap});if(!u.e6.isRange(c)){null===(r=(i=e.rangeDecoration).onMoved)||void 0===r||r.call(i,{newSelection:null,rangeDecoration:e.rangeDecoration,origin:"local"});continue}if((s=function(e,t){let n=u.E9.transform(e.anchor,t),o=u.E9.transform(e.focus,t);return null===n||null===o?null:u.E9.equals(n,e.anchor)&&u.E9.equals(o,e.focus)?e:{anchor:n,focus:o}}(c,n.operation))&&s!==c||null===s&&c){let n=s?ei({schema:t.schema,editor:t.slateEditor,range:s}):null;null===(a=(l=e.rangeDecoration).onMoved)||void 0===a||a.call(l,{newSelection:n,rangeDecoration:e.rangeDecoration,origin:"local"})}null!==s&&o.push({...s||c,rangeDecoration:{...e.rangeDecoration,selection:ei({schema:t.schema,editor:t.slateEditor,range:s})}})}t.slateEditor.decoratedRanges=o},"assign readOnly":(0,S.a)({readOnly:e=>{let{context:t,event:n}=e;return"update read only"!==n.type?t.readOnly:n.readOnly}}),"update decorate":(0,S.a)({decorate:e=>{let{context:t}=e;return{fn:oE(t.schema,t.slateEditor)}}})},actors:{"slate operation listener":(0,M.E9)(e=>{let{input:t,sendBack:n}=e,o=t.slateEditor.apply;return t.slateEditor.apply=e=>{"set_selection"!==e.type&&n({type:"slate operation",operation:e}),o(e)},()=>{t.slateEditor.apply=o}})},guards:{"has pending range decorations":e=>{let{context:t}=e;return t.pendingRangeDecorations.length>0},"has range decorations":e=>{let{context:t}=e;return t.slateEditor.decoratedRanges.length>0},"has different decorations":e=>{let{context:t,event:n}=e;return"range decorations updated"===n.type&&!v(t.slateEditor.decoratedRanges.map(e=>{var t,n;return{anchor:null===(t=e.rangeDecoration.selection)||void 0===t?void 0:t.anchor,focus:null===(n=e.rangeDecoration.selection)||void 0===n?void 0:n.focus}}),n.rangeDecorations.map(e=>{var t,n;return{anchor:null===(t=e.selection)||void 0===t?void 0:t.anchor,focus:null===(n=e.selection)||void 0===n?void 0:n.focus}}))},"not read only":e=>{let{context:t}=e;return!t.readOnly},"should skip setup":e=>{let{context:t}=e;return t.skipSetup}}}).createMachine({id:"range decorations",context:e=>{let{input:t}=e;return{readOnly:t.readOnly,pendingRangeDecorations:t.rangeDecorations,decoratedRanges:[],skipSetup:t.skipSetup,schema:t.schema,slateEditor:t.slateEditor,decorate:{fn:oE(t.schema,t.slateEditor)}}},invoke:{src:"slate operation listener",input:e=>{let{context:t}=e;return{slateEditor:t.slateEditor}}},on:{"update read only":{actions:["assign readOnly"]}},initial:"setting up",states:{"setting up":{always:[{guard:(0,R.e)(["should skip setup","has pending range decorations"]),target:"ready",actions:["set up initial range decorations","update decorate"]},{guard:"should skip setup",target:"ready"}],on:{"range decorations updated":{actions:["update pending range decorations"]},ready:[{target:"ready",guard:"has pending range decorations",actions:["set up initial range decorations","update decorate"]},{target:"ready"}]}},ready:{initial:"idle",on:{"range decorations updated":{target:".idle",guard:"has different decorations",actions:["update range decorations","update decorate"]}},states:{idle:{on:{"slate operation":{target:"moving range decorations",guard:(0,R.e)(["has range decorations","not read only"])}}},"moving range decorations":{entry:["move range decorations"],always:{target:"idle"}}}}}});function oE(e,t){return function(n){let[o,r]=n;if(X(t.children,e))return[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}];if(0===r.length||!u.W_.isElement(o)||0===o.children.length)return[];let i=r.at(0);return void 0===i?[]:t.decoratedRanges.filter(e=>u.e6.isCollapsed(e)?o.children.some((t,n)=>u.y$.equals(e.anchor.path,[i,n])&&u.y$.equals(e.focus.path,[i,n])):u.e6.intersection(e,{anchor:{path:r,offset:0},focus:{path:r,offset:0}})||u.e6.includes(e,r))}}let ow=W("component:Editable"),oS=(0,i.forwardRef)(function(e,t){let{hotkeys:n,onBlur:o,onFocus:r,onBeforeInput:a,onPaste:l,onCopy:h,onCut:f,onClick:g,onDragStart:m,onDrag:k,onDragEnd:b,onDragEnter:x,onDragOver:_,onDrop:E,onDragLeave:w,rangeDecorations:S,renderAnnotation:O,renderBlock:M,renderChild:R,renderDecorator:A,renderListItem:N,renderPlaceholder:I,renderStyle:T,selection:B,scrollSelectionIntoView:C,spellCheck:j,...L}=e,D=eI(),Y=(0,i.useRef)(null),[U,z]=(0,i.useState)(null),[P,G]=(0,i.useState)(!1);(0,i.useImperativeHandle)(t,()=>Y.current);let F=(0,i.useContext)(ef),K=(0,i.useContext)(oo),V=(0,c.v9)(F,e=>e.matches({"edit mode":"read only"})),W=(0,p.ui)(),$=(0,c.TH)(o_,{input:{rangeDecorations:null!=S?S:[],readOnly:V,schema:F.getSnapshot().context.schema,slateEditor:W,skipSetup:!F.getSnapshot().matches({setup:"setting up"})}}),J=(0,c.v9)($,e=>{var t;return null===(t=e.context.decorate)||void 0===t?void 0:t.fn});(0,i.useEffect)(()=>{$.send({type:"update read only",readOnly:V})},[$,V]),(0,i.useEffect)(()=>{$.send({type:"range decorations updated",rangeDecorations:null!=S?S:[]})},[$,S]),(0,i.useMemo)(()=>V?W:(function(e,t,n){let o=["enter","tab","shift","delete","end"],r=null!=n?n:{};return function(n){return n.pteWithHotKeys=i=>{Object.keys(r).forEach(a=>{var l,s;if("marks"===a)for(let t in r[a]){if(o.includes(t))throw Error("The hotkey ".concat(t," is reserved!"));if(l=i.nativeEvent,ok(om(t),l)){i.preventDefault();let o=r[a];if(o){let r=o[t];ox("HotKey ".concat(t," to toggle ").concat(r)),e.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:r},editor:n})}}}if("custom"===a)for(let e in r[a]){if(o.includes(e))throw Error("The hotkey ".concat(e," is reserved!"));if(s=i.nativeEvent,ok(om(e),s)){let n=r[a];n&&(0,n[e])(i,t)}}})},n}})(F,D,n)(W),[F,n,D,V,W]);let q=(0,i.useCallback)(e=>(0,s.jsx)(eM,{...e,readOnly:V,renderBlock:M,renderChild:R,renderListItem:N,renderStyle:T,spellCheck:j}),[j,V,M,R,N,T]),Z=(0,i.useCallback)(e=>(0,s.jsx)(ou,{...e,readOnly:V,renderAnnotation:O,renderChild:R,renderDecorator:A,renderPlaceholder:I}),[V,O,R,A,I]),Q=(0,i.useCallback)(e=>(0,s.jsx)(oh,{...e}),[]),ee=(0,i.useCallback)(()=>{if(B){ow("Selection from props ".concat(JSON.stringify(B)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,o=null,{anchor:r,focus:i}=e;return r&&t.find(e=>v({_key:e._key},r.path[0]))&&(n=el(r,t)),i&&t.find(e=>v({_key:e._key},i.path[0]))&&(o=el(i,t)),n&&o?{anchor:n,focus:o,backward:e.backward}:null}(B,H(W.children,F.getSnapshot().context.schema.block.name));if(null!==e){ow("Normalized selection from props ".concat(JSON.stringify(e)));let t=es({context:{schema:F.getSnapshot().context.schema,value:W.value,selection:e},blockIndexMap:W.blockIndexMap});t&&(u.YR.select(W,t),W.operations.some(e=>"set_selection"===e.type)||F.send({type:"update selection",selection:e}),W.onChange())}}},[F,B,W]);(0,i.useEffect)(()=>{let e=F.on("ready",()=>{$.send({type:"ready"}),ee()}),t=F.on("invalid value",()=>{G(!0)}),n=F.on("value changed",()=>{G(!1)});return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[$,F,ee]),(0,i.useEffect)(()=>{B&&!P&&ee()},[P,B,ee]);let et=(0,i.useCallback)(e=>{if(h)void 0!==h(e)&&e.preventDefault();else if(e.nativeEvent.clipboardData){e.stopPropagation(),e.preventDefault();let t=W.selection?ei({schema:F.getSnapshot().context.schema,editor:W,range:W.selection}):void 0,n=t?{selection:t}:void 0;if(!n){console.warn("Could not find position for copy event");return}F.send({type:"behavior event",behaviorEvent:{type:"clipboard.copy",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:W,nativeEvent:e})}},[h,F,W]),en=(0,i.useCallback)(e=>{if(f)void 0!==f(e)&&e.preventDefault();else if(e.nativeEvent.clipboardData){e.stopPropagation(),e.preventDefault();let t=F.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n){console.warn("Could not find position for cut event");return}F.send({type:"behavior event",behaviorEvent:{type:"clipboard.cut",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:W,nativeEvent:e})}},[f,F,W]),eo=(0,i.useCallback)(e=>{var t;let n=H(W.children,F.getSnapshot().context.schema.block.name,ep.get(W)),o=(null===(t=W.selection?ei({schema:F.getSnapshot().context.schema,editor:W,range:W.selection}):null)||void 0===t?void 0:t.focus.path)||[],r=null==l?void 0:l({event:e,value:n,path:o,schemaTypes:D.schemaTypes});if(r||!W.selection)e.preventDefault(),K.send({type:"loading"}),Promise.resolve(r).then(t=>{if(ow("Custom paste function from client resolved",t),t&&t.insert)t.insert?F.send({type:"behavior event",behaviorEvent:{type:"insert.blocks",blocks:(0,y.Pj)({context:{keyGenerator:F.getSnapshot().context.keyGenerator,schema:F.getSnapshot().context.schema},blocks:t.insert,options:{refreshKeys:!0,validateFields:!0}}),placement:"auto"},editor:W}):console.warn("Your onPaste function returned something unexpected:",t);else{ow("No result from custom paste handler, pasting normally");let t=F.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n){console.warn("Could not find position for paste event");return}F.send({type:"behavior event",behaviorEvent:{type:"clipboard.paste",originEvent:{dataTransfer:e.clipboardData},position:n},editor:W,nativeEvent:e})}}).catch(e=>(console.warn(e),e)).finally(()=>{K.send({type:"done loading"})});else if(e.nativeEvent.clipboardData){e.preventDefault(),e.stopPropagation();let t=F.getSnapshot().context.selection,n=t?{selection:t}:void 0;if(!n){console.warn("Could not find position for paste event");return}F.send({type:"behavior event",behaviorEvent:{type:"clipboard.paste",originEvent:{dataTransfer:e.nativeEvent.clipboardData},position:n},editor:W,nativeEvent:e})}ow("No result from custom paste handler, pasting normally")},[F,l,D,K,W]),er=(0,i.useCallback)(e=>{r&&r(e),e.isDefaultPrevented()||(K.send({type:"focused",event:e}),!W.selection&&X(W.children,F.getSnapshot().context.schema)&&(u.YR.select(W,u.ML.start(W,[])),W.onChange()))},[F,r,K,W]),ec=(0,i.useCallback)(e=>{if(g&&g(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=ea({editorActor:F,slateEditor:W,event:e.nativeEvent});t&&F.send({type:"behavior event",behaviorEvent:{type:"mouse.click",position:t},editor:W,nativeEvent:e})},[g,F,W]),ed=(0,i.useCallback)(e=>{o&&o(e),e.isPropagationStopped()||K.send({type:"blurred",event:e})},[K,o]),eu=(0,i.useCallback)(e=>{a&&a(e)},[a]),eh=(0,i.useCallback)(()=>{if(!W.selection)return;let{activeElement:e}=p.F3.findDocumentOrShadowRoot(W);if(Y.current!==e)return;let t=p.F3.getWindow(W).getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0);try{let e=p.F3.toDOMRange(W,W.selection);(e.startOffset!==n.startOffset||e.endOffset!==n.endOffset)&&(ow("DOM range out of sync, validating selection"),null==t||t.removeAllRanges(),t.addRange(e))}catch(e){ow("Could not resolve selection, selecting top document"),u.YR.deselect(W),W.children.length>0&&u.YR.select(W,[0,0]),W.onChange()}},[Y,W]);(0,i.useEffect)(()=>{if(U){let e=new MutationObserver(eh);return e.observe(U,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{e.disconnect()}}},[eh,U]);let ey=(0,i.useCallback)(t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||W.pteWithHotKeys(t),t.isDefaultPrevented()||F.send({type:"behavior event",behaviorEvent:{type:"keyboard.keydown",originEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:W,nativeEvent:t})},[e,F,W]),eg=(0,i.useCallback)(t=>{e.onKeyUp&&e.onKeyUp(t),t.isDefaultPrevented()||F.send({type:"behavior event",behaviorEvent:{type:"keyboard.keyup",originEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:W,nativeEvent:t})},[e,F,W]),ev=(0,i.useMemo)(()=>{if(void 0!==C)return null===C?d:(e,t)=>{C(D,t)}},[D,C]);(0,i.useEffect)(()=>{Y.current=p.F3.toDOMNode(W,W),z(Y.current)},[W,Y]),(0,i.useEffect)(()=>{let e=p.F3.getWindow(W),t=()=>{F.send({type:"dragend"})},n=()=>{F.send({type:"drop"})};return e.document.addEventListener("dragend",t),e.document.addEventListener("drop",n),()=>{e.document.removeEventListener("dragend",t),e.document.removeEventListener("drop",n)}},[W,F]);let em=(0,i.useCallback)(e=>{if(null==m||m(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=ea({editorActor:F,slateEditor:W,event:e.nativeEvent});if(!t){console.warn("Could not find position for dragstart event");return}return F.send({type:"dragstart",origin:t}),F.send({type:"behavior event",behaviorEvent:{type:"drag.dragstart",originEvent:{clientX:e.clientX,clientY:e.clientY,dataTransfer:e.dataTransfer},position:t},editor:W}),!0},[m,F,W]),ek=(0,i.useCallback)(e=>{if(null==k||k(e),!(e.isDefaultPrevented()||e.isPropagationStopped()||!ea({editorActor:F,slateEditor:W,event:e.nativeEvent})))return F.send({type:"behavior event",behaviorEvent:{type:"drag.drag",originEvent:{dataTransfer:e.dataTransfer}},editor:W}),!0},[k,F,W]),eb=(0,i.useCallback)(e=>{if(null==b||b(e),!(e.isDefaultPrevented()||e.isPropagationStopped()))return F.send({type:"behavior event",behaviorEvent:{type:"drag.dragend",originEvent:{dataTransfer:e.dataTransfer}},editor:W}),!0},[b,F,W]),ex=(0,i.useCallback)(e=>{if(null==x||x(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let t=ea({editorActor:F,slateEditor:W,event:e.nativeEvent});if(t)return F.send({type:"behavior event",behaviorEvent:{type:"drag.dragenter",originEvent:{dataTransfer:e.dataTransfer},position:t},editor:W}),!0},[x,F,W]),e_=(0,i.useCallback)(e=>{var t;if(null==_||_(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let n=ea({editorActor:F,slateEditor:W,event:e.nativeEvent});if(n)return F.send({type:"behavior event",behaviorEvent:{type:"drag.dragover",originEvent:{dataTransfer:e.dataTransfer},dragOrigin:null===(t=F.getSnapshot().context.internalDrag)||void 0===t?void 0:t.origin,position:n},editor:W,nativeEvent:e}),!0},[_,F,W]),eE=(0,i.useCallback)(e=>{var t;if(null==E||E(e),e.isDefaultPrevented()||e.isPropagationStopped())return;let n=ea({editorActor:F,slateEditor:W,event:e.nativeEvent});if(!n){console.warn("Could not find position for drop event");return}return F.send({type:"behavior event",behaviorEvent:{type:"drag.drop",originEvent:{dataTransfer:e.dataTransfer},dragOrigin:null===(t=F.getSnapshot().context.internalDrag)||void 0===t?void 0:t.origin,position:n},editor:W,nativeEvent:e}),!0},[E,F,W]),ew=(0,i.useCallback)(e=>{if(null==w||w(e),!(e.isDefaultPrevented()||e.isPropagationStopped()||!ea({editorActor:F,slateEditor:W,event:e.nativeEvent})))return F.send({type:"behavior event",behaviorEvent:{type:"drag.dragleave",originEvent:{dataTransfer:e.dataTransfer}},editor:W}),!0},[w,F,W]);return D?P?null:(0,s.jsx)(p.CX,{...L,"data-read-only":V,autoFocus:!1,className:L.className||"pt-editable",decorate:J,onBlur:ed,onCopy:et,onCut:en,onClick:ec,onDOMBeforeInput:eu,onDragStart:em,onDrag:ek,onDragEnd:eb,onDragEnter:ex,onDragOver:e_,onDrop:eE,onDragLeave:ew,onFocus:er,onKeyDown:ey,onKeyUp:eg,onPaste:eo,readOnly:V,renderPlaceholder:void 0,renderElement:q,renderLeaf:Z,renderText:Q,scrollSelectionIntoView:ev}):null});function oO(e){let t,n,o,a,c,d,u,h,f,y;let g=(0,r.c)(32);g[0]!==e.initialConfig?(t=()=>{let t=on(e.initialConfig),n=new ol({editor:t.editor});return{internalEditor:t,portableTextEditor:n}},g[0]=e.initialConfig,g[1]=t):t=g[1];let{internalEditor:v,portableTextEditor:m}=function(e){let t=i.useRef(null);return t.current||(t.current={constant:e()}),t.current.constant}(t);return g[2]!==v.actors.editorActor||g[3]!==v.actors.mutationActor||g[4]!==v.actors.relayActor||g[5]!==v.actors.syncActor||g[6]!==v.subscriptions?(n=()=>{let e=[];for(let t of v.subscriptions)e.push(t());return v.actors.editorActor.start(),v.actors.mutationActor.start(),v.actors.relayActor.start(),v.actors.syncActor.start(),()=>{for(let t of e)t();eB(v.actors.editorActor),eB(v.actors.mutationActor),eB(v.actors.relayActor),eB(v.actors.syncActor)}},g[2]=v.actors.editorActor,g[3]=v.actors.mutationActor,g[4]=v.actors.relayActor,g[5]=v.actors.syncActor,g[6]=v.subscriptions,g[7]=n):n=g[7],g[8]!==v?(o=[v],g[8]=v,g[9]=o):o=g[9],(0,i.useEffect)(n,o),g[10]!==m.change$?(a=e=>{m.change$.next(e)},g[10]=m.change$,g[11]=a):a=g[11],g[12]!==v.actors.relayActor||g[13]!==a?(c=(0,s.jsx)(or,{relayActor:v.actors.relayActor,onChange:a}),g[12]=v.actors.relayActor,g[13]=a,g[14]=c):c=g[14],g[15]!==m||g[16]!==e.children?(d=(0,s.jsx)(eN.Provider,{value:m,children:e.children}),g[15]=m,g[16]=e.children,g[17]=d):d=g[17],g[18]!==v.editor._internal.slateEditor.initialValue||g[19]!==v.editor._internal.slateEditor.instance||g[20]!==d?(u=(0,s.jsx)(p.mH,{editor:v.editor._internal.slateEditor.instance,initialValue:v.editor._internal.slateEditor.initialValue,children:d}),g[18]=v.editor._internal.slateEditor.initialValue,g[19]=v.editor._internal.slateEditor.instance,g[20]=d,g[21]=u):u=g[21],g[22]!==v.actors.relayActor||g[23]!==u?(h=(0,s.jsx)(oo.Provider,{value:v.actors.relayActor,children:u}),g[22]=v.actors.relayActor,g[23]=u,g[24]=h):h=g[24],g[25]!==v.actors.editorActor||g[26]!==h?(f=(0,s.jsx)(ef.Provider,{value:v.actors.editorActor,children:h}),g[25]=v.actors.editorActor,g[26]=h,g[27]=f):f=g[27],g[28]!==v.editor||g[29]!==c||g[30]!==f?(y=(0,s.jsxs)(l.r.Provider,{value:v.editor,children:[c,f]}),g[28]=v.editor,g[29]=c,g[30]=f,g[31]=y):y=g[31],y}oS.displayName="ForwardRef(PortableTextEditable)";let oM=()=>{let e,t;let n=(0,r.c)(3),o=(0,i.useContext)(ef),[a,l]=(0,i.useState)(null);return n[0]!==o?(e=()=>{let e=o.on("selection",e=>{(0,i.startTransition)(()=>{l(e.selection)})});return()=>{e.unsubscribe()}},t=[o],n[0]=o,n[1]=e,n[2]=t):(e=n[1],t=n[2]),(0,i.useEffect)(e,t),a}}}]);